"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9146],{3002:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>a});var l=i(4848),t=i(8453);const s={title:"linking \u590d\u4e60",date:new Date("2024-07-11T00:00:00.000Z"),pinned:9,author:"ayanami"},r=void 0,d={permalink:"/blog/linking-\u590d\u4e60",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/linking-\u590d\u4e60.md",source:"@site/blog/linking-\u590d\u4e60.md",title:"linking \u590d\u4e60",description:"linking \u590d\u4e60",date:"2024-07-11T00:00:00.000Z",tags:[],readingTime:16.025,hasTruncateMarker:!1,authors:[{name:"ayanami"}],frontMatter:{title:"linking \u590d\u4e60",date:"2024-07-11T00:00:00.000Z",pinned:9,author:"ayanami"},unlisted:!1,prevItem:{title:"hibernate&jpa",permalink:"/blog/hibernate-jpa"},nextItem:{title:"ts\u57fa\u7840",permalink:"/blog/ts\u57fa\u7840"}},c={authorsImageUrls:[void 0]},a=[{value:"No linker <strong>Problems</strong>",id:"no-linker-problems",level:4},{value:"What is linker",id:"what-is-linker",level:4},{value:"Static Linking",id:"static-linking",level:4},{value:"Relocatable object file",id:"relocatable-object-file",level:5},{value:"Sections",id:"sections",level:5},{value:"External reference",id:"external-reference",level:5},{value:"Object files",id:"object-files",level:4},{value:"<strong>Executable and Linkable Format (ELF)</strong>",id:"executable-and-linkable-format-elf",level:4},{value:"ELF Header",id:"elf-header",level:5},{value:"ELF String Table",id:"elf-string-table",level:5},{value:"Other Sections",id:"other-sections",level:5},{value:"Sections in ELF obj file",id:"sections-in-elf-obj-file",level:5},{value:"Symbol",id:"symbol",level:4},{value:"\u91cd\u8981\uff01\uff01\uff01\uff01\uff01",id:"\u91cd\u8981",level:5},{value:"\u91cd\u540d\u95ee\u9898",id:"\u91cd\u540d\u95ee\u9898",level:5},{value:"\u9759\u6001\u94fe\u63a5",id:"\u9759\u6001\u94fe\u63a5",level:4},{value:"Relocation",id:"relocation",level:4},{value:"Executable ELF Object",id:"executable-elf-object",level:4},{value:"Loader",id:"loader",level:4},{value:"Dynamic Link \u52a8\u6001\u94fe\u63a5",id:"dynamic-link-\u52a8\u6001\u94fe\u63a5",level:4},{value:"\u8fd0\u884c\u65f6Linking",id:"\u8fd0\u884c\u65f6linking",level:4},{value:"PIC\uff1a\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801",id:"pic\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801",level:4},{value:"\u5e93\u6253\u6869",id:"\u5e93\u6253\u6869",level:4},{value:"\u91cd\u5b9a\u5411\u6df1\u5165",id:"\u91cd\u5b9a\u5411\u6df1\u5165",level:4}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"linking \u590d\u4e60"}),"\n",(0,l.jsxs)(n.h4,{id:"no-linker-problems",children:["No linker ",(0,l.jsx)(n.strong,{children:"Problems"})]}),"\n",(0,l.jsx)(n.p,{children:"\u2022 efficiency: small change requires complete recompilation"}),"\n",(0,l.jsx)(n.p,{children:"\u2022 modularity: hard to share common functions (e.g. printf)"}),"\n",(0,l.jsxs)(n.p,{children:["seperate compilation: ",(0,l.jsx)(n.em,{children:"separately compiled relocatable object files"})]}),"\n",(0,l.jsx)(n.p,{children:"reloc object files -> executable object file"}),"\n",(0,l.jsx)(n.h4,{id:"what-is-linker",children:"What is linker"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Linking is the process of: collecting and combining various pieces of code and data into a single executable file"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Executable file: Can be loaded (copied) into memory and executed"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Linking can be performed"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"at compile time, when the source code is translated into machine code by the linker"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"at load time, when the program is loaded into memory and executed by the loader"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"at run time, by application programs"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1\u8fc7\u7a0b\uff1apreprocessor -> compiler -> assembler -> linker"}),"\n",(0,l.jsx)(n.h4,{id:"static-linking",children:"Static Linking"}),"\n",(0,l.jsx)(n.p,{children:"Input:"}),"\n",(0,l.jsx)(n.p,{children:"A relocatable object files and command line arguments"}),"\n",(0,l.jsx)(n.p,{children:"Output:"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Fully linked"})," executable object file that can be loaded and run"]}),"\n",(0,l.jsx)(n.h5,{id:"relocatable-object-file",children:"Relocatable object file"}),"\n",(0,l.jsx)(n.p,{children:"Contain binary code and data in a form that can be combined with other relocatable object files to create an executable file"}),"\n",(0,l.jsx)(n.h5,{id:"sections",children:"Sections"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Various code and data sections"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Instructions are in one section"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Initialized global variables are in one section"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Uninitialized global variables are in one section"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h5,{id:"external-reference",children:"External reference"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Reference to a symbol defined in another object file"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["The external references are ",(0,l.jsx)(n.strong,{children:"value 0"})," in the relocatable object files in the previous example"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Symbol resolution: Resolves external references"}),"\n",(0,l.jsxs)(n.p,{children:["Relocates ",(0,l.jsx)(n.em,{children:"symbols"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"from their relative locations in the .o files"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"to new absolute positions in the executable"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"object-files",children:"Object files"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Relocatable object file"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Executable object file"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Shared object file(A special type of relocatable object file that ",(0,l.jsx)(n.strong,{children:"can be loaded into memory and linked dynamically, at either load time or run time"}),")"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"executable-and-linkable-format-elf",children:(0,l.jsx)(n.strong,{children:"Executable and Linkable Format (ELF)"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Standard binary format for object files"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Derives from AT&T System V Unix"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"later adopted by BSD Unix variants and Linux"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"One unified format for relocatable object files (.o), executable object files, and shared object files (.so)"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"generic name: ELF binaries"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Better support for shared libraries than old a.out formats."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/mqs1U3JAKW27EFi.png",alt:"image-20240618152139316"})}),"\n",(0,l.jsx)(n.h5,{id:"elf-header",children:"ELF Header"}),"\n",(0,l.jsx)(n.p,{children:"The first part is very important,used to store meta data usually"}),"\n",(0,l.jsx)(n.p,{children:"magic number, type (.o, exec, .so), machine, byte ordering, Beginning of the section header table (as well as the program header table), etc"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"typedef uint64_t\tElf64_Addr;\ntypedef uint16_t\tElf64_Half;\ntypedef uint64_t\tElf64_Off;\ntypedef int32_t\tElf64_Sword;\ntypedef int64_t\tElf64_Sxword;\ntypedef uint32_t\tElf64_Word;\ntypedef uint64_t\tElf64_Lword;\ntypedef uint64_t\tElf64_Xword;\n\ntypedef  struct{\n\tunsigned char \te_ident[16]; \t/* ELF identification */  \n\tElf64_Half \t\te_type; \t/* Object file type ET_REL(1)\u3001ET_EXEC(2)\u3001ET_DYN(3)(shared) */\n\tElf64_Half \t\te_machine; \t/* Machine type EM_386(3)\u3001EM_IA_64(50)*/\n\tElf64_Word \te_version; \t/* Object file version */\n\tElf64_Addr \te_entry; \t/* Entry point address */\n\tElf64_Off \t\te_phoff; \t/* Program header offset */\n\tElf64_Off \t\te_shoff; \t/* Section header offset */\n\tElf64_Word \te_flags; \t/* Processor-specific flags */\n\tElf64_Half \t\te_ehsize; \t/* ELF header size */\n\tElf64_Half \t\te_phentsize; \t/* Size of program header entry */\n\tElf64_Half \t\te_phnum; \t/* Number of program header entries */\n\tElf64_Half \t\te_shentsize; \t/* Size of section header entry */\n\tElf64_Half \t\te_shnum; \t/* Number of section header entries */\n\tElf64_Half \t\te_shstrndx; \t/* Section name string table index */\n} Elf64_Ehdr;\n"})}),"\n",(0,l.jsx)(n.p,{children:"e_ident[0-3] \u20180x7f\u2019 \u2018E\u2019 \u2018L\u2019 \u2018F\u2019    magic number"}),"\n",(0,l.jsx)(n.p,{children:"e_ident[4] 1(32-bit) / 2(64-bit)"}),"\n",(0,l.jsx)(n.p,{children:"e_ident[5] 1(little) / 2(big)"}),"\n",(0,l.jsx)(n.p,{children:"e_ident[15] size of e_ident[]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"typedef struct {\n\tElf64_Word    sh_name;\t/* Section name (index into the section header string table). */ \n\tElf64_Word    sh_type;\t/* Section type. SHT_PROGBITS\u3001SHT_SYMTAB \u3001SHT_STRTAB\u3001SHT_REL\u3001SHT_NOBITS \n*/\n\tElf64_Xword  sh_flags;\t/* Section flags. */\n\tElf64_Addr\t    sh_addr;\t/* Address in memory image.(If the section will be copied into the memory to execute, this member gives the address at which the section\u2019s first byte should reside \n) */\n\tElf64_Off\t    sh_offset;\t/* Offset in file. (the byte offset from the beginning of the file to the first byte in the section) */\n\tElf64_Xword  sh_size;\t/* Size in bytes. */\n\tElf64_Word    sh_link;\t/* Index of a related section. */\n\tElf64_Word    sh_info;\t/* Depends on section type. */\n\tElf64_Xword  sh_addralign;\t/* Alignment in bytes. */\n\tElf64_Xword  sh_entsize;\t  /* Size of each entry in section. (Some sections hold a table of fixed-size entries, this member gives the size in bytes of each entry)*/ \n} Elf64_Shdr;\n"})}),"\n",(0,l.jsx)(n.h5,{id:"elf-string-table",children:"ELF String Table"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Hold null-terminated character sequences (strings)"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"The object file uses these strings to represent symbol and section names"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"One references a string as an index into the string table section"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/eha1s3qotpK5vXM.png",alt:"image-20240618153451314"})}),"\n",(0,l.jsx)(n.h5,{id:"other-sections",children:"Other Sections"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"debug section: debugging symbol table, local variables and typedefs, global variables, original C source file (gcc -g)"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:".line: Mapping between line numbers in the original C source program and machine code instructions in the .text section."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h5,{id:"sections-in-elf-obj-file",children:"Sections in ELF obj file"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:".text section: code \u4ee3\u7801"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:".rodata section: Read-only data"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:".data section: initialized global and static C variables"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:".bss section (\u201cBlock Started by Symbol\u201d or \u201cBetter Save Space\u201d)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u2013",(0,l.jsx)(n.strong,{children:"uninitialized"})," global and static C variables, along with any global or static variables that are ",(0,l.jsx)(n.strong,{children:"initialized to zero"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u2013",(0,l.jsx)(n.strong,{children:"has section header but occupies no disk space"})]}),"\n",(0,l.jsx)(n.p,{children:"\u2013at run time, these variables are allocated in memory with initial value zero"}),"\n",(0,l.jsx)(n.h4,{id:"symbol",children:"Symbol"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Defined global symbols"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Referenced global symbols"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Local symbols(C functions and global variables with static attribute)"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5c40\u90e8\u975e\u9759\u6001\u53d8\u91cf\u4e0d\u662fsymbol, \u4e0d\u5728.symtab\u6bb5\u5360\u6709\u7a7a\u95f4"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Each relocatable object file has a symbol table in .symtab section"})}),"\n",(0,l.jsx)(n.p,{children:"Symbol Table\u5305\u542b\u4e86\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"the module\uff08file\uff09 that defines the symbol"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"the symbol type (local,global,extern)"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"the section (.text,.data,.bss)"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:" typedef struct {\n \tint \tname ;\t\t/* the name in string table's (byte) offset */\n\tchar \ttype:4;\t/* function or data (4 bits) (usually\uff0c\u8fd8\u6709\u4e00\u4e9b\u522b\u7684)*/\n \t   \tbinding:4 ;\t/* local or global  (4 bits) */\n \tchar \treserved ;\t/* unused */\n \tshort \tsection ;\t/* section header index */\n  \tlong \tvalue ;\t\t/* section offset(for relocatable), or abs address(for executable) */\n \tlong\tsize ;\t\t/* Object size in bytes */\n} Elf64_Symbol ;\n"})}),"\n",(0,l.jsx)(n.p,{children:"**Each symbol is assigned to some section of the object file, denoted by the section field, which is an index into the section header table.**Symbol\u548c\u67d0\u4e2aSection\u7ed1\u5b9a\uff0c\u5177\u4f53\u65b9\u6cd5\u662fSymbol\u8bb0\u5f55\u5bf9\u5e94Section\u5728Section Header Table\u4e4b\u4e2d\u7684index"}),"\n",(0,l.jsxs)(n.p,{children:["There are three special pseudosections that ",(0,l.jsx)(n.strong,{children:"don\u2019t have entries in the section header table"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"ABS: symbols that should not be relocated"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"UNDEF: symbols that are referenced in this object module but defined elsewhere"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"COMMON: uninitialized data objects"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"They only exist only in relocatable object files and do not exist in executable object files"}),"\n",(0,l.jsx)(n.p,{children:"For COMMON symbols"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"value gives the alignment requirement"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"size gives the minimum size"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u91cd\u8981"}),":",(0,l.jsx)(n.strong,{children:"The difference between COMMON and .bss"})]}),"\n",(0,l.jsxs)(n.p,{children:["COMMON\uff1a",(0,l.jsx)(n.strong,{children:"Uninitialized global"})," variables"]}),"\n",(0,l.jsxs)(n.p,{children:[".bss\uff1a",(0,l.jsx)(n.strong,{children:"Uninitialized static"})," variables, ",(0,l.jsx)(n.strong,{children:"global or static"})," variables that are ",(0,l.jsx)(n.strong,{children:"initialized to zero"})]}),"\n",(0,l.jsx)(n.h5,{id:"\u91cd\u8981",children:"\u91cd\u8981\uff01\uff01\uff01\uff01\uff01"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/AKg2mf34LIXlDr7.png",alt:"image-20240618160330533"})}),"\n",(0,l.jsx)(n.h5,{id:"\u91cd\u540d\u95ee\u9898",children:"\u91cd\u540d\u95ee\u9898"}),"\n",(0,l.jsx)(n.p,{children:"\u5f3a\u7b26\u53f7\uff1a \u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u51fd\u6570"}),"\n",(0,l.jsx)(n.p,{children:"\u5f31\u7b26\u53f7\uff1a \u672a\u521d\u59cb\u5316\u7684\u5168\u5c40"}),"\n",(0,l.jsx)(n.p,{children:"\u91cd\u540d\uff1a\u5f3a+\u5f3a\uff0c\u62a5\u9519\uff1b\u5f3a+\u5f31\uff0c\u8986\u76d6\uff1b\u5f31+\u5f31\uff0c\u4efb\u610f"}),"\n",(0,l.jsx)(n.h4,{id:"\u9759\u6001\u94fe\u63a5",children:"\u9759\u6001\u94fe\u63a5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"concatenate related relocatable object files into a single file with an index (called an archive\uff0c .a)"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"enhance linker so that it tries to resolve unresolved external references by looking for the symbols in one or more archives"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"If an archive member file resolves reference, link into executable"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u9759\u6001\u94fe\u63a5\uff1a\u7ecf\u5178EUD"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Scan .o files and .a files in the ",(0,l.jsx)(n.strong,{children:"command line order."})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"When scan an object file f,"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Add f to E"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Updates U, D"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"When scan an archive file f,"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Resolve U"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"If m is used to resolve symbol, m is added to E"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Update U, D using m"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"If any entries in the unresolved list at end of scan, then error"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u95ee\u9898\uff1acommand line order matters!"}),"\n",(0,l.jsx)(n.p,{children:"\u539f\u5219\uff1a\u603b\u662f\u628a\u94fe\u63a5\u7684\u5e93\u653e\u5728\u6700\u540e\u9762\uff0c\u5e76\u4e14\u53ef\u4ee5\u91cd\u590d"}),"\n",(0,l.jsx)(n.h4,{id:"relocation",children:"Relocation"}),"\n",(0,l.jsxs)(n.p,{children:["For each ",(0,l.jsx)(n.strong,{children:"reference to an object with unknown location"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Assembler generates a relocation entry"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Relocation ",(0,l.jsx)(n.strong,{children:"entries for code"})," are placed in ",(0,l.jsx)(n.strong,{children:".rel.text"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Relocation ",(0,l.jsx)(n.strong,{children:"entries for data"})," are placed in ",(0,l.jsx)(n.strong,{children:".rel.data"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4f8b\u5982"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-assembly",children:"09      e8 00 00 00 00\tcallq e<main+0xe> swap();\n/* There is a relocation entry in rel.text */\n\noffset   symbol\ttype\t\t\taddend\n    0a   swap\tR_X86_64_PC32   \t-4  /* PC32: PC-relative */\n\n"})}),"\n",(0,l.jsx)(n.p,{children:".rel.text section"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"relocation info for .text section"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"addresses of instructions"})," that will need to be modified in the merged executable object file"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:".rel.data section"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"relocation info for .data section"}),"\n",(0,l.jsxs)(n.li,{children:["addresses of ",(0,l.jsx)(n.strong,{children:"pointer data"})," that will need to be modified in the merged executable object file"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"typedef struct {\n\t\tlong  offset ;\n   long  type:32 ,\n         symbol:32 ;\n   long  addend;\n } Elf64_Rela ;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"int *bufp0 = &buf[0] ;\n00000000 <bufp0>:\n\t0: 00 00 00 00 00 00 00 00\n/* There is a relocation entry in rel.data */\noffset   symbol\ttype\t\t\taddend\n    0\t   buf\tR_X86_64_64   \t0\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"addend"}),"\u662f\u91cd\u5b9a\u4f4d\u6761\u76ee\u4e2d\u7684\u4e00\u4e2a\u6570\u503c\uff0c\u5b83\u5728\u94fe\u63a5\u65f6\u4e0e\u7b26\u53f7\u7684\u5730\u5740\u76f8\u52a0\uff0c\u4ee5\u786e\u5b9a\u6700\u7ec8\u7684\u5185\u5b58\u5730\u5740\u3002\u8fd9\u4e2a\u53c2\u6570\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\uff0c\u5141\u8bb8\u7f16\u8bd1\u5668\u751f\u6210\u66f4\u7075\u6d3b\u548c\u53ef\u79fb\u690d\u7684\u4ee3\u7801\u3002"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Two steps"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Relocating sections and symbol definitions"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Relocating symbol references within sections"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"reloc\u8fc7\u7a0b\u7684\u4f2a\u4ee3\u7801\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"foreach section s {\n    foreach relocation entry r {\n        refptr = s + r.offset ; /* ptr to reference to be relocated */\n\n        /* relocate a PC-relative reference */\n        if (r.type == R_X86_64_PC32) {\n            refaddr = ADDR(s) + r.offset ; /* ref\u2019s runtime address */\n            *refptr=(unsigned) (ADDR(r.symbol)+r.addend\u2013refaddr) ;\n         }\n\n         /* relocate an absolute reference */\n         if ( r.type == R_X86_64_64 || r.type == R_X86_64_32||\u2026)\n              *refptr = (unsigned) (ADDR(r.symbol) + r.addend) ;\n     }\n }\n\n"})}),"\n",(0,l.jsx)(n.h4,{id:"executable-elf-object",children:"Executable ELF Object"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/ejWVEqtyn9YJbzi.png",alt:"image-20240618163520190"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"typedef  struct{\n\tunsigned char \te_ident[16]; \t/* ELF identification */\n\tElf64_Half \t\te_type; \t/* Object file type */\n\tElf64_Half \t\te_machine; \t/* Machine type */\n\tElf64_Word \te_version; \t/* Object file version */\n\tElf64_Addr \te_entry; \t/* Entry point address */\n\tElf64_Off \t\te_phoff; \t/* Program header offset */\n\tElf64_Off \t\te_shoff; \t/* Section header offset */\n\tElf64_Word \te_flags; \t/* Processor-specific flags */\n\tElf64_Half \t\te_ehsize; \t/* ELF header size */\n\tElf64_Half \t\te_phentsize; \t/* Size of program header entry */\n\tElf64_Half \t\te_phnum; \t/* Number of program header entries */\n\tElf64_Half \t\te_shentsize; \t/* Size of section header entry */\n\tElf64_Half \t\te_shnum; \t/* Number of section header entries */\n\tElf64_Half \t\te_shstrndx; \t/* Section name string table index */\n} Elf64_Ehdr;\n\ntypedef struct {\n\tElf64_Word    p_type;       /* Entry type.(PT_LOAD (1): loadable segment) */\n\tElf64_Word    p_flags;      /* Access permission flags. Run time permissions (rwx)*/\n\tElf64_Off        p_offset;    /* File offset of contents. (Offset from the beginning of the file to the first byte in the segment)*/\n\tElf64_Addr     p_vaddr;    /* Virtual address in memory image. (The virtual address of the first byte in the segment)*/\n\tElf64_Addr     p_paddr;    /* Physical address (not used). */\n\tElf64_Xword  p_filesz;     /* Size of contents in file.Segment size in the object file (>=p_memsz)\n */\n\tElf64_Xword  p_memsz;\t/* Size of contents in memory. */\n\tElf64_Xword  p_align;\t/* Alignment in memory and file.Usually 4KB or 2MB*/\n} Elf64_Phdr;\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/k7w5fiYPAHRjOCE.png",alt:"image-20240618164607421"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Difference between filesz and memsz means the uninitialized data in .bss"})}),"\n",(0,l.jsx)(n.p,{children:".init section contains a small function _init called by program\u2019s initialization code"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"startup code"}),"\n",(0,l.jsx)(n.p,{children:"_start: the entry point of the program. Defined in the crt1.o, Same for all C program, Calls system startup function"}),"\n",(0,l.jsx)(n.p,{children:"__libc_start_main: Defined in libc.so, Initializes the execution environment, Calls the main function, Handles return value, Returns control to OS (if necessary)"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"loader",children:"Loader"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Memory-resident"})," operating system code"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Invoked by call the execve function"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Copy the code and data in the executable object file from disk into memory"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Jump to the entry point"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Run the program"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"dynamic-link-\u52a8\u6001\u94fe\u63a5",children:"Dynamic Link \u52a8\u6001\u94fe\u63a5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Dynamic Linking"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Position Independent Code (PIC)"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Loading and Linking Shared Libraries from applications"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u9759\u6001\u94fe\u63a5\u7f3a\u70b9\uff1a\u5e95\u5c42\u5e93\u4fee\u6539\u9700\u8981\u6240\u6709\u5e94\u7528\u91cd\u7f16\u8bd1\uff0c\u5e94\u7528\u4f53\u79ef\u8fc7\u5927\uff0c\u5197\u4f59\u4ee3\u7801"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Shared Libraries"})}),"\n",(0,l.jsx)(n.p,{children:".so(shared obj) on Linux, .dll(dynamic linking lib) on Windows"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"gcc \u2013shared \u2013fPIC \u2013o libvector.so addvec.c multvec.c\n# \u2013shared: creating a shared object\n# \u2013fPIC:  creating the position independent code\n"})}),"\n",(0,l.jsx)(n.p,{children:"Partial Linking"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u7f16\u8bd1\u65f6\uff0c.so\u6587\u4ef6",(0,l.jsx)(n.strong,{children:"\u6ca1\u6709\u5c06.data\uff0c.text\u6bb5\u7b49copy"}),"\uff0c\u800c\u53ea\u662fcopy\u4e86\u4e00\u4e9brelocation and symbol table info"]}),"\n",(0,l.jsxs)(n.p,{children:["code and data\u662f\u5728memory\u4e4b\u4e2d",(0,l.jsx)(n.code,{children:"execve() & ld-linux.so"}),"\u94fe\u63a5\u7684"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"After linking, the locations of the shared libraries are fixed and do not change during the execution time"}),"\n",(0,l.jsx)(n.p,{children:"How to find the ld-linux.so"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.strong,{children:"pathname of the ld-linux.so is contained in the .interp segment"})," of p2"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4e0a\u9762\u90a3\u5f20\u56fe\uff0cmemory-mapped region for shared libs"}),"\n",(0,l.jsx)(n.h4,{id:"\u8fd0\u884c\u65f6linking",children:"\u8fd0\u884c\u65f6Linking"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Done explicitly by user with dlopen() in Linux"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"gcc \u2013rdynamic \u2013O2 \u2013o p3 dll.c -ldl"})}),"\n",(0,l.jsx)(n.p,{children:"API\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:" #include <dlfcn.h>\n void *dlopen(const char *filename, int flag);\n\t\t\t// returns: ptr to handle if OK, NULL on error\n void *dlsym(void *handle, char *symbol) ;\n\t\t\t// returns: ptr to symbol if OK, NULL on error\n int  dlclose(void *handle) ;\n\t\t\t// returns: 0 if OK, -1 on error\n const char dlerror(void) ;\n\t\t\t/* returns: errormsg if previous call to\n \t\t\tdlopen, dlysym, or dlclose failed,\n \t\t\tNULL if previous call was OK */\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd0\u884c\u65f6Linking\u793a\u4f8b\u7a0b\u5e8f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:" #include <stdio.h>\n #include <dlfcn.h>\n \n int x[2] = { 1, 2} ;\n int y[2] = { 3, 4} ;\n int z[2];\n \nint main()\n{\n \tvoid *handle;\n \tvoid (*addvec)(int *, int *, int *, int ) ;\n \tchar *error;\n\t/*dynamically load the shared library that contains addvec() */\n \thandle = dlopen(\u201c./libvector.so\u201d, RTLD_LAZY) ;\n \tif (!handle) {\n \t\tfprintf(stderr, \u201c%s\\n\u201d, dlerror()) ;\n \t\texit(1) ;\n \t} \n \n \t/*get a pointer to the addvec() function we just loaded */\n \taddvec = dlsym(handle, \u201caddvec\u201d) ;\n \tif ( (error = dlerror()) != NULL ) {\n \t\tfprintf(stderr, \u201c%s\\n\u201d, error) ;\n \t\texit(1) ;\n \t}\n/* Now we can call addvec() just like any other function */\n \taddvec(x, y, z, 2)\n \tprintf(\u201cz=[%d, %d]\\n\u201d, z[0], z[1]) ;\n \n \t/* unload the shared library */\n \tif (dlclose(handle) <0) {\n \t\tfprintf(stderr, \u201c%s\\n\u201d, dlerror()) ;\n \t\texit(1) ;\n \t}\n \treturn 0 ;\n }\n\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7528\u5904\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5206\u53d1\u7cfb\u7edf\u66f4\u65b0\uff0c\u66f4\u65b0dll\u91cd\u65b0\u8fd0\u884c\u65f6\u81ea\u52a8\u52a0\u8f7d"}),"\n",(0,l.jsxs)(n.li,{children:["\u9ad8\u6027\u80fdweb server, \u5bf9\u4e0d\u540c\u7684\u5e93\u52a8\u6001\u52a0\u8f7d\u5378\u8f7d\uff0c\u4f7f\u7528\u7f13\u5b58\u6765\u4fdd\u8bc1\u51fd\u6570\u7ea7\u522b\u7684\u6700\u5c0f\u5185\u5b58\u5360\u7528\uff0c",(0,l.jsx)(n.strong,{children:"\u4e5f\u662f\u652f\u6301\u70ed\u66f4\u65b0\u7684\u6765\u6e90"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"pic\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801",children:"PIC\uff1a\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801"}),"\n",(0,l.jsx)(n.p,{children:"naive: \u5212\u5206\u4e00\u5757\u533a\u57df\u4e13\u95e8\u653e"}),"\n",(0,l.jsx)(n.p,{children:"actual: \u8ba9\u4ee3\u7801\u90fd\u662fPC-relative\uff0c\u4ece\u800c\u53ef\u4ee5\u88ab\u4efb\u610f\u5730\u5740\u52a0\u8f7d"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6587\u4ef6\u5185\u90e8\u51fd\u6570\uff0c\u53d8\u91cf\uff1a\u7b80\u5355\uff0c\u76f4\u63a5\u53d8\u6210PC-relative"}),"\n",(0,l.jsxs)(n.li,{children:["\u6587\u4ef6\u5916\u90e8\u5f15\u7528\uff0c\u5168\u5c40\u53d8\u91cf\uff1a\u95f4\u63a5\u8df3\u8f6c\uff0c\u4ee5\u4e00\u4e2a",(0,l.jsx)(n.strong,{children:"Private\u7684.data\u6bb5\u5f00\u5934\u7684GOT"}),"(\u5168\u5c40\u504f\u79fb\u91cf\u8868)\u4f5c\u4e3a\u8df3\u677f"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8c03\u7528\u5916\u90e8\u5168\u5c40\u53d8\u91cf\u7684\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u4fdd\u8bc1.data\u6bb5\u548c.text\u6bb5\u5728\u52a0\u8f7d\u7684\u65f6\u5019\u4e0d\u5206\u5f00\uff0c\u4e00\u8d77\u52a0\u8f7d"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5229\u75281\uff0c.data\u6bb5\u548c.text\u6bb5\u73b0\u5728\u7684\u8ddd\u79bb\u548c\u52a0\u8f7d\u5230\u7684\u5730\u65b9\u6ca1\u6709\u5173\u7cfb\u4e86\uff0c\u5728.data\u6bb5\u5f00\u5934\u7684GOT\u91cc\u9762\u8bb0\u5f55\u5404\u4e2a\u5168\u5c40\u7684data\u7684offset\uff0c\u7136\u540e\u5728.text\u6bb5\u8bb0\u5f55GOT\u7684entry_index, \u8bbf\u95ee\u65f6 .text -> .data -> GOT[idx] -> global data"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"GOT 012\u9884\u7559\u7ed9dynamic linker"}),"\n",(0,l.jsx)(n.p,{children:"\u8c03\u7528\u5916\u90e8\u51fd\u6570\u7684\u89e3\u51b3\u65b9\u6848\uff1aPLT\uff08Procedure Linkage Table\uff09"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5728.text\u6bb5\u524d\u9762\u52a0\u4e00\u6bb5plt\u6bb5\uff0c\u7559\u4e0b\u5916\u90e8\u51fd\u6570\u7684\u5730\u5740\u7684\u6807\u8bb0\uff0c\u5bf9\u5730\u5740\u6682\u65f6\u7559\u7a7a"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u628a.text\u6bb5\u5185\u90e8\u7684\u4ee3\u7801\u4e4b\u4e2d\u6240\u6709\u5916\u90e8\u51fd\u6570\u7684\u5730\u5740\u8be5\u5916plt\u6bb5\u4e4b\u4e2d\u6807\u8bb0\u7684\u5730\u5740\uff08\u76f8\u5bf9\u5730\u5740\uff09"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5f53\u8fd0\u884c\u65f6.text->plt-> \u5982\u679c\u6ca1\u6709\uff0c\u518d\u52a0\u8f7d\u5b9e\u9645\u5730\u5740\u5230\u6807\u8bb0\u7559\u7a7a\u7684\u5730\u65b9\uff0c\u4e4b\u540e\u518d\u6b21\u8bbf\u95ee\u4e0d\u9700\u8981\u5b9e\u9645\u5730\u5740\uff0c\u53ea\u9700\u8981\u628aplt\u5f53\u8df3\u677f\u5c31\u884c"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"PLT\uff1a16-byte entry array"}),"\n",(0,l.jsx)(n.p,{children:"PLT[0] \u4e3adynamic linker\u9884\u7559"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://s2.loli.net/2024/06/18/DMFEe4dyZOcGLl8.png",alt:"image-20240618203706209"})}),"\n",(0,l.jsx)(n.p,{children:"\u7b2c\u4e00\u6b21\u8c03\u7528addvec"}),"\n",(0,l.jsxs)(n.p,{children:["jmpq ",(0,l.jsx)(n.code,{children:"*GOT[4]"}),"\u53d1\u73b0\u6ca1\u6709\uff0c\u56de\u6765(*GOT[4]\u5b580x4005c6\u4e0b\u4e00\u6761\u6307\u4ee4\u7684relative\uff0cjmp\u76f8\u5f53\u4e8e\u6ca1jmp)\uff0cpushq $0x1 \u628aaddvec\u7684entry ID\u4f5c\u4e3a\u6808\u4e0a\u7684\u53c2\u6570\u7ed9dynamic linker, \u7136\u540ejmpq \u5230PLT[0]\uff0cPLT[0]\u538b\u6808",(0,l.jsx)(n.code,{children:"*GOT[1]"}),"\u53c2\u6570\u540e\uff0c\u8df3\u8f6c\u5230dynamic linker\uff0cdynamic linker\u6839\u636e",(0,l.jsx)(n.code,{children:"*GOT[1]"}),"\u548c",(0,l.jsx)(n.code,{children:"ID"}),"\u627e\u5230\u5bf9\u5e94\u51fd\u6570\uff0c\u540c\u65f6\u66f4\u65b0GOT[4]\uff0c\u586b\u4e0a\u5730\u5740"]}),"\n",(0,l.jsxs)(n.p,{children:["\u540e\u9762\u8c03\u7528addvec\u90fd\u662f\u76f4\u63a5jmpq\u5230",(0,l.jsx)(n.code,{children:"*GOT[4]"}),",\u5b9e\u9645\u4e0a\u662f\u51fd\u6570\u8c03\u7528"]}),"\n",(0,l.jsx)(n.h4,{id:"\u5e93\u6253\u6869",children:"\u5e93\u6253\u6869"}),"\n",(0,l.jsx)(n.p,{children:"\u6784\u9020\u201c\u4e8c\u4f20\u624b\u201d\u51fd\u6570, \u622a\u83b7\u8f6c\u53d1\u4e00\u4e9b\u5df2\u7ecf\u5199\u597d\u7684\u5e93\u51fd\u6570\uff0c\u4f8b\u5982malloc\uff0c\u53ef\u4ee5\u7528\u4e8e\u65e5\u5fd7\uff0c\u7edf\u8ba1\u7b49\u7b49"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1\u65f6\u6253\u6869\uff1a\u6838\u5fc3\u5728\u4e8e\u5b9a\u4e49\u4e00\u4e2a\u81ea\u5df1\u7684\u540c\u540d\u51fd\u6570\uff0c\u5728\u81ea\u5df1\u7684\u51fd\u6570\u53bb\u8c03\u7528\u5e93\u51fd\u6570\uff0c\u4f8b\u5982\u5229\u7528\u5b8f\u5b9a\u4e49malloc\u4e3amymalloc\uff0c\u518d\u5728mymalloc\u91cc\u9762\u53bb\u8c03\u7528\u7cfb\u7edf\u7684malloc"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd0\u884c\u65f6\u6253\u6869\uff1a\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u592a\u91cd\u8981"}),"\n",(0,l.jsx)(n.h4,{id:"\u91cd\u5b9a\u5411\u6df1\u5165",children:"\u91cd\u5b9a\u5411\u6df1\u5165"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://anatasluo.github.io/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%9B%B8%E5%AF%B9%E9%87%8D%E5%AE%9A%E5%90%91.html",children:"\u6df1\u5165\u7406\u89e3\u76f8\u5bf9\u91cd\u5b9a\u5411 - Anatas Luo's Blog"})}),"\n",(0,l.jsxs)(n.p,{children:["\u603b\u7ed3\uff1a 1. \u6d41\u6c34\u7ebf\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97IP\u5bc4\u5b58\u5668\u603b\u662f\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u8ba1\u7b97offset\u65f6\uff0c\u9700\u8981\u8003\u8651\u5f53\u524d\u6307\u4ee4\u7684\u957f\u5ea6 ",(0,l.jsx)(n.strong,{children:"2. \u76f8\u5bf9\u504f\u79fb\u5982\u679c\u786e\u5b9a\uff08\u901a\u5e38\u662fstatic data\uff09\uff0c\u5219\u4ee5section\u4e3a\u57fa\u5740\u8fdb\u884c\u91cd\u5b9a\u5411\uff0c\u53ef\u4ee5\u51cf\u5c11\u7b26\u53f7\u8868\u5927\u5c0f\uff0c Addend = symbol_offset - relocation_len 3. \u76f8\u5bf9\u504f\u79fb\u5982\u679c\u4e0d\u786e\u5b9a\uff0c\u5219\u4ee5symbol\u4e3a\u57fa\u5740\u8fdb\u884c\u91cd\u5b9a\u5411\uff0cAddend = - relocation_len"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u9700\u8981\u91cd\u5b9a\u5411\u7684\u4ee3\u7801\u5728\u6c47\u7f16\u4e0a\u4ee5",(0,l.jsx)(n.code,{children:"0x0(%rip)"}),"\u7ed9\u51fa\uff0c",(0,l.jsx)(n.code,{children:"%rip"}),"\u662fPC\uff0c",(0,l.jsx)(n.code,{children:"0x0"}),"\u5219\u610f\u5473\u7740\u5f85\u586b\u5145"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var l=i(6540);const t={},s=l.createContext(t);function r(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);