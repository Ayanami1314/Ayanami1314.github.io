"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6072],{57083:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>o});var a=l(74848),i=l(28453);const s={title:"\u6765\u672c\u5730\u90e8\u7f72\u5927\u6a21\u578b!",author:"ayanami",tags:["ai","llm","deploy"],keywords:["ai","llm","deploy"]},t=void 0,r={permalink:"/blog/local-llm",source:"@site/blog/local-llm.md",title:"\u6765\u672c\u5730\u90e8\u7f72\u5927\u6a21\u578b!",description:"\u524d\u8a00",date:"2025-01-19T08:04:51.305Z",tags:[{inline:!0,label:"ai",permalink:"/blog/tags/ai"},{inline:!0,label:"llm",permalink:"/blog/tags/llm"},{inline:!0,label:"deploy",permalink:"/blog/tags/deploy"}],readingTime:3.105,hasTruncateMarker:!1,authors:[{name:"ayanami"}],frontMatter:{title:"\u6765\u672c\u5730\u90e8\u7f72\u5927\u6a21\u578b!",author:"ayanami",tags:["ai","llm","deploy"],keywords:["ai","llm","deploy"]},unlisted:!1,nextItem:{title:"NJU\u64cd\u4f5c\u7cfb\u7edf(jyy OS)\u8bfe\u7a0b\u7b14\u8bb0-\u865a\u62df\u5316\u90e8\u5206",permalink:"/blog/jyy-os-\u865a\u62df\u5316"}},d={authorsImageUrls:[void 0]},o=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u4e0b\u8f7dnvidia docker runtime",id:"\u4e0b\u8f7dnvidia-docker-runtime",level:4},{value:"\u4e0b\u8f7dollama\u955c\u50cf",id:"\u4e0b\u8f7dollama\u955c\u50cf",level:4},{value:"\u4e0b\u8f7d\u6a21\u578b",id:"\u4e0b\u8f7d\u6a21\u578b",level:4},{value:"\u5f00\u59cb\u670d\u52a1",id:"\u5f00\u59cb\u670d\u52a1",level:4},{value:"\u524d\u7aef\u5957\u58f3",id:"\u524d\u7aef\u5957\u58f3",level:4},{value:"ChatBox",id:"chatbox",level:5},{value:"aider\u7248\u672c",id:"aider\u7248\u672c",level:5},{value:"[\u53ef\u9009] IDE\u63d2\u4ef6",id:"\u53ef\u9009-ide\u63d2\u4ef6",level:4}];function c(e){const n={a:"a",code:"code",h2:"h2",h4:"h4",h5:"h5",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,a.jsx)(n.p,{children:"\u8fd9\u4ef6\u4e8b\u60c5\u7684\u8d77\u56e0\u662f\u8fd9\u6837\u7684, \u5728\u5f00\u5377\u4e0a\u673a\u8003\u60f3\u8981\u90e8\u7f72\u4e00\u4e2a\u672c\u673a\u5927\u6a21\u578b\u53c2\u8003\u4e00\u4e0b, \u540c\u65f6\u6709\u540c\u5b66\u548c\u6211\u8bb2qwen2.5-coder-7B\u975e\u5e38\u7684nice, \u4e8e\u662f\u5c31\u6709\u4e86\u4e0b\u9762\u8fd9\u7bc7\u6587\u7ae0, \u7528ollama + docker\u90e8\u7f72\u7684local LLM..."}),"\n",(0,a.jsx)(n.p,{children:"\u672c\u5730\u73af\u5883: Ubuntu24.04"}),"\n",(0,a.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u6b65\u9aa4"}),"\n",(0,a.jsx)(n.h4,{id:"\u4e0b\u8f7dnvidia-docker-runtime",children:"\u4e0b\u8f7dnvidia docker runtime"}),"\n",(0,a.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,a.jsx)(n.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-apt",children:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-apt"})]}),"\n",(0,a.jsx)(n.p,{children:"apt"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \\\n  && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \\\n    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\n    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"sudo apt-get update\nsudo apt-get install -y nvidia-container-toolkit\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8bbe\u7f6e /etc/docker/daemon.json"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n    "default-runtime": "nvidia",\n    "registry-mirrors": [\n        "https://1nj0zren.mirror.aliyuncs.com",\n        "https://docker.mirrors.ustc.edu.cn",\n        "http://f1361db2.m.daocloud.io",\n        "https://registry.docker-cn.com"\n    ],\n    "runtimes": {\n        "nvidia": {\n            "args": [],\n            "path": "nvidia-container-runtime"\n        }\n    },\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679c\u4f60\u9700\u8981\u4ee3\u7406, \u53c2\u8003\u914d\u7f6e\u52a0\u4e0a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'   "proxies": {\n    "http-proxy": "http://127.0.0.1:7890",\n    "https-proxy": "http://127.0.0.1:7890",\n    "no-proxy": ""\n  }\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u91cd\u542fdocker\u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"sudo systemctl daemon-reload    \nsudo systemctl restart docker\n"})}),"\n",(0,a.jsx)(n.p,{children:'\u51fa\u73b0\u627e\u4e0d\u5230"nvidia" runtime\u9519\u8bef\u7684, \u68c0\u67e5\u6709\u6ca1\u6709\u4e0b\u8f7d\u8fc7docker desktop'}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u4e0b\u8f7d\u8fc7docker desktop\u7684:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"docker context ls\ndocker context use default\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5207\u6362\u56dedefault, \u7136\u540e\u91cd\u542fdocker\u670d\u52a1"}),"\n",(0,a.jsx)(n.h4,{id:"\u4e0b\u8f7dollama\u955c\u50cf",children:"\u4e0b\u8f7dollama\u955c\u50cf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"mkdir -p /data/containers/ollama/data\nvi /data/containers/ollama/docker-compose.yml\n"})}),"\n",(0,a.jsx)(n.p,{children:"docker-compose.yml"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"name: 'ollama'\nservices:\n  ollama:\n    restart: always\n    image: ollama/ollama\n    container_name: ollama\n    runtime: nvidia\n    environment:\n      - TZ=Asia/Shanghai\n      - NVIDIA_VISIBLE_DEVICES=all\n    networks:\n      - ai-tier\n    ports:\n      - \"11434:11434\"\n    volumes:\n      - ./data:/root/.ollama\nnetworks:\n  ai-tier:\n    name: ai-tier\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.22.1.0/24\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u542f\u52a8"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"cd /data/containers/ollama\ndocker compose up -d\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4e4b\u540e\u4f1a\u62c9ollama (2G)"}),"\n",(0,a.jsx)(n.p,{children:"\u9a8c\u8bc1\u6210\u529f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'docker compose ps\n# \u5f97\u5230\u7ed3\u679c\u5e94\u8be5\u5982\u4e0b\nNAME      IMAGE           COMMAND               SERVICE   CREATED              STATUS              PORTS\nollama    ollama/ollama   "/bin/ollama serve"   ollama    About a minute ago   Up About a minute   0.0.0.0:11434->11434/tcp, :::11434->11434/tcp\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u4e0b\u8f7d\u6a21\u578b",children:"\u4e0b\u8f7d\u6a21\u578b"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"qwen2.5:7b"}),"\u5efa\u8bae\u6362\u6210\u5176\u4ed6\u7684\u4ee3\u7801\u4e13\u7528\u6a21\u578b, \u6839\u636e\u81ea\u5df1\u7684\u7535\u8111\u663e\u5361\u914d\u7f6e\u51b3\u5b9a\u53c2\u6570\u91cf"]}),"\n",(0,a.jsx)(n.p,{children:"\u7a7a\u95f4\u5360\u7528 7b:5G, 3b: 2G, 1B:1G"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker exec -it ollama ollama pull qwen2.5:7b\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6210\u529f\u7ed3\u679c\u8fd9\u6837"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"pulling manifest\npulling 00e1317cbf74... 100% \u2595\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  4.7 GB\npulling 4fa551d4f938... 100% \u2595\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   12 KB\npulling 8ab4849b038c... 100% \u2595\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   254 B\npulling 577073ffcc6c... 100% \u2595\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   110 B\npulling ad1518640c43... 100% \u2595\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   483 B \nverifying sha256 digest\nwriting manifest\nremoving any unused layers\nsuccess\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u9a8c\u8bc1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u276f docker exec -it ollama ollama list\nNAME          ID              SIZE      MODIFIED    \nqwen2.5:7b    845dbda0ea48    4.7 GB    2 hours ago    \n\nWhat's next:\n    Try Docker Debug for seamless, persistent debugging tools in any container or image \u2192 docker debug ollama\n    Learn more at https://docs.docker.com/go/debug-cli/\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u5f00\u59cb\u670d\u52a1",children:"\u5f00\u59cb\u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u4f1a\u5728",(0,a.jsx)(n.code,{children:"localhost:11434"}),"\u8d77\u4e00\u4e2a\u670d\u52a1, \u6d4f\u89c8\u5668\u8f93\u5165\u540e\u6b63\u5e38\u4f1a\u6709",(0,a.jsx)(n.code,{children:"Ollama is running"})]}),"\n",(0,a.jsx)(n.h4,{id:"\u524d\u7aef\u5957\u58f3",children:"\u524d\u7aef\u5957\u58f3"}),"\n",(0,a.jsx)(n.h5,{id:"chatbox",children:"ChatBox"}),"\n",(0,a.jsx)(n.p,{children:"\u76f4\u63a5\u53bb\u5b98\u7f51\u4e0b\u8f7d"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://chatboxai.app/zh/install",children:"https://chatboxai.app/zh/install"})}),"\n",(0,a.jsx)(n.p,{children:"\u8bbe\u7f6e\u91cc\u9762\u6307\u5b9a\u4e00\u4e0b\u6a21\u578b"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://s2.loli.net/2024/11/21/5gEJheUDilNtBS3.png",alt:"image-20241121211509468"})}),"\n",(0,a.jsx)(n.h4,{id:""}),"\n",(0,a.jsx)(n.h5,{id:"aider\u7248\u672c",children:"aider\u7248\u672c"}),"\n",(0,a.jsxs)(n.p,{children:["\u53c2\u8003",(0,a.jsx)(n.code,{children:"https://aider.chat/docs/config/dotenv.html"}),"\u8bbe\u7f6e\u4e00\u4e0bOLLAMA_BASE_API\u7684\u73af\u5883\u53d8\u91cf"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4e4b\u540e",(0,a.jsx)(n.code,{children:"aider --model ollama/qwen2.5:7b "}),"\u5373\u53ef"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4e0b\u8f7d\u81ea\u5df1\u770b\u5b98\u7f51(",(0,a.jsx)(n.code,{children:"pip install aider-chat"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"ok, \u5927\u529f\u544a\u6210\uff01"})}),"\n",(0,a.jsx)(n.h4,{id:"\u53ef\u9009-ide\u63d2\u4ef6",children:"[\u53ef\u9009] IDE\u63d2\u4ef6"}),"\n",(0,a.jsxs)(n.p,{children:["\u4e00\u4e2a\u4f8b\u5b50\u662fContinue\u63d2\u4ef6",(0,a.jsx)(n.a,{href:"https://www.continue.dev/",children:"https://www.continue.dev/"})]}),"\n",(0,a.jsx)(n.p,{children:"\u53c2\u8003\u5b98\u7f51, \u636e\u8bf4vsc\u652f\u6301\u8fd8\u884c, jet bug\u4e0d\u5c11"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,l)=>{l.d(n,{R:()=>t,x:()=>r});var a=l(96540);const i={},s=a.createContext(i);function t(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);