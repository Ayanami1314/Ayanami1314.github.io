"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[208],{60143:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>h,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>d,toc:()=>x});var l=s(74848),i=s(28453);const c={title:"NJU\u64cd\u4f5c\u7cfb\u7edf(jyy OS)\u8bfe\u7a0b\u7b14\u8bb0-\u865a\u62df\u5316\u90e8\u5206",author:"ayanami",tags:["os","system","virtualize"],keywords:["os","jyy"]},r=void 0,d={permalink:"/blog/jyy-os-\u865a\u62df\u5316",source:"@site/blog/jyy-os-\u865a\u62df\u5316.md",title:"NJU\u64cd\u4f5c\u7cfb\u7edf(jyy OS)\u8bfe\u7a0b\u7b14\u8bb0-\u865a\u62df\u5316\u90e8\u5206",description:"lec14 \u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u8fdb\u7a0b",date:"2025-02-12T13:56:21.000Z",tags:[{inline:!0,label:"os",permalink:"/blog/tags/os"},{inline:!0,label:"system",permalink:"/blog/tags/system"},{inline:!0,label:"virtualize",permalink:"/blog/tags/virtualize"}],readingTime:17.275,hasTruncateMarker:!1,authors:[{name:"ayanami"}],frontMatter:{title:"NJU\u64cd\u4f5c\u7cfb\u7edf(jyy OS)\u8bfe\u7a0b\u7b14\u8bb0-\u865a\u62df\u5316\u90e8\u5206",author:"ayanami",tags:["os","system","virtualize"],keywords:["os","jyy"]},unlisted:!1,prevItem:{title:"ucb cs186 \u8bfe\u7a0b\u7b14\u8bb0(\u66f4\u65b0\u4e2d)",permalink:"/blog/cs186-database-WIP"},nextItem:{title:"\u6765\u672c\u5730\u90e8\u7f72\u5927\u6a21\u578b!",permalink:"/blog/local-llm"}},h={authorsImageUrls:[void 0]},x=[{value:"lec14 \u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u8fdb\u7a0b",id:"lec14-\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u8fdb\u7a0b",level:3},{value:"lec15 \u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4",id:"lec15-\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4",level:3},{value:"lec16 syscall &amp; unix shell",id:"lec16-syscall--unix-shell",level:3},{value:"lec 17 syscall\u7684\u5c01\u88c5: libc",id:"lec-17-syscall\u7684\u5c01\u88c5-libc",level:3},{value:"lec 19 \u53ef\u6267\u884c\u6587\u4ef6",id:"lec-19-\u53ef\u6267\u884c\u6587\u4ef6",level:3},{value:"lec 21 syscall &amp; ctx switch",id:"lec-21-syscall--ctx-switch",level:3},{value:"lec 22 process",id:"lec-22-process",level:3},{value:"lec 23 \u5904\u7406\u5668\u8c03\u5ea6",id:"lec-23-\u5904\u7406\u5668\u8c03\u5ea6",level:3},{value:"Others",id:"others",level:3}];function j(n){const e={code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h3,{id:"lec14-\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u8fdb\u7a0b",children:"lec14 \u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u8fdb\u7a0b"}),"\n",(0,l.jsxs)(e.p,{children:["cpu\u6709\u521d\u59cbpc\u5730\u5740",(0,l.jsx)(e.code,{children:"->"}),"\u653e\u7f6e\u56fa\u4ef6\u4e0a\u7684\u521d\u59cb\u7a0b\u5e8f(\u56fa\u4ef6\u72b6\u6001\u673a)",(0,l.jsx)(e.code,{children:"->"}),"\u542f\u52a8OS(os\u72b6\u6001\u673a)",(0,l.jsx)(e.code,{children:"->"}),"load init\u7a0b\u5e8f(\u7a0b\u5e8f\u72b6\u6001\u673a), \u4e4b\u540eOS\u5b8c\u5168\u628a\u884c\u4e3a\u8f6c\u4ea4\u7ed9init(\u8fdb\u7a0b\u6811\u7684root)"]}),"\n",(0,l.jsxs)(e.p,{children:["llm ",(0,l.jsx)(e.code,{children:"\u77e5\u9053\u5b58\u5728"}),"\u4e0e",(0,l.jsx)(e.code,{children:"\u77e5\u9053"}),"\u7684\u754c\u9650\u6b63\u5728\u6a21\u7cca: \u77e5\u9053\u5b58\u5728\u4e14\u5408\u7406 \u9010\u6e10\u8d8b\u540c\u4e8e \u80fd\u505a"]}),"\n",(0,l.jsx)(e.p,{children:"\u4f8b\u5982 qemu \u76f8\u5173\u7684\u4e00\u4e9b\u4e1c\u897f"}),"\n",(0,l.jsxs)(e.p,{children:["\u95eellm\u53d1\u6563\u51fa\u7684\u6982\u5ff5",(0,l.jsx)(e.code,{children:"->"}),"\u77e5\u8bc6\u4f53\u7cfb\u7684\u5feb\u901f\u5efa\u7acb"]}),"\n",(0,l.jsx)(e.p,{children:"fork? \u4ee5\u72b6\u6001\u673a\u7684\u89c6\u89d2\u7406\u89e3"}),"\n",(0,l.jsx)(e.p,{children:"\u7ecf\u5178\u7684for fork + printf"}),"\n",(0,l.jsx)(e.p,{children:"\u5199\u4e86\u4e2a\u793a\u4f8b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-cpp",children:'#include <cstddef>\n#include <cstdio>\n#include <cstdlib>\n#include <stdio.h>\n#include <unistd.h>\n#include <vector>\n#include <mutex>\n#include <sys/wait.h>\n#include <map>\n#include <string>\nusing namespace std;\nconst size_t buf_size = 1024;\nconst std::map<int, std::string> mode_map = {\n    {_IONBF, "no buffer"},\n    {_IOLBF, "line buffer"},\n    {_IOFBF, "full buffer"},\n};\nvoid test(int __modes) {\n    printf("test in mode %s\\n", mode_map.at(__modes).c_str());\n    fflush(stdout);\n    vector<int> childs;\n    std::mutex mtx;\n    setvbuf(stdout, nullptr, __modes, 0);\n    for (int i = 0; i < 2; ++i) {\n        int pid = fork();\n        printf("hello from pid %d\\n", pid);\n        if (pid > 0) {\n            std::lock_guard<mutex> lock(mtx);\n            childs.push_back(pid);\n        }\n    }\n}\n\nint main() {\n    // _IOLBF, _IOFBF, _IONBF\n    test(_IOFBF);\n    printf("\\n");\n    fflush(stdout);\n    return 0;\n}\n'})}),"\n",(0,l.jsxs)(e.p,{children:["\u5728",(0,l.jsx)(e.code,{children:"_IOLBF"}),"\u548c",(0,l.jsx)(e.code,{children:"_IONBF"}),"\u7684\u60c5\u51b5\u4e0b\u4f1a\u51fa\u67656\u4e2ahello"]}),"\n",(0,l.jsxs)(e.p,{children:["\u6bcf\u6b21printf\u90fd\u76f4\u63a5\u5237\u65b0/\u68c0\u6d4b\u5230\u6362\u884c\u7b26\u5237\u65b0\u7f13\u51b2, fork\u7684\u65f6\u5019\u6ca1\u6709IO\u72b6\u6001\n\u800c",(0,l.jsx)(e.code,{children:"_IOFBF"}),"\u4f1a\u67098\u4e2ahello, \u5728fork\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\u4f1a\u5e26\u7740\u7f13\u51b2\u533a(\u5c31\u662f\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4)\u8fdb\u884cfork,\u6240\u4ee5\u6700\u540e\u76844\u4e2a\u8fdb\u7a0b\u6bcf\u4e2a\u90fd\u5e26\u77402\u4e2ahello"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7cfb\u7edf\u91cc\u9762\u6ca1\u6709\u9b54\u6cd5"})}),"\n",(0,l.jsx)(e.p,{children:"fork: \u628a\u6240\u6709\u7684\u77e5\u9053\u7684\u4e0d\u77e5\u9053\u7684\u90fd\u590d\u5236\u4e86"}),"\n",(0,l.jsxs)(e.p,{children:["\u201c\u662f\u4e0d\u662f\u8fd9\u6837?\u201d ",(0,l.jsx)(e.code,{children:"->"})," \u4e0d\u77e5\u9053\u7684\u5e95\u5c42\u72b6\u6001\u88ab\u590d\u5236\u4e86"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"execve"}),": ",(0,l.jsx)(e.strong,{children:"\u91cd\u7f6e\u72b6\u6001\u673a"})," ",(0,l.jsx)(e.code,{children:"argc, argv, envp -> main()"})]}),"\n",(0,l.jsx)(e.p,{children:"execve\u662f\u552f\u4e00\u4e00\u4e2a\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u72b6\u6001\u673a\u7684\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"exit"}),"?"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"main return"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"exit"})," libc\u63d0\u4f9b\u7684"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"_exit"})," \u7cfb\u7edf\u8c03\u7528\u9000\u51fa\uff08",(0,l.jsx)(e.code,{children:'== asm volatile("mov ..., %rax; syscall")'}),"\uff09"]}),"\n",(0,l.jsxs)(e.li,{children:["\u76f4\u63a5",(0,l.jsx)(e.code,{children:"SYSCALL"})]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u524d\u4e24\u4e2a\u5728c\u8bed\u8a00\u7684\u7a7a\u95f4, \u662f\u201cnormal exit\u201d"}),"\n",(0,l.jsxs)(e.p,{children:["\u540e\u4e24\u4e2a\u4e0d\u662fnormal\u7684, ",(0,l.jsx)(e.code,{children:"_exit"})," ",(0,l.jsx)(e.code,{children:"exit_group"})," , ",(0,l.jsx)(e.code,{children:"__exit"})," exit self"]}),"\n",(0,l.jsxs)(e.p,{children:["\u884c\u4e3a\u533a\u522b? ",(0,l.jsx)(e.code,{children:"strace"})]}),"\n",(0,l.jsx)(e.h3,{id:"lec15-\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4",children:"lec15 \u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4"}),"\n",(0,l.jsx)(e.p,{children:"pmap"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.code,{children:"/proc/[pid]/maps"})}),"\n",(0,l.jsx)(e.p,{children:"vvar(r), vdso(rx), vsyscall"}),"\n",(0,l.jsxs)(e.p,{children:["os\u5185\u53ea\u8bfb\u7684syscall ",(0,l.jsx)(e.code,{children:"->"})," \u53ef\u4ee5\u4ee5\u5185\u5b58\u7684\u5f62\u5f0f\u5171\u4eab"]}),"\n",(0,l.jsx)(e.p,{children:"\u5176\u5b9e\u53ea\u9700\u8981\u8fdb\u7a0b\u80fd\u548cOS\u4ea4\u4e92\u4e00\u4e9b\u6570\u636e\u5c31\u884c \u2014\u2014 why not\u8fdb\u7a0b\u5199page, OS\u8f6e\u8be2?"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5728\u6781\u7aef\u7684\u65f6\u5019\u80fd\u63d0\u9ad8\u4e00\u4e9b\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u7684\u6027\u80fd, \u67d0\u7bc7OSDI"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u5730\u5740\u7a7a\u95f4\u5e94\u8be5\u662f\u5728\u8fd0\u884c\u65f6\u53ef\u53d8\u7684"}),"\n",(0,l.jsxs)(e.p,{children:["\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4e0d\u5b58\u5728\u4e8ec\u4e16\u754c\u7684\u64cd\u4f5c(syscall)\u53bb\u64cd\u4f5c\u5730\u5740\u7a7a\u95f4 ",(0,l.jsx)(e.code,{children:"->"})," mmap, munmap"]}),"\n",(0,l.jsx)(e.p,{children:"\u5165\u4fb5\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4: gdb, perf"}),"\n",(0,l.jsx)(e.p,{children:"Game Genie \u7269\u7406\u5165\u4fb5\u5730\u5740\u7a7a\u95f4"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5916\u63a5\u7535\u8def: \u5f53cpu\u8bfb\u5730\u5740a\u7684\u65f6\u5019\u8bfb\u5230x, \u5219\u66ff\u6362\u4e3ay"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"jyy\u73b0\u573a\u6f14\u793amini CE(\u96fe)"}),"\n",(0,l.jsx)(e.p,{children:"gdb attach\u5230\u865a\u62df\u673a,\u67e5\u627e\u6ee1\u8db3\u67d0\u4e2a\u6a21\u5f0f\u7684\u5185\u5b58\u503c, \u4fee\u6539\u4e4b"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"/proc/[pid]/mem"})," \u4fee\u6539\u5668 = \u8c03\u8bd5\u5668"]}),"\n",(0,l.jsx)(e.p,{children:"xdotool: cmd X11 automation tool"}),"\n",(0,l.jsxs)(e.p,{children:["ydotool: better xdotool ",(0,l.jsx)(e.code,{children:"->"})," \u6309\u952e\u7cbe\u7075"]}),"\n",(0,l.jsx)(e.p,{children:"evdev \u6309\u952e\u663e\u793a\u811a\u672c"}),"\n",(0,l.jsx)(e.p,{children:"xdotool\u6d4b\u8bd5vsc\u63d2\u4ef6, crazy"}),"\n",(0,l.jsx)(e.p,{children:"\u6216\u8bb8\u4e0d\u9700\u8981\u90a3\u4e48\u591a\u7684\u201c\u9b54\u6cd5\u5de5\u5177\u201d"}),"\n",(0,l.jsx)(e.p,{children:"OS: \u89e3\u653e\u7f16\u7a0b\u80fd\u529b, \u4ec0\u4e48\u4e8b\u60c5\u5728OS\u4e0a\u53ef\u4ee5\u505a"}),"\n",(0,l.jsx)(e.p,{children:"\u53d8\u901f\u9f7f\u8f6e: syscall\u662f\u611f\u77e5\u65f6\u95f4\u7684\u552f\u4e00\u65b9\u6cd5"}),"\n",(0,l.jsx)(e.p,{children:"gdb \u811a\u672c\u4e4b\u4e2d, \u5728gettimeofday\u6253\u65ad\u70b9, \u7136\u540e\u4fee\u6539\u5bc4\u5b58\u5668, amazing!!!"}),"\n",(0,l.jsx)(e.p,{children:"hook"}),"\n",(0,l.jsx)(e.p,{children:"patching: \u6574\u6d3b, kpatch, \u4e0d\u505c\u673a\u66f4\u65b0(\u8f6f\u4ef6\u52a8\u6001\u94fe\u63a5)"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.code,{children:"old func, rx -> \u4fee\u6539\u4e3arwx -> \u4fee\u6539old func\u4e3a, jmp\u5230new func"})}),"\n",(0,l.jsx)(e.p,{children:"\u5728chcore\u91cc\u9762\u770b\u770b? \u6216\u8bb8\u6709\u5fc5\u8981\u7814\u7a76\u4e00\u4e0bgdb(attach with qemu)"}),"\n",(0,l.jsx)(e.h3,{id:"lec16-syscall--unix-shell",children:"lec16 syscall & unix shell"}),"\n",(0,l.jsx)(e.p,{children:"everything is a file"}),"\n",(0,l.jsx)(e.p,{children:"thing: \u64cd\u4f5c\u7cfb\u7edf\u91cc\u9762\u7684\u5bf9\u8c61"}),"\n",(0,l.jsx)(e.p,{children:"gpt\u65f6\u4ee3\u7684\u201c\u7f16\u7a0b\u201d\u2014\u2014\u81ea\u7136\u8bed\u8a00?"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:'//OS: API:\n//\tget_object_by_name(\n//\t\t"the address space file of pid=1234"\n//\t)\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6587\u4ef6\u63cf\u8ff0\u7b26: \u6307\u5411OS\u5bf9\u8c61\u7684\u201c\u6307\u9488\u201d"})}),"\n",(0,l.jsx)(e.p,{children:"windows: handle(\u53e5\u67c4)"}),"\n",(0,l.jsx)(e.p,{children:"IPC endpoints: \u4f8b\u5b50, \u7ba1\u9053"}),"\n",(0,l.jsx)(e.p,{children:"\u7ba1\u9053\u662f\u540c\u6b65\u7684"}),"\n",(0,l.jsx)(e.p,{children:'fork + pipe? \u672c\u8d28\u662f"\u6307\u9488"\u7684\u62f7\u8d1d'}),"\n",(0,l.jsx)(e.p,{children:"\u73b0\u5728\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u6709\u8bfb\u53e3\u548c\u5199\u53e3\u5566"}),"\n",(0,l.jsx)(e.p,{children:"shell, kernel \u7684\u5916\u58f3"}),"\n",(0,l.jsx)(e.p,{children:"cli: \u9ad8\u6548\u7b80\u6d01\u7684\u7f16\u7a0b\u8bed\u8a00"}),"\n",(0,l.jsxs)(e.p,{children:["\u7b97\u529b\u7684\u63d0\u5347: ",(0,l.jsx)(e.code,{children:"cli -> gui -> \u81ea\u7136\u8bed\u8a00"})]}),"\n",(0,l.jsxs)(e.p,{children:["shell as pl: ",(0,l.jsx)(e.strong,{children:"\u57fa\u4e8e\u6587\u672c\u66ff\u6362\u7684\u5feb\u901f\u5de5\u4f5c\u6d41\u642d\u5efa"})]}),"\n",(0,l.jsx)(e.p,{children:'job control: \u7c7b\u6bd4\u7a97\u53e3\u7ba1\u7406\u5668\u7684"x", \u6700\u5c0f\u5316'}),"\n",(0,l.jsx)(e.p,{children:"\u6216\u8bb8\u4e0d\u9700\u8981tmux, shell\u5c31\u662f\u6700\u7b80\u5355\u7684tmux"}),"\n",(0,l.jsx)(e.p,{children:"\u624b\u518c: complete ref"}),"\n",(0,l.jsx)(e.p,{children:"AI\u662f\u201c\u88ab\u52a8\u7684\u201d, \u8bfb\u4e00\u8bfbshell manual"}),"\n",(0,l.jsx)(e.p,{children:"\u590d\u523bunix shell"}),"\n",(0,l.jsx)(e.p,{children:"\u201c\u629b\u5f00\u7cfb\u7edf\u5e93\u201d"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.code,{children:"-ffreestanding -nostdlib -static"})}),"\n",(0,l.jsxs)(e.p,{children:["gdb init\u5df2\u7ecf\u5f88\u5e38\u89c1\u4e86, \u4f46gdb init\u5230python\u518d\u5728python\u91cc\u9762\u8f6c\u56de",(0,l.jsx)(e.code,{children:"/proc/[pid]/fd"}),"\u6253\u5370, \u6700\u540e\u7ed3\u5408gdb\u7684\u5185\u7f6ehook,\u5728stop\u65f6\u5019\u6253\u5370, fancy!"]}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u6253\u5370\u7684\u4e0d\u662f\u6211\u4eecgo\u7684channel\u8bed\u6cd5\u5417, \u66f4\u6709\u8da3\u4e86"}),"\n",(0,l.jsx)(e.p,{children:"sh manual"}),"\n",(0,l.jsx)(e.h3,{id:"lec-17-syscall\u7684\u5c01\u88c5-libc",children:"lec 17 syscall\u7684\u5c01\u88c5: libc"}),"\n",(0,l.jsx)(e.p,{children:"pipe write\u5982\u679c\u5c0f\u4e8ePIPE_BUF, \u662f\u539f\u5b50\u7684"}),"\n",(0,l.jsx)(e.p,{children:"pipe 7"}),"\n",(0,l.jsx)(e.p,{children:"\u8bfb\u8005\u5173\u95ed: Broken pipe"}),"\n",(0,l.jsx)(e.p,{children:"libc \u6807\u51c6\u5316, \u7a33\u5b9a\u53ef\u9760, \u79fb\u690d\u6027\u6781\u597d"}),"\n",(0,l.jsx)(e.p,{children:"C runtime library: -Wl, --verbose\u770b\u5230\u94fe\u63a5\u5217\u8868"}),"\n",(0,l.jsx)(e.p,{children:"\u8c03\u8bd5glibc? \u5386\u53f2\u5305\u88b1\u91cd, \u5927\u91cf\u5185\u8054\u6c47\u7f16, musl"}),"\n",(0,l.jsx)(e.p,{children:"\u53ea\u8981\u5b9e\u73b0\u4e86C ABI\u6307\u5b9a\u7684\u5806\u6808\u6392\u5e03\u7684\u7cfb\u7edf\u8c03\u7528, \u5c31\u53ef\u4ee5\u8f7b\u677e\u79fb\u690dmusl\u7b49\u5230\u81ea\u5df1\u7684OS\u4e0a, \u5e95\u5c42\u7684\u8ba1\u7b97\u7531\u786c\u4ef6\u6307\u4ee4\u96c6\u7ed9\u51fa"}),"\n",(0,l.jsx)(e.p,{children:"System V ABI"}),"\n",(0,l.jsx)(e.p,{children:"\u8131\u5f00workload \u505a\u4f18\u5316\u5c31\u662f\u800d\u6d41\u6c13"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5728\u5f00\u59cb\u8003\u8651\u6027\u80fd\u4e4b\u524d, \u7406\u89e3\u9700\u8981\u8003\u8651\u4ec0\u4e48\u6837\u7684\u6027\u80fd"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"workload\u54ea\u91cc\u627e? \u5f53\u7136\u662fpaper\u4e86(\u987a\u4fbf\u767d\u5f97\u65b9\u6848)"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u770bwkld\u8c03\u6027\u80fd"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"mm alloctor: \u6839\u57fa"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5927\u5bf9\u8c61\u5e94\u8be5\u6709\u957f\u751f\u5b58\u671f, \u5426\u5219\u662fperformance bug"}),"\n",(0,l.jsx)(e.li,{children:"\u8d8a\u5c0f\u7684\u5bf9\u8c61\u521b\u5efa/\u5206\u914d\u8d8a\u9891\u7e41"}),"\n",(0,l.jsx)(e.li,{children:"\u5c0f\u5bf9\u8c61, \u4e2d\u5bf9\u8c61, \u5927\u5bf9\u8c61"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u74f6\u9888\u51e0\u4e4e\u662f\u5c0f\u5bf9\u8c61"}),"\n",(0,l.jsx)(e.p,{children:"\u94fe\u8868/\u533a\u95f4\u6811\u4e0d\u662f\u4e00\u4e2a\u597d\u60f3\u6cd5: \u4e0a\u9501, \u4e0d\u80fd\u5f88\u597d\u7684\u5e76\u884c\u5316"}),"\n",(0,l.jsx)(e.p,{children:"\u8bbe\u7f6e\u4e24\u5957\u7cfb\u7edf\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Fast path \u6027\u80fd\u6781\u597d\uff0c\u5e76\u884c\u5ea6\u6781\u9ad8\uff0c\u8986\u76d6\u5927\u90e8\u5206\u60c5\u51b5"}),"\n",(0,l.jsx)(e.li,{children:"Slow path \u4e0d\u5728\u4e4e\u901f\u5ea6\uff0c\u4f46\u628a\u56f0\u96be\u7684\u4e8b\u60c5\u505a\u597d"}),"\n",(0,l.jsx)(e.li,{children:"\u4f8b\u5982cache"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"init ram fs"}),"\n",(0,l.jsx)(e.p,{children:"ISA -> OS \u5bf9\u8c61/syscall -> libc -> \u7cfb\u7edf\u5de5\u5177 coreutils, busybox -> \u5e94\u7528\u7a0b\u5e8f"}),"\n",(0,l.jsx)(e.p,{children:"initramfs"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u52a0\u8f7d\u5269\u4f59\u5fc5\u8981\u7684\u9a71\u52a8\u7a0b\u5e8f, \u4f8b\u5982\u78c1\u76d8/\u7f51\u5361"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u6302\u8f7d\u5fc5\u8981\u7684fs"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5c06\u6839\u6587\u4ef6\u7cfb\u7edf\u548c\u63a7\u5236\u6743\u79fb\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u7a0b\u5e8f, \u4f8b\u5982systemd"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"initramfs\u4f5c\u4e3a\u4e00\u4e2a\u975e\u5e38\u5c0f\u7684\u542f\u52a8fs, \u518d\u628a\u78c1\u76d8\u8fd9\u4e2aOS Object mount\u8fdb\u6765, \u6700\u540eswitch root\u628a\u63a7\u5236\u6743\u7ed9\u5230\u78c1\u76d8\u7684\u7684\u6839\u7cfb\u7edf"}),"\n",(0,l.jsx)(e.p,{children:"\u542f\u52a8\u7684\u7b2c\u4e8c\u7ea7\u9636\u6bb5 /sbin/init"}),"\n",(0,l.jsx)(e.p,{children:"\u75af\u72c2\u7684\u4e8b\u60c5\u4e0d\u65ad\u6709\u4eba\u5728\u505a, \u4f46\u75af\u72c2\u7684\u4e8b\u60c5\u7684\u8d77\u70b9\u5176\u5b9e\u7ecf\u5e38\u5f88\u5c0f"}),"\n",(0,l.jsx)(e.h3,{id:"lec-19-\u53ef\u6267\u884c\u6587\u4ef6",children:"lec 19 \u53ef\u6267\u884c\u6587\u4ef6"}),"\n",(0,l.jsx)(e.p,{children:"elf\u4e0d\u662f\u4e00\u4e2a\u4eba\u7c7b\u53cb\u597d\u7684\u201c\u72b6\u6001\u673a\u6570\u636e\u7ed3\u6784\u63cf\u8ff0\u201d"}),"\n",(0,l.jsx)(e.p,{children:"\u4e3a\u4e86\u6027\u80fd, \u5f7b\u5e95\u8fdd\u80cc\u4e86\u53ef\u8bfb(\u201c\u4fe1\u606f\u5c40\u90e8\u6027\u201d)\u539f\u5219"}),"\n",(0,l.jsxs)(e.p,{children:["\u53ef\u6267\u884c\u6587\u4ef6=OS\u7684",(0,l.jsx)(e.strong,{children:"\u6570\u636e\u7ed3\u6784"}),"(core.dump), \u63cf\u8ff0\u4e86\u7a0b\u5e8f\u5e94\u8be5\u7684\u521d\u59cb\u72b6\u6001"]}),"\n",(0,l.jsx)(e.p,{children:"\u652f\u6301\u7684\u7279\u6027\u8d8a\u591a, \u4eba\u7c7b\u8d8a\u4e0d\u80fd\u7406\u89e3"}),"\n",(0,l.jsxs)(e.p,{children:["\u4eba\u7c7b\u53cb\u597d: ",(0,l.jsx)(e.strong,{children:"\u5e73\u5766\u7684"})]}),"\n",(0,l.jsx)(e.p,{children:"\u56de\u5f52\u8fde\u63a5\u548c\u52a0\u8f7d\u7684\u6838\u5fc3\u6982\u5ff5: \u4ee3\u7801\u3001\u7b26\u53f7\u3001\u91cd\u5b9a\u4f4d"}),"\n",(0,l.jsx)(e.p,{children:"my_execve"}),"\n",(0,l.jsx)(e.p,{children:"elf file -> parse as struct"}),"\n",(0,l.jsx)(e.p,{children:"-> \u5c06\u5404\u4e2asection load\u5230\u6307\u5b9a\u7684\u5730\u5740(mmap)->asm volatile\u5e03\u7f6e\u597dABI\u8c03\u7528\u6808(\u6839\u636e\u624b\u518c)->jmp!"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u4f55\u91ca\u653e\u65e7\u8fdb\u7a0b\u7684\u5185\u5b58\u8d44\u6e90\uff1fproc\u91cc\u9762\u9700\u8981\u6709\u8bb0\u5f55"}),"\n",(0,l.jsx)(e.h3,{id:"lec-21-syscall--ctx-switch",children:"lec 21 syscall & ctx switch"}),"\n",(0,l.jsx)(e.p,{children:"dynamic linker"}),"\n",(0,l.jsx)(e.p,{children:"se\u7ed9\u7684os\u57fa\u7840\u8fd8\u662f\u5f88\u624e\u5b9e\u7684\n\u5f88\u96be\u60f3\u8c61ics2\u91cc\u9762\u8bb2\u4e86GOT\u548cPLT"}),"\n",(0,l.jsx)(e.p,{children:"SEE ALSO\u662f\u4e00\u4e2a\u5b9d\u85cf man ld.so"}),"\n",(0,l.jsxs)(e.p,{children:["hacking: ",(0,l.jsx)(e.code,{children:"LD_PRELOAD"}),"\u4e0d\u9700\u8981\u4fee\u6539libc, \u52a8\u6001\u52a0\u8f7d\u7684\u5168\u5c40\u7b26\u53f7, ",(0,l.jsx)(e.strong,{children:"\u5148\u5230\u5148\u5f97"})]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u52ab\u6301\u5927\u6cd5"}),"\uff01"]}),"\n",(0,l.jsx)(e.p,{children:"kernel memory mapping"}),"\n",(0,l.jsx)(e.p,{children:"\u4f4e\u914d\u7248Linux 1.X \u5206\u6bb5, \u5185\u6838\u5728\u4f4e\u4f4d, \u53ea\u662f\u5206\u4e2a\u6bb5"}),"\n",(0,l.jsx)(e.p,{children:"\u4f4e\u914d\u7248Linux 2.X \u5185\u6838\u8fd8\u662f\u5728\u7269\u7406\u4f4e\u4f4d, \u4f46\u7a0b\u5e8f\u770b\u5230\u865a\u62df\u5730\u5740\u5df2\u7ecf\u662f\u9ad8\u4f4d\u4e86"}),"\n",(0,l.jsx)(e.p,{children:"today: complete memory map"}),"\n",(0,l.jsx)(e.p,{children:"qemu is a state machine simulator: \u8c03\u8bd5syscall(gdb\u5e76\u4e0d\u80fdsi\u4ece\u7528\u6237\u6001\u8fdbkernel)"}),"\n",(0,l.jsx)(e.p,{children:'\u53e6\u4e00\u79cd\u7406\u89e3\u4e2d\u65ad\u7684\u65b9\u5f0f\uff1a"\u88ab"\u63d2\u5165\u4e00\u6761syscall'}),"\n",(0,l.jsx)(e.p,{children:"\u4e2d\u65ad, \u628a\u72b6\u6001\u673a\u7684\u6574\u4e2a\u5bc4\u5b58\u5668\u72b6\u6001\u5b58\u5230\u5185\u5b58\u91cc\u9762"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u6c47\u7f16\u4e4b\u4e2d\u5c0f\u5fc3\u6392\u5e03\u5185\u5b58\u548c\u642c\u8fd0\u5bc4\u5b58\u5668, \u8fd4\u56de\u5230c\u4e4b\u4e2d\u5c31\u662f\u7ed3\u6784\u4f53\u7684context"}),"\n",(0,l.jsx)(e.p,{children:"schedule\u7684\u6838\u5fc3: \u8c03\u7528\u4e00\u4e2a\u201c\u4e0d\u4f1a\u8fd4\u56de\u7684\u51fd\u6570\u201d"}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u4e2a(\u6c47\u7f16)\u51fd\u6570\u4ee5context\u4e3a\u53c2\u6570, \u5e76\u4e14\u6839\u636econtext, \u8fd4\u56de\u5230\u53e6\u4e00\u5904\u63a7\u5236\u6d41..."}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"->"}),' coroutine \u4e5f\u662f\u5982\u6b64! OS\u4f5c\u4e3a\u4e00\u4e2a\u201c\u72b6\u6001\u673a\u7ba1\u7406\u5668\u201d\u5c31\u5728\u505a\u4e00\u4e2a"coroutine event handler"\u7684\u4f5c\u7528']}),"\n",(0,l.jsx)(e.h3,{id:"lec-22-process",children:"lec 22 process"}),"\n",(0,l.jsx)(e.p,{children:"\u8fdb\u7a0b: \u201c\u6234\u4e0aVR\u201d\u7684thread"}),"\n",(0,l.jsx)(e.p,{children:"\u6709\u81ea\u5df1\u7684\u5730\u5740\u8f6c\u6362, \u5bf9\u4e00\u5207\u7684load/store\u4f1a\u5e94\u7528\u4e00\u4e2af\uff0c\u4f5c\u7528\u5728addr\u4e0a"}),"\n",(0,l.jsx)(e.p,{children:"\u786c\u4ef6\u63d0\u4f9b\u4e86\u201c\u6234\u4e0aVR\u201d\u7684\u6307\u4ee4"}),"\n",(0,l.jsxs)(e.p,{children:["\u8fd9\u4e2af\u4eceds\u7684\u89c6\u89d2\u6765\u8bf4\u5c31\u662f",(0,l.jsx)(e.code,{children:"int->int"}),"\u7684\u6620\u5c04"]}),"\n",(0,l.jsxs)(e.p,{children:["\u67e5\u9875\u8868(",(0,l.jsx)(e.code,{children:"int->int"}),"\u7684\u6620\u5c04)\u8fd9\u4ef6\u4e8b, \u5982\u4f55\u52a0\u901f? --\u81ea\u7136\u60f3\u5230radix tree"]}),"\n",(0,l.jsx)(e.p,{children:"\u666e\u901a\u5b9e\u73b0\u662fradix tree(x86, riscv, ...\u6536\u655b\u5230\u7684\u6700\u7ec8\u65b9\u6848)"}),"\n",(0,l.jsx)(e.p,{children:"\u6bcf\u4e00\u6b21\u8bbf\u5b58\u90fd\u8981\u67e5\u8fd9\u4e48\u51e0\u6b21\u7684\u8bdd\u4e0d\u53ef\u63a5\u53d7"}),"\n",(0,l.jsx)(e.p,{children:"\u56e0\u6b64\u6709\u4e86TLB, \u4f46\u7acb\u523b\u5e26\u6765\u7684\u4e00\u4e2a\u8bbe\u8ba1\u95ee\u9898\u662f, \u8c01\u6765\u7ba1TLB(\u4ee5\u53ca\u5bf9\u5e94\u7684miss\u5904\u7406\uff1f)"}),"\n",(0,l.jsx)(e.p,{children:"x86\u9009\u62e9\u653e\u5230\u786c\u4ef6, \u4f46\u4e27\u5931\u7075\u6d3b\u6027\u7684\u540e\u679c\u662f\u5373\u4f7f\u6709\u4e9b\u8fdb\u7a0b\u53ea\u60f3\u8981f(x)=x, \u4e5f\u5fc5\u987b\u8981\u8001\u5b9e\u67e5\u8868, TLB\u5728\u548ccpu cache\u62a2\u5e26\u5bbd"}),"\n",(0,l.jsx)(e.p,{children:"MIPS\u9009\u62e9\u653e\u5230\u8f6f\u4ef6, miss\u4e86\u76f4\u63a5\u4e22\u51fa\u6765\u5f02\u5e38, \u8ba9\u8f6f\u4ef6\u6765\u51b3\u5b9a\u600e\u4e48\u5904\u7406TLB"}),"\n",(0,l.jsx)(e.p,{children:"\u75af\u72c2\u7684\u60f3\u6cd5: inverted page table"}),"\n",(0,l.jsx)(e.p,{children:"\u628akey\u4eceVPN\u6362\u6210 (VPN, pid), \u7136\u540e\u4ece\u4e00\u4e00\u6620\u5c04\u6539\u6210hashtable, \u652f\u6301\u6bcf\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u9875\u8868"}),"\n",(0,l.jsx)(e.p,{children:"\u7f3a\u70b9\u5728\u4f8b\u5982hashtable\u5e26\u6765\u7684\u51b2\u7a81\u65f6(TLB miss, etc)\u65f6\u95f4\u4e0d\u53ef\u63a7(O(1) ~ O(n))"}),"\n",(0,l.jsx)(e.p,{children:"\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u201cVR\u773c\u955c\u201d\u8fd9\u4ef6\u4e8b\u60c5\u8fd8\u5e26\u6765\u4e86\u66f4\u591a\u7684\u4f18\u5316\u7a7a\u95f4, \u4f8b\u5982\u591a\u4e2a\u8fdb\u7a0b, \u4e0d\u540c\u7684\u865a\u62df\u5730\u5740\u5757\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u5730\u5740, \u4ee5\u53cacow"}),"\n",(0,l.jsx)(e.p,{children:"KSM(kernel samepage merging/mermory deduplication), demand paging"}),"\n",(0,l.jsx)(e.p,{children:"fork: \u8fdb\u7a0b\u5feb\u7167, redis"}),"\n",(0,l.jsx)(e.p,{children:"cow fork\u7684\u7f3a\u70b9: \u8ba9\u7cfb\u7edf\u5b9e\u73b0\u53d8\u590d\u6742"}),"\n",(0,l.jsx)(e.p,{children:"\u6539\u9769: \u780d\u6389\u6240\u6709\u7684\u5185\u6838\u90e8\u5206, \u5269\u4e0b\u7684\u5168\u90e8\u4ea4\u7ed9xv6"}),"\n",(0,l.jsx)(e.h3,{id:"lec-23-\u5904\u7406\u5668\u8c03\u5ea6",children:"lec 23 \u5904\u7406\u5668\u8c03\u5ea6"}),"\n",(0,l.jsx)(e.p,{children:"trampoline code"}),"\n",(0,l.jsx)(e.p,{children:"\u8df3\u677f\u4ee3\u7801, \u4f8b\u5b50"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"call printf -> call *GOT(printf)"}),"\n",(0,l.jsx)(e.li,{children:"JIT\u7f16\u8bd1\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u8f6f\u4ef6\u70ed\u66f4\u65b0(patch \u51fd\u6570\u5934)"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u8d44\u6e90\u8c03\u5ea6(\u5206\u914d)\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u95ee\u9898"}),"\n",(0,l.jsxs)(e.p,{children:["\u5efa\u6a21, \u9884\u6d4b, \u51b3\u7b56 ",(0,l.jsx)(e.code,{children:"->"})," \u8c03\u5ea6\u7b56\u7565\u7684\u8bbe\u8ba1\u7a7a\u95f4"]}),"\n",(0,l.jsx)(e.p,{children:"\u8c03\u5ea6\u7b56\u7565"}),"\n",(0,l.jsx)(e.p,{children:'\u518d\u52a0\u4e00\u5c42\u673a\u5236 "niceness", \u7ba1\u7406\u5458\u63a7\u5236nice, \u8d8anice\u8d8a\u80fd\u5f97\u5230cpu'}),"\n",(0,l.jsx)(e.p,{children:"10 nice ~ 10\u500d\u6027\u80fd\u5dee\u5f02"}),"\n",(0,l.jsx)(e.p,{children:"taskset \u7ed1\u5b9a\u4e00\u4e2aprocess\u5230\u4e00\u4e2acpu\u4e0a"}),"\n",(0,l.jsx)(e.p,{children:"round-robin\u65f6\u4ee3: MLFQ, \u52a8\u6001\u4f18\u5148\u7ea7"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u8ba9\u51faCPU(I/O) -> \u201c\u597d\u201d"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u7528\u5b8c\u65f6\u95f4\u7247 -> \u201c\u574f\u201d!"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"1960s: breakthrough!"}),"\n",(0,l.jsx)(e.p,{children:"2020s: \u5bf9\u5f88\u591a\u8d1f\u8f7d\u90fd\u6b20\u8003\u8651"}),"\n",(0,l.jsx)(e.p,{children:"\u4eca\u5929\u7684\u8c03\u5ea6: CFS(complete fair scheduling)"}),"\n",(0,l.jsx)(e.p,{children:'\u4f46\u6709vruntime, "\u597d\u4eba"\u7684\u949f\u5feb\u4e00\u4e9b'}),"\n",(0,l.jsx)(e.p,{children:"\u771f\u5b9e\u7684\u5904\u7406\u5668\u8c03\u5ea6: \u4e0d\u8981\u9ad8\u5174\u5f97\u592a\u65e9..."}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4f4e\u4f18\u5148\u7ea7\u7684\u5728\u6301\u6709mutex\u7684\u65f6\u5019\u88ab\u4e2d\u95f4\u4f18\u5148\u7ea7\u7684\u8d76\u4e0b\u5904\u7406\u5668"}),", \u53ef\u4ee5",(0,l.jsx)(e.strong,{children:"\u5bfc\u81f4\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u7b49\u5f85mutex\u9000\u5316\u5230\u4f4e\u4f18\u5148\u7ea7"})," ",(0,l.jsx)(e.code,{children:"->"})," \u706b\u661f\u8f66"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Linux: \u6ca1\u6cd5\u89e3\u51b3, CFS\u51d1\u5408\u7528"})}),"\n",(0,l.jsx)(e.p,{children:"\u5b9e\u65f6\u7cfb\u7edf: \u706b\u661f\u8f66\u5728CPU Reset, \u4e0d\u80fd\u6446\u70c2"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u4f18\u5148\u7ea7\u7ee7\u627f, \u6761\u4ef6\u53d8\u91cf\u5524\u9192?"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"lockdep\u9884\u8b66"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7136\u800c\u4e0d\u6b62\u6709\u9501, \u8fd8\u6709\u591a\u5904\u7406\u5668..."})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4eca\u5929\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf: SMP"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u591a\u5904\u7406\u5668\u7684\u77db\u76fe\u56f0\u5883"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.strong,{children:'\u7ed1\u5b9a\u4e00\u4e2a\u7ebf\u7a0b:"\u4e00\u6838\u6709\u96be, \u516b\u65b9\u56f4\u89c2"'})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.strong,{children:"\u8c01\u7a7a\u4e22\u7ed9\u8c01: cache, TLB\u767d\u5e72"})}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u66f4\u591a\u7684\u5b9e\u9645\u60c5\u51b5: NUMA, \u5f02\u6784, \u591a\u7528\u6237"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"numa: \u8fdc\u8fd1cpu\u6027\u80fd\u5dee\u8fbe\u5230\u6570\u500d"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u591a\u7528\u6237\u7684cpu\u5171\u4eab? namespaces, cgroups, \u4f8b\u5982\u4e00\u4e2a\u7a0b\u5e8f\u5f00\u5e76\u884c, \u53e6\u4e00\u4e2a\u7a0b\u5e8f\u662f\u4e32\u884c\u7684, \u662f\u5426\u9700\u8981\u7ed9\u4e32\u884c\u7684\u4fdd\u7559\u4e00\u4e2a\u6838, \u800c\u4e0d\u662f\u5f00\u5f97\u8d8a\u591a\u62a2\u5f97\u8d8a\u591a"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5f02\u6784, \u5927\u5c0f\u6838\u8d85\u5c0f\u6838, GPUNPU, \u6bcf\u4e2a\u6838\u7684\u72ec\u6709\u7f13\u5b58\u548c\u5171\u4eab\u7f13\u5b58..."})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u66f4\u5c11\u7684\u5904\u7406\u5668\u53ef\u80fd\u66f4\u5feb...(\u53cd\u76f4\u89c9, \u540c\u6b65cacheline\u5e26\u6765\u7684\u5f00\u9500)"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u590d\u6742\u7684\u7cfb\u7edf\u65e0\u4eba\u638c\u63a7"}),"\n",(0,l.jsx)(e.p,{children:"ghOSt: Fast & Flexible User-Space Delegation of Linux"}),"\n",(0,l.jsx)(e.p,{children:"\u5f00\u59cb\u4e0b\u653e\u7ed9\u5e94\u7528\u7a0b\u5e8f\u505a\u8c03\u5ea6"}),"\n",(0,l.jsx)(e.h3,{id:"others",children:"Others"}),"\n",(0,l.jsxs)(e.p,{children:["\u65e9\u671f\u4f18\u96c5\u7684\u8bbe\u8ba1\u53ef\u80fd\u4f1a\u6210\u4e3a\u540e\u7eed\u53d1\u5c55\u7684\u5305\u88b1: fork+exec\u5e26\u6765\u7684\u81a8\u80c0, ",(0,l.jsx)(e.strong,{children:"\u6240\u6709\u6d89\u53ca\u5230OS\u5185\u90e8\u72b6\u6001\u7684api\u90fd\u9700\u8981\u8003\u8651fork\u884c\u4e3a"}),", \u4f8b\u5982\u6587\u4ef6\u504f\u79fb\u91cf..."]}),"\n",(0,l.jsx)(e.p,{children:"\u603b\u7ebf, \u4e2d\u65ad\u63a7\u5236\u5668, DMA"}),"\n",(0,l.jsx)(e.p,{children:"\u603b\u7ebf: \u63d0\u4f9b\u8bbe\u5907\u7684\u201c\u865a\u62df\u5316\u201d, \u6ce8\u518c\u548c\u8f6c\u53d1, \u628a\u6536\u5230\u7684\u5730\u5740(\u603b\u7ebf\u5730\u5740)\u548c\u6570\u636e\u8f6c\u53d1\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\u4e0a"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8fd9\u6837cpu\u53ea\u9700\u8981\u76f4\u8fde\u4e00\u6839\u603b\u7ebf\u5c31\u884c\u4e86!"})}),"\n",(0,l.jsx)(e.p,{children:"PCI\u603b\u7ebf"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u603b\u7ebf\u53ef\u4ee5\u6865\u63a5\u5176\u4ed6\u603b\u7ebf, \u4f8b\u5982",(0,l.jsx)(e.code,{children:"pci -> usb"})]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"lspci -tv"}),"\u53ef\u89c6\u5316"]}),"\n",(0,l.jsx)(e.p,{children:'"\u5373\u63d2\u5373\u7528"\u7684\u5b9e\u73b0\u2014\u2014\u975e\u5e38\u590d\u6742!'}),"\n",(0,l.jsx)(e.p,{children:"cpu: \u53ea\u6709\u4e00\u6839\u4e2d\u65ad\u7ebf"}),"\n",(0,l.jsx)(e.p,{children:"\u542f\u52a8\u591a\u4e2acpu: cpu\u7ed9\u5176\u4ed6cpu\u53d1\u4e2d\u65ad!"}),"\n",(0,l.jsx)(e.p,{children:"\u4e2d\u65ad\u4ef2\u88c1: \u6536\u96c6\u5404\u4e2a\u8bbe\u5907\u4e2d\u65ad, \u9009\u4e00\u4e2a\u53d1\u7ed9cpu"}),"\n",(0,l.jsx)(e.p,{children:"APIC(Advanced PIC):"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"local APIC: \u4e2d\u65ad\u5411\u91cf\u8868, IPI, \u65f6\u949f, ..."}),"\n",(0,l.jsx)(e.li,{children:"IO APIC: IO\u8bbe\u5907"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"DMA: \u5f88\u65e9\u671f\u5c31\u6709\u4e86, \u89e3\u653ecpu, \u8bbe\u8ba1\u4e13\u7528\u7684\u7535\u8def\u53ea\u505amemcpy"}),"\n",(0,l.jsx)(e.p,{children:"\u4eca\u5929: PCI\u603b\u7ebf\u76f4\u63a5\u652f\u6301"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6587\u4ef6 = \u5b9e\u73b0\u4e86\u6587\u4ef6\u64cd\u4f5c\u7684\u201cAnything\u201d"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f: \u4e00\u4e2a struct file_operations\u7684\u5b9e\u73b0, \u5c31\u662f\u4e00\u6bb5\u666e\u901a\u7684\u5185\u6838, \u201c\u7ffb\u8bd1\u201dread/write\u7b49\u7cfb\u7edf\u8c03\u7528"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"/dev/null"}),"\u7684\u9a71\u52a8: read\u6c38\u8fdc\u4ec0\u4e48\u90fd\u4e0d\u505a\u8fd4\u56de0, write\u6c38\u8fdc\u4ec0\u4e48\u90fd\u4e0d\u505a\u8fd4\u56decount"]}),"\n",(0,l.jsx)(e.p,{children:'\u4e00\u79cd"duck type"'}),"\n",(0,l.jsx)(e.p,{children:"\u8bbe\u5907\u4e0d\u4ec5\u4ec5\u662f\u6570\u636e, \u8fd8\u6709\u914d\u7f6e"}),"\n",(0,l.jsx)(e.p,{children:"\u914d\u7f6e\u8bbe\u5907:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63a7\u5236\u4f5c\u4e3a\u6570\u636e\u6d41\u7684\u4e00\u90e8\u5206(\u81ea\u5b9a\u4e49\u4e00\u5957write\u7684\u6307\u4ee4\u7f16\u7801)"}),"\n",(0,l.jsx)(e.li,{children:"\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684\u63a5\u53e3"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"ioctl: \u975e\u6570\u636e\u7684\u8bbe\u5907\u529f\u80fd\u51e0\u4e4e\u5b8c\u5168\u4f9d\u8d56ioctl, \u5b8c\u5168\u7531\u9a71\u52a8\u51b3\u5b9a"}),"\n",(0,l.jsx)(e.p,{children:"\u6570\u91cf\u6700\u5e9e\u5927,\u8d28\u91cf\u6700\u4f4e\u7684shit"}),"\n",(0,l.jsx)(e.p,{children:"unix\u7684\u8d1f\u62c5: \u590d\u6742\u7684hidden spec"}),"\n",(0,l.jsx)(e.p,{children:"/dev/kvm \u786c\u4ef6\u865a\u62df\u5316, \u652f\u6491\u4e86\u51e0\u4e4e\u6240\u6709\u7684\u4e91\u4ea7\u5546\u865a\u62df\u5316\u65b9\u6848"}),"\n",(0,l.jsx)(e.p,{children:"unix\u7684\u8bbe\u8ba1: \u76ee\u5f55\u6811\u7684\u62fc\u63a5"}),"\n",(0,l.jsx)(e.p,{children:"\u5c06\u4e00\u68f5\u76ee\u5f55\u6811\u62fc\u5230\u53e6\u4e00\u68f5\u4e0a"}),"\n",(0,l.jsx)(e.p,{children:"\u56de\u60f3\u6700\u5c0flinux\u7cfb\u7edf, \u53ea\u6709/dev/console\u548c\u51e0\u4e2a\u6587\u4ef6"}),"\n",(0,l.jsx)(e.p,{children:"/proc, /sys, /tmp\u90fd\u662fmount\u7cfb\u7edf\u8c03\u7528\u521b\u5efa\u7684"}),"\n",(0,l.jsxs)(e.p,{children:['"\u770b\u5230\u7684fs!=\u78c1\u76d8\u7684fs", is just a ',(0,l.jsx)(e.strong,{children:"view"})]}),"\n",(0,l.jsx)(e.p,{children:"\u50cf\u662fprocfs\u8fd9\u79cd\u5e76\u975e\u5b9e\u9645\u7684fs\u66f4\u662f, \u53ef\u4ee5\u6302\u8f7d\u5230\u4efb\u610f\u7684\u5730\u65b9, \u4ee5\u4efb\u610f\u7684\u6570\u91cf(\u56e0\u4e3a\u4ed6\u53ea\u662ffake\u4e86read/write\u7684\u201cfile Object\u201d)"}),"\n",(0,l.jsx)(e.p,{children:"\u6839\u672c\u8bbe\u8ba1\u54f2\u5b66: \u7075\u6d3b"}),"\n",(0,l.jsx)(e.p,{children:"\u7075\u6d3b\u6027\u5e26\u6765\u7684"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"/"}),", ",(0,l.jsx)(e.code,{children:"/home"}),", ",(0,l.jsx)(e.code,{children:"/var"}),"\u90fd\u53ef\u4ee5\u662f\u72ec\u7acb\u7684\u8bbe\u5907, \u628a\u6709\u4e9b\u5feb\u7684\u653e\u5728\u4e00\u4e2a\u76ee\u5f55\u5b58\u53ef\u6267\u884c\u6587\u4ef6, \u53e6\u4e00\u4e9b\u5b58\u6570\u636e..."]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"mount\u4e00\u4e2a\u6587\u4ef6? loopback device"}),"\n",(0,l.jsx)(e.p,{children:"\u8bbe\u5907\u9a71\u52a8\u628a\u8bbe\u5907\u7684read/write\u7ffb\u8bd1\u6210\u6587\u4ef6\u7684rw"}),"\n",(0,l.jsx)(e.p,{children:"FHS: Filesystem Hierarchy Standard"}),"\n",(0,l.jsx)(e.p,{children:"ln -s \u56fe\u7ed3\u6784 as \u72b6\u6001\u673a"}),"\n",(0,l.jsx)(e.p,{children:"fs: \u4e00\u4e2a\u201d\u6570\u636e\u7ed3\u6784\u9898\u201c, \u4f46\u8bfb\u5199\u7684\u5355\u5143\u662f\u4e00\u4e2ablock"}),"\n",(0,l.jsx)(e.p,{children:'FAT: \u96c6\u4e2d\u4fdd\u5b58\u6240\u6709"next"\u6307\u9488, \u53ef\u9760\u6027? \u5b58n\u4efd!'}),"\n",(0,l.jsx)(e.p,{children:"fat manual"}),"\n",(0,l.jsx)(e.p,{children:"fat \u5c0f\u6587\u4ef6ok, \u5927\u6587\u4ef6\u4e0d\u884c"})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(j,{...n})}):j(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>d});var l=s(96540);const i={},c=l.createContext(i);function r(n){const e=l.useContext(c);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),l.createElement(c.Provider,{value:e},n.children)}}}]);