<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">One post tagged with &quot;tech blog&quot; | Ayanami&#x27;s Cave</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ayanami1314.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ayanami1314.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ayanami1314.github.io/blog/tags/tech-blog"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;tech blog&quot; | Ayanami&#x27;s Cave"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/ayanami.jpg"><link data-rh="true" rel="canonical" href="https://ayanami1314.github.io/blog/tags/tech-blog"><link data-rh="true" rel="alternate" href="https://ayanami1314.github.io/blog/tags/tech-blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://ayanami1314.github.io/blog/tags/tech-blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Ayanami&#39;s Cave RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Ayanami&#39;s Cave Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/personal-essays/rss.xml" title="Ayanami&#39;s Cave RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal-essays/atom.xml" title="Ayanami&#39;s Cave Atom Feed">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.00dd3480.css">
<script src="/assets/js/runtime~main.aa217668.js" defer="defer"></script>
<script src="/assets/js/main.0da58ad9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ayanami&#x27;s Cave</b></a><a class="navbar__item navbar__link" href="/docs/Chcore源码阅读">课程笔记</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">技术博客</a><a class="navbar__item navbar__link" href="/personal-essays">个人随笔</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/llm for code paper notes">paper-reading, code&amp;rl方向</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/speculative-decode-overview">投机解码简述</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Paper reading Context Pruning and beyond hard pruning">Paper reading - Context Pruning and beyond hard pruning</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/结构化输出">结构化输出与AI工具与Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/context-engineering">context-engineering</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/从微 调reranker到搜推">从微调reranker到搜推工程实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/llm-tech-report">部分llm技术报告的阅读</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Ask in Any Modality A Comprehensive Survey on Multimodal Retrieval-Augmented Generation">Paper reading-Ask in Any Modality A Comprehensive Survey on Multimodal Retrieval-Augmented Generation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/精读 AAAI 2025 Fit and Prune Fast and Training-free Visual Token Pruning for Multi-modal Large Language Models">Paper reading - Fit and Prune Fast and Training-free Visual Token Pruning for Multi-modal Large Language Models</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/精读：Eagle Exploring The Design Space for Multi- modal LLMs with Mixture of Encoders">Paper reading-Eagle Exploring The Design Space for Multi- modal LLMs with Mixture of Encoders</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/RAG的一些思考和细节">RAG的一些思考与细节</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/精读  Interleaved Scene Graph for Interleaved Text-and-Image Generation Assessment">Paper reading - Interleaved Scene Graph for Interleaved Text-and-Image Generation Assessment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ColBERT">ColBERT-后期交互方法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/05/26/技术博客阅读">美团技术博客阅读</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Milvus">稀疏神经嵌入</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/RocketMQ">RocketMQ学习</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/AI limu">李沐dl笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cs186-database-WIP">ucb cs186 课程笔记(更新中)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/jyy-os-虚拟化">NJU操作系统(jyy OS)课程笔记-虚拟化部分</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/local-llm">来本地部署大模型!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ostep-chapter42-44">ostep阅读笔记：单机fs的崩溃一致性(chapter42-44)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/系统架构设计笔记">system-design-interview笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/JUC">JUC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cs144 labs">cs144 labs(Winter 2024)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/jyy-os：并发">NJU操作系统(jyy OS)课程笔记-并发部分</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/nginx">nginx基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cs144/cs144 lec notes">CS144 Lecture Notes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/django-mosh">Django_mosh</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/splay-tree">splay tree</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/xv6book-notes">xv6book Notes(C1-4)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Go-Gin学习">Go,Gin学习</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/godis源码阅读">godis源码阅读</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hibernate-jpa">hibernate&amp;jpa</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/linking-复习">linking 复习</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ts基础">ts基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/实战2-mosh-gamehub">react practice:mosh gamehub</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/浅入理解断点和调试器">浅入理解断点和调试器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/黑马点评">黑马点评(速通版)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/js基础">js基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/11-14-11-26学习双周记">11-14-11-26学习双周记</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>One post tagged with &quot;tech blog&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2025/05/26/技术博客阅读">美团技术博客阅读</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-05-26T00:00:00.000Z">May 26, 2025</time> · <!-- -->19 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro"><div class="avatar__name"><span>ayanami</span></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="美团外卖基于gpu的向量检索系统实践">美团外卖基于GPU的向量检索系统实践<a class="hash-link" aria-label="Direct link to 美团外卖基于GPU的向量检索系统实践" title="Direct link to 美团外卖基于GPU的向量检索系统实践" href="/blog/tags/tech-blog#美团外卖基于gpu的向量检索系统实践">​</a></h3>
<blockquote>
<p>美团外卖的向量检索系统使用了GPU来加速向量检索过程。该系统主要包括以下几个方面： 美团外卖业务特点具有较强的Location Based Service（LBS）依赖，  即商家的配送范围，决定了用户所能点餐的商家列表。以商品向量检索场景为例：向量检索结果集需要经过“可配送商家列表”过滤。</p>
</blockquote>
<blockquote>
<p>美团外卖向量检索基于Elasticsearch+FAISS进行搭建，实现了10亿级别+高维向量集的标量+向量混合检索的能力。为了在保证业务高召回率的同时进一步减少检索时间，我们探索基于GPU的向量检索，并实现了一套通用的检索系统。</p>
</blockquote>
<p><strong>相继使用了HNSW（Hierarchical Navigable Small World），IVF（Inverted File），IVF-PQ（Inverted File with Product Quantization）以及IVF-PQ+Refine等算法，基于CPU实现了向量检索能力</strong></p>
<p>在HNSW算法中，这种导航小世界图的层次结构使得搜索过程可以从图的高层开始，快速定位到目标点的大致位置，然后逐层向下精细化搜索，最终在底层找到最近邻，在通用检索场景上有显著的优势。然而<strong>该算法在高过滤比下性能会有折损</strong>，从而导致在到家搜推这种强LBS过滤场景下会暴露其性能的劣势。业界有较多相关的benchmark可以参考，以Yahoo的向量检索系统Vespa相关博客为例</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-6ecdab7cf574caf7866ef8076970b00a.webp" width="1080" height="678" class="img_ev3q"></p>
<blockquote>
<p>索引吞吐</p>
<p>Observations: 观察结果：</p>
<ul>
<li>Indexing throughput depends on corpus size for Annoy and HNSW, where throughput is halved when corpus size is increased by 10x.
对于 Annoy 和 HNSW，<strong>索引吞吐量</strong>取决于语料库大小，当语料库大小增加 10 倍时，吞吐量就会减半。</li>
<li>Indexing throughput for RPLSH is independent of corpus size.
RPLSH 的索引吞吐量与语料库大小无关。</li>
<li>Annoy is <strong>4.5 to 5 times</strong> faster than HNSW.
Annoy 比 HNSW 快 <strong>4.5 到 5 倍</strong> 。</li>
<li>RPLSH is <strong>23 to 24 times faster</strong> than HNSW at 1M documents.
对于 1M 文档，RPLSH 的<strong>速度比 HNSW 快 23 到 24 倍</strong> 。</li>
</ul>
</blockquote>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/indexing-throughput-sift-0d6b3d3501d6d01b8531d2fbf5f73052.png" width="1110" height="686" class="img_ev3q"></p>
<blockquote>
<p>查询吞吐</p>
<p>Observations: 观察结果：</p>
<ul>
<li>HNSW outperforms Annoy and RPLSH. At corpus size 1M the QPS is <strong>9 times as high</strong> as Annoy, and <strong>16 times as high</strong> as RPLSH at comparable quality. Similar observations between hnswlib and Annoy are found in <a href="https://ann-benchmarks.com/" target="_blank" rel="noopener noreferrer">ANN Benchmarks</a>, where the QPS of hnswlib is 5-10 times higher at the same quality on all tested datasets.
HNSW 的表现优于 Annoy 和 RPLSH。在 1M 语料库规模下，其每秒查询速度 (QPS) 是 Annoy 的 <strong>9 倍</strong> ，在同等质量下是 RPLSH 的 <strong>16 倍</strong> 。在 <a href="https://ann-benchmarks.com/" target="_blank" rel="noopener noreferrer">ANN 基准测试</a>中也发现了 hnswlib 与 Annoy 之间的类似现象：在所有测试数据集上，相同质量下 hnswlib 的每秒查询速度 (QPS) 比 Annoy 高 5-10 倍。</li>
<li><strong>HNSW 搜索算法很大程度上取决于节点之间的链接数量，而链接数量又取决于语料库的大小。当语料库规模增加 10 倍时，QPS 会减半</strong>。在索引过程中，我们也看到了同样的情况，因为它使用搜索算法来查找要连接的候选节点。</li>
</ul>
</blockquote>
<p><img decoding="async" loading="lazy" src="https://blog.vespa.ai/assets/2020-06-30-approximate-nearest-neighbor-search-in-vespa-part-1/search-throughput-sift.png" alt="img" class="img_ev3q"></p>
<blockquote>
<p>内存占用</p>
<p>Observations: 观察结果：</p>
<ul>
<li>The Annoy index is almost 3 times larger than the HNSW index, which results in ~40% more total memory usage in the 1M SIFT dataset.
<strong>Annoy 索引几乎比 HNSW 索引大 3 倍</strong>，这导致 1M SIFT 数据集的总内存使用量增加约 40%。</li>
<li>Both indexes are independent of dimension size, but max points in a leaf node (Annoy) and max links per level (HNSW) might need adjustments with higher dimensionality to get decent quality.
这两个索引都与维度大小无关，但叶节点中的最大点数（Annoy）和每级的最大链接数（HNSW）可能需要使用更高的维度进行调整才能获得不错的质量。</li>
</ul>
</blockquote>
<p><a href="https://blog.vespa.ai/approximate-nearest-neighbor-search-in-vespa-part-1/" target="_blank" rel="noopener noreferrer">博客</a>给出了一个很重要的观察是：<strong>当超过 90% 到 95% 的文档被过滤掉时，过滤后计算精确最近邻比搜索 HNSW 索引（过滤器会丢弃候选匹配项）的成本更低</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-ivf-inverted-file">2.2 IVF （Inverted File）<a class="hash-link" aria-label="Direct link to 2.2 IVF （Inverted File）" title="Direct link to 2.2 IVF （Inverted File）" href="/blog/tags/tech-blog#22-ivf-inverted-file">​</a></h4>
<p>IVF是一种基于倒排索引的方法，它将高维向量空间分为多个簇（Cluster），每个簇对应一个倒排列表，存储了属于该簇的向量索引。这种方法大大减少了搜索时需要比较的向量数量，从而<strong>提高了检索速度</strong>。它的缺点是需要存储原始的向量数据，<strong>同时为了保证检索性能需要将其全量加载到内存中，从而占用了大量的内存空间</strong>，容易造成内存资源瓶颈。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-ivf-pqinverted-file-with-product-quantization">2.3 IVF-PQ（Inverted File with Product Quantization）<a class="hash-link" aria-label="Direct link to 2.3 IVF-PQ（Inverted File with Product Quantization）" title="Direct link to 2.3 IVF-PQ（Inverted File with Product Quantization）" href="/blog/tags/tech-blog#23-ivf-pqinverted-file-with-product-quantization">​</a></h4>
<p>在候选集数量巨大的场景下，比如商品向量检索场景下，IVF带来的内存空间大的问题很快就显现出来，为了解决内存空间的问题，开始尝试使用了IVF-PQ方法。该方法在IVF的基础上，使用了<strong>乘积量化（Product Quantization，PQ）的方法来压缩向量数据。PQ将高维向量分为多个子向量，然后对每个子向量进行量化</strong>，从而大大减少了对内存空间的需求。</p>
<p>然而，由于量化过程会引入误差，因此<strong>IVF-PQ的检索精度会低于IVF，从而导致召回率无法满足线上要求，对召回率要求相对较低的场景可以使用IVF-PQ，对召回率有一定要求的场景需要其他解决方案。</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="24-ivf-pqrefine">2.4 IVF-PQ+Refine<a class="hash-link" aria-label="Direct link to 2.4 IVF-PQ+Refine" title="Direct link to 2.4 IVF-PQ+Refine" href="/blog/tags/tech-blog#24-ivf-pqrefine">​</a></h4>
<p>为了提高IVF-PQ的检索精度，进一步采用了IVF-PQ+Refine的方案，在IVF-PQ的基础上，在SSD磁盘上保存了未经压缩的原始向量数据。<strong>检索时，通过IVF-PQ召回数量更大的候选向量集合，然后获取对应的原始向量数据进行精确计算，从而提高检索精度</strong>。这种方法既保留了IVF-PQ的存储优势，解决了内存资源瓶颈，又保证了召回率，因此在实际应用中得到了广泛的使用。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="25-基于地理位置的向量检索">2.5 基于地理位置的向量检索<a class="hash-link" aria-label="Direct link to 2.5 基于地理位置的向量检索" title="Direct link to 2.5 基于地理位置的向量检索" href="/blog/tags/tech-blog#25-基于地理位置的向量检索">​</a></h4>
<p><strong>通过将经纬度编码为向量，优化具体做法是将 用户或商家的经纬度以加权的方式加入查询Query和候选向量中，在计算Query和候选向量的相似度时，距离因素就可以在不同程度上影响最终的检索结果，从而达到让向量索引具备LBS属性的目标。</strong></p>
<p>这里没有细讲，但怎么具体怎么融入的LBS属性还是比较有意思的，最直接的方法是将经纬度信息直接拼接到现有的文本embedding向量上，也可以将经纬度用geohash，或者以用户为中心的极坐标系统表示?</p>
<p>我觉得最复杂的在于：</p>
<ul>
<li>如何确定经纬度特征的维度，这也算是一种权值</li>
<li>如何让经纬度特征和其他向量特征上对齐？美团是否有一个专用的embedding模型来嵌入地理信息特征，这个模型又是根据什么进行微调的？是类似推荐系统那种基于用户反馈的，还是内部有一个地理加权的人工设计公式，这个模型提供的地理特征使得整体效果向这个公式靠齐的？</li>
</ul>
<p><a href="https://docs.google.com/document/d/1R5nOiwFUn9ZJtuWywmos2yfB4aCWCGy1TUN5VAnMRaY/edit?usp=sharing" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1R5nOiwFUn9ZJtuWywmos2yfB4aCWCGy1TUN5VAnMRaY/edit?usp=sharing</a></p>
<blockquote>
<p>考虑到美团外卖的业务场景，目标方案应该满足以下要求：</p>
<ul>
<li><strong>支持向量+标量混合检索</strong>：在向量检索的基础上，支持复杂的标量过滤条件。</li>
<li><strong>高过滤比</strong>：标量作为过滤条件，有较高的过滤比（大于99%），过滤后候选集大（以外卖商品为例，符合LBS过滤的商品向量候选集仍然超过百万）。</li>
<li><strong>高召回率</strong>：召回率需要在95%+水平。</li>
<li><strong>高性能</strong>：在满足高召回率的前提下，检索耗时Tp99控制在20ms以内。</li>
<li><strong>数据量</strong>：需要支持上亿级别的候选集规模。</li>
</ul>
</blockquote>
<blockquote>
<p>  实现向量+标量混合检索，一般有两种方式：前置过滤（pre-filter）和后置过滤（post-filter）。<strong>前置过滤指先对全体数据进行标量过滤，得到候选结果集，然后在候选结果集中进行向量检索，得到TopK结果。后置过滤指先进行向量检索，得到TopK*N个检索结果，再对这些结果进行标量过滤，得到最终的TopK结果</strong>。其中N为扩召回倍数，主要是为了缓解向量检索结果被标量检索条件过滤，导致最终结果数不足K个的问题。</p>
<p>业界已有较多的成熟的全库检索的方案，后置过滤方案可以尽量复用现有框架，开发量小、风险低，<strong>因此我们优先考虑后置过滤方案</strong>。我们基于GPU的后置过滤方案快速实现了一版向量检索引擎，并验证其召回率与检索性能。GPU中成熟的检索算法有Flat、IVFFlat和IVFPQ等，在不做扩召回的情况下，召回率偏低，<strong>因此我们在benchmark上选择了较大的扩召回倍数以提高召回率。</strong></p>
</blockquote>
<p><img decoding="async" loading="lazy" src="https://mmbiz.qpic.cn/sz_mmbiz_png/hEx03cFgUsVShPhmBKFPvZmO6XEY3ficv2O6cewUo5kHicVklOU2wUzECA2q5d0lf8kBFtYI8Jj2HBbvNs0TuQ9w/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=10005&amp;wx_lazy=1" alt="图片" class="img_ev3q"></p>
<blockquote>
<p><strong>测试结果表明，以上三种算法均无法同时满足我们对检索性能和召回率的需求。其中IVF与IVFPQ召回率较低，Flat算法虽然召回率较高，但是与全体候选集计算向量相似度导致其性能较差。</strong></p>
</blockquote>
<blockquote>
<p><strong>根据用户的地理位置信息计算其GeoHash值，并扩展至附近9个或25个GeoHash块，在这些GeoHash块内采用Flat算法进行向量检索，可以有效减少计算量。这种向量子空间划分方式有效地提高了检索性能，但是存在某些距离稍远的商家无法被召回的情况，最终测得的召回率  只有80%左右，无法满足要求。</strong></p>
</blockquote>
<blockquote>
<p>综上，后置过滤方案无法同时满足检索性能和召回率的需求，而GPU版本的Faiss无法实现前置过滤功能，考虑到美团外卖的业务场景，向量+标量混合检索能力是最基本的要求，因此我们决定自研GPU向量检索引擎。</p>
</blockquote>
<blockquote>
<p>基于GPU的向量检索，要想实现前置过滤，一般有三种实现方案：</p>
<ol>
<li>所有<strong>原始数据都保存在GPU显存中，由GPU完成前置过滤</strong>，再进行向量计算。</li>
<li>所有<strong>原始数据都保存在CPU内存中，在CPU内存中完成前置过滤，将过滤后的原始向量数据传给GPU进行向量计算</strong>。(能存更大的数据集)</li>
<li><strong>原始向量数据保存在GPU显存中，其他标量数据保存在CPU内存中，在CPU内存完成标量过滤后，将过滤结果的下标传给GPU，GPU根据下标从显存中获取向量数据进行计算。</strong>（省显存带宽）</li>
</ol>
<p>由于GPU与CPU结构与功能上的差异性，使用GPU完成前置过滤，显存资源占用量更大，过滤性能较差，且无法充分利用过滤比大的业务特点，<strong>因此不考虑方案1</strong>。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748242298419-5-cc781b495cb0bc8b56c804a537b59a3d.webp" width="1080" height="278" class="img_ev3q"></p>
<p>实验结果表明，方案2在数据拷贝阶段耗时严重，时延无法达到要求。因为在美团外卖的场景下，过滤后的数据集仍然很大，这对CPU到GPU之间的数据传输带宽（A30显卡带宽数据如下 CPU-GPU：PCIe Gen4: 64GB/s；GPU-GPU：933GB/s）提出了很高的要求，<strong>因此我们最终选择了方案3。</strong></p>
</blockquote>
<blockquote>
<p>考虑到显存的价格远高于内存，因此我们在设计方案的过程中，尽可能将数据存储在内存当中，仅将需要GPU计算的数 据存储在显存当中。</p>
<p>内存中保存了所有的标量数据，数据<strong>按列存储</strong>，通过位置索引可以快速找到某条数据的所有字段信息，数据按列存储具备较高的灵活性和可扩展性，同时也更容易进行数据压缩和计算加速。针对需要用于过滤的标量字段，<strong>在内存中构造了倒排索引，倒排链中保存了对应的原始数据位置索引信息</strong>，内存数据结构如下图所示</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748242561687-8-46646c8a46fe5a278b81322532de631c.webp" width="1080" height="1238" class="img_ev3q"></p>
<blockquote>
<p>显存中保存了所有的向量数据，数据位置索引与内存中的数据一一对应，可以通过位置索引快速获取某条数据的向量信息，如下图所示：</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/webp;base64,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" width="1050" height="186" class="img_ev3q"></p>
</blockquote>
<p>最后的流程图(Flat)</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748242653397-14-854b2dbbbffe8af6b1e6a08532e26649.webp" width="1080" height="816" class="img_ev3q"></p>
<p>最后的流程图(IVF)，放宽召回率，提升性能</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748242729349-17-2a9cdd350ddfde26a2e58ee500477319.webp" width="1080" height="856" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748242743071-20-64fd68119b0135d73db5463a38526ce9.webp" width="1080" height="375" class="img_ev3q"></p>
<p><strong>可见，无论是Flat还是IVF，在相同的召回率下，使用前置过滤的性能都要明显好于后置过滤。</strong></p>
<p>性能优化</p>
<ul>
<li>
<p>高并发支持，通过Cuda Stream，GPU可以并行处理多个查询请求，高并发压测下，GPU利用率可以达到100%。</p>
</li>
<li>
<p>通过GPU实现部分标量过滤功能，支持在GPU上实现部分标量过滤功能，向量计算与标量过滤同处一个Kernel，充分利用GPU并行计算能力</p>
</li>
<li>
<p><strong>资源管理优化，支持句柄机制，资源预先分配，重复利用</strong>。每个句柄持有一部分私有资源，包含保存向量检索中间计算结果的可读写内存、显存，以及单独的Cuda Stream执行流；<strong>共享一份全局只读公有资源。在初始化阶段，创建句柄对象池，可以通过控制句柄数量，来调整服务端并发能力，避免服务被打爆。在检索阶段，每次向量检索需从句柄对象池中申请一个空闲的句柄，然后进行后续的计算流程，并在执行完后释放响应的句柄，达到资源回收和重复利用的目的</strong></p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="图片" src="/assets/images/640-1748243142566-23-725fd68c9ca6aff07b382e1e9408c08b.webp" width="1080" height="367" class="img_ev3q"></p>
<blockquote>
<p>我们最终选择了单机多卡的数据分片方案，单台服务器部署多张GPU，检索时并行从本地多张GPU中检索数据，在CPU内存中进行数据合并。</p>
<p>为了支持更大规模的向量数据检索，我们还在GPU检索引擎上支持了半精度计算，使用FP16替换原来的FP32进行计算，可以节省一半的GPU显存占用，经验证Flat召回率由100%下降到99.4%，依然满足需求。使用半精度之后，单机可以加载近10亿数据，足够支撑较长时间的业务数据增长。</p>
</blockquote>
<p>GPU 检索系统上线后实际性能数据如下（数据量1亿+）：</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/webp;base64,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" width="1080" height="185" class="img_ev3q"></p>
<hr>
<p>22年还有一篇早期的搜索基于elasticsearch的优化实践</p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;mid=2651772026&amp;idx=1&amp;sn=6ff4cb024bb416c46d5d2850a6ae77d1&amp;chksm=bd120d378a6584217f1838c0f951204023e5c32b0ad413a731078e2f11f8f0009b39c3dec4ea&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;mid=2651772026&amp;idx=1&amp;sn=6ff4cb024bb416c46d5d2850a6ae77d1&amp;chksm=bd120d378a6584217f1838c0f951204023e5c32b0ad413a731078e2f11f8f0009b39c3dec4ea&amp;scene=21#wechat_redirect</a></p>
<p>但这个就很工程很机架了</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tech-blog">tech blog</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/美团">美团</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/system">system</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">notes</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/RL">课程笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/personal-essays">Personal Essays</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Ayanami, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>