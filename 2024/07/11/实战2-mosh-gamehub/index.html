<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Ayanami">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://ayanami1314.github.io/2024/07/11/实战2-mosh-gamehub/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="观前提示：  默认读者有基础的js, ts, html基础, 其中html和js在MDN Web Docs 上看入门教程即可,ts可以看mosh的视频 或者google 一下 typescript tutorial即可;  本人水平有限，错漏和不足之处敬请谅解 本笔记对应的视频： CodeWithMosh - React 18 for Beginners 对应初级部分；code with mos">
<meta property="og:type" content="article">
<meta property="og:title" content="实战2 mosh gamehub">
<meta property="og:url" content="https://ayanami1314.github.io/2024/07/11/%E5%AE%9E%E6%88%982-mosh-gamehub/index.html">
<meta property="og:site_name" content="Ayanami&#39;s Cave">
<meta property="og:description" content="观前提示：  默认读者有基础的js, ts, html基础, 其中html和js在MDN Web Docs 上看入门教程即可,ts可以看mosh的视频 或者google 一下 typescript tutorial即可;  本人水平有限，错漏和不足之处敬请谅解 本笔记对应的视频： CodeWithMosh - React 18 for Beginners 对应初级部分；code with mos">
<meta property="og:locale">
<meta property="og:image" content="c:\Users\Ayanami\AppData\Roaming\Typora\typora-user-images\image-20240116224507307.png">
<meta property="article:published_time" content="2024-07-10T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-11T15:54:49.173Z">
<meta property="article:author" content="Ayanami">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\Ayanami\AppData\Roaming\Typora\typora-user-images\image-20240116224507307.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/ayanami.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/ayanami.jpg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/ayanami.jpg">
    <!--- Page Info-->
    
    <title>
        
            实战2 mosh gamehub -
        
        Ayanami&#39;s Cave
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    

    
        
<script src="/js/libs/anime.min.js"></script>

    

    <script id="hexo-configurations">
    window.config = {"hostname":"ayanami1314.github.io","root":"/","language":"zh","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":true,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"make code matter, make life better","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/Ayanami1314","instagram":null,"zhihu":"https://www.zhihu.com/people/85-36-64-12","twitter":null,"email":"lingbo_2022@sjtu.edu.cn"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.4","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



    <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <h2 class="ml13">
        Ayanami&#39;s Cave
    </h2>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [40,0],
                translateZ: 0,
                opacity: [0,1],
                filter: ['blur(5px)', 'blur(0px)'], // Starting from blurred to unblurred
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i,
            }).add({
                targets: '.ml13 .letter',
                translateY: [0,-40],
                opacity: [1,0],
                filter: ['blur(0px)', 'blur(5px)'], // Ending from unblurred to blurred
                easing: "easeInExpo",
                duration: 1200,
                delay: (el, i) => 100 + 30 * i,
                complete: function() {
                    hidePreloader(); // Call hidePreloader after the animation completes
                }
            });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }
    </script>
</div>

<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Ayanami&#39;s Cave
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">27</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">实战2 mosh gamehub</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/ayanami.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Ayanami</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-07-11</span>
        <span class="mobile">2024-07-11</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-07-11 23:54:49</span>
            <span class="mobile">2024-07-11 23:54:49</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <blockquote>
<p>观前提示：</p>
<ol>
<li>默认读者有基础的js, ts, html基础, 其中html和js在<a class="link"   target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/" >MDN Web Docs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>上看入门教程即可,ts可以看<a class="link"   target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1s3411T7jL/?share_source=copy_web&vd_source=60f8c73d5ef551168e0bbb088ac46073" >mosh的视频 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>或者google 一下 typescript tutorial即可; </li>
<li>本人水平有限，错漏和不足之处敬请谅解</li>
<li>本笔记对应的视频： <a class="link"   target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1su4y1f7mz/?share_source=copy_web&vd_source=60f8c73d5ef551168e0bbb088ac46073" >CodeWithMosh - React 18 for Beginners <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>对应初级部分；<a class="link"   target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ph4y1V7jF/?share_source=copy_web&vd_source=60f8c73d5ef551168e0bbb088ac46073" >code with mosh - React: Intermediate Topics <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>对应进阶部分；相关代码可以在github找到。</li>
</ol>
</blockquote>
<span id="more"></span>

<p>gamehub: react + ts + …</p>
<h2 id="初级部分"><a href="#初级部分" class="headerlink" title="初级部分"></a>初级部分</h2><h3 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h3><h4 id="一切的开始-初识React"><a href="#一切的开始-初识React" class="headerlink" title="一切的开始:初识React"></a>一切的开始:初识React</h4><p>vite： 一个比create-react-app更轻量级的创建应用工具</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest</span><br></pre></td></tr></table></figure></div>



<p>然后选择react, ts</p>
<p>之后npm install, npm run dev</p>
<blockquote>
<p>ps: 笔者在后续发现，如果npm的镜像源默认改成了cnpm, （有时候）会找不到dev而报错，疑似和vite有冲突</p>
</blockquote>
<p>react,启动！</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\Ayanami\AppData\Roaming\Typora\typora-user-images\image-20240116224507307.png"
                      alt="image-20240116224507307"
                ></p>
<hr>
<p>react 使用JSX, JSX被编译成pure js（with react）</p>
<p>编写react的时候需要遵守PascalCasting, 即组件名为 AppName 而不是app_name或者appName</p>
<p>export 和 export default的区别：export default是唯一的，使得导入的时候不受命名空间冲突影响，可以起别名</p>
<p>vite自动有热启动</p>
<p>.tsx为后缀的文件可以使用JSX语法（tsx: ts+ jsx），.ts为后缀的文件不行</p>
<p>JSX暴打原始人（暴论）：回想起实战1里面，需要定义pug文件，往pug里面传参数（提前想好传哪些），在pug里面写乱七八糟的语法，相对不方便复用……</p>
<p>how react works?</p>
<p>react维护一个virtual dom（document object model）树，代码会更新这棵树，然后react将这棵树和浏览器的真实DOM树比较，并更新浏览器上的DOM</p>
<p>what is react?</p>
<p>react是“库lib”式的单个工具，而不是“框架framework”一组完善的建立网站的工具</p>
<p>react专注于建立<strong>组件式可交互UI</strong></p>
<p>但react不解决router, http, form validation, internationalization… 等等问题</p>
<p>这些在下面的内容之中（笑</p>
<p>bootstrap： 现代感UI， css库</p>
<p>在文档内搜索后复制示例代码即可</p>
<p>返回多个块</p>
<p>差的方法：使用<code><div></div></code>包裹，语法上没有问题，但是在react的DOM上多加了一个组件div</p>
<p>好的方法：使用<code><fragment></fragment></code>包裹</p>
<p>简写，使用<code><></></code>包裹</p>
<p>component 快捷键： React ES7+插件，rafce</p>
<p>JSX： 里面只能有 html元素&#x2F;React组件&#x2F;{}包裹的表达式</p>
<p>“for loop in JSX”? 不能这么干，但可以通过map方法实现</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ListGroup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [<span class="string">&quot;SJTU&quot;</span>, <span class="string">&quot;PKU&quot;</span>, <span class="string">&quot;THU&quot;</span>, <span class="string">&quot;FDU&quot;</span>];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>List Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;items.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ListGroup</span>;</span><br></pre></td></tr></table></figure></div>



<p>“if else in JSX”?也不行，但可以用表达式代替</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ListGroup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> items = [<span class="string">&quot;SJTU&quot;</span>, <span class="string">&quot;PKU&quot;</span>, <span class="string">&quot;THU&quot;</span>, <span class="string">&quot;FDU&quot;</span>];</span><br><span class="line">  items = [];</span><br><span class="line">  <span class="comment">// const Message = items.length === 0 ? &lt;p&gt;No items found&lt;/p&gt; : null;</span></span><br><span class="line">  <span class="comment">// 另一种方法</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Message</span> = items.<span class="property">length</span> === <span class="number">0</span> &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>No items found<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>; <span class="comment">// true &amp;&amp; something === something</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>List Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Message&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;items.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;item&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ListGroup</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>在使用map方法时，需要给item一个唯一的key，以便于React追踪</p>
<p>map可以有第二个可选参数index, 代表迭代时的序号</p>
<p>处理单击事件：每一个React元素都有内置的onClick方法，接受一个可选的event</p>
<p>处理函数命名规范 handleClick</p>
<p>让react意识到组件有内部状态，可能随时间变化，变化时需要更新（重新渲染）：useState</p>
<p>又叫stateHook, 通过Hook，我们可以不用直接接触DOM，而专注于组件和它的状态</p>
<p>把上面的知识组合起来的应用：<strong>动态添加类</strong>，鼠标激活效果实现</p>
<blockquote>
<p> ps: 动态添加类是解释性语言，如js,python的专属; 这样添加active效果实际上也算是自定义active实现的方法</p>
</blockquote>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListGroup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> items = [<span class="string">&quot;SJTU&quot;</span>, <span class="string">&quot;PKU&quot;</span>, <span class="string">&quot;THU&quot;</span>, <span class="string">&quot;FDU&quot;</span>];</span><br><span class="line">  <span class="keyword">const</span> [selectIndex, setSelectIndex] = <span class="title function_">useState</span>(-<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Message</span> = items.<span class="property">length</span> === <span class="number">0</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>No items found<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>List Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Message&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;items.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">selectIndex</span> === <span class="string">index</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                ? &quot;<span class="attr">list-group-item</span> <span class="attr">active</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">:</span> &quot;<span class="attr">list-group-item</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&#123;item&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setSelectIndex(index)&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            &#123;item&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ListGroup</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>让组件可重用：props</p>
<p>刚好可以写成ts的interface</p>
<p><strong>props is immutable</strong>： 传入的参数可以认为是某种”复制”，不应该直接在子组件之中修改Props，（直接改了也不会反映到父组件上），如果要根据子组件改父组件状态，把父组件的setState作为回调函数传下来</p>
<p>如果父组件想从子组件得到信息？例如，选择？</p>
<p>React并没有提供组件书“自底向上”传递信息的方法，这样的“将顶层逻辑下放到可重用的子组件”也破坏了子组件的重用性；实现方法应该放在父组件，在传递的props里面多加一个函数参数，让子组件得到信息之后调用这个父组件定义的函数，还是自顶向下传递。</p>
<p>示例：</p>
<p>App.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ListGroup</span> <span class="keyword">from</span> <span class="string">&quot;./components/ListGroup&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> schools = [<span class="string">&quot;PKU&quot;</span>, <span class="string">&quot;FDU&quot;</span>, <span class="string">&quot;THU&quot;</span>, <span class="string">&quot;ZJU&quot;</span>, <span class="string">&quot;SJTU&quot;</span>];</span><br><span class="line">  <span class="keyword">let</span> cities = [<span class="string">&quot;Beijing&quot;</span>, <span class="string">&quot;Shanghai&quot;</span>, <span class="string">&quot;Hangzhou&quot;</span>, <span class="string">&quot;Nanjing&quot;</span>, <span class="string">&quot;Wuhan&quot;</span>];</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onSelectItem</span> = (<span class="params"><span class="attr">item</span>: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ListGroup</span> <span class="attr">title</span>=<span class="string">&quot;Schools&quot;</span> <span class="attr">items</span>=<span class="string">&#123;schools&#125;</span> <span class="attr">onSelectItem</span>=<span class="string">&#123;onSelectItem&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ListGroup</span> <span class="attr">title</span>=<span class="string">&quot;Cities&quot;</span> <span class="attr">items</span>=<span class="string">&#123;cities&#125;</span> <span class="attr">onSelectItem</span>=<span class="string">&#123;onSelectItem&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>ListGroup.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ListGroupProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">items</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">onSelectItem</span>: <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListGroup</span>(<span class="params">&#123; items, title, onSelectItem &#125;: <span class="title class_">ListGroupProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [selectIndex, setSelectIndex] = <span class="title function_">useState</span>(-<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Message</span> = items.<span class="property">length</span> === <span class="number">0</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>No items found<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Message&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;items.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">selectIndex</span> === <span class="string">index</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                ? &quot;<span class="attr">list-group-item</span> <span class="attr">active</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">:</span> &quot;<span class="attr">list-group-item</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&#123;item&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              setSelectIndex(index);</span></span><br><span class="line"><span class="language-xml">              onSelectItem(item);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            &#123;item&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ListGroup</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>传递文本和html?</p>
<p>直接props：略丑</p>
<p><strong>使用children:ReactNode的interface</strong></p>
<p>例：</p>
<p>App.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Alert</span> <span class="keyword">from</span> <span class="string">&quot;./components/Alert&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Alert</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Note:<span class="tag">&lt;/<span class="name">p</span>&gt;</span>This is a Alert</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Alert</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Alert.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AlertProps</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Alert</span> = (<span class="params">&#123; children &#125;: <span class="title class_">AlertProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;alert alert-danger&quot;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Alert</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>react-developer-tool</p>
<p>组件重用示例2</p>
<p>Button.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="built_in">string</span>;</span><br><span class="line">  color?:</span><br><span class="line">    | <span class="string">&quot;primary&quot;</span></span><br><span class="line">    | <span class="string">&quot;secondary&quot;</span></span><br><span class="line">    | <span class="string">&quot;success&quot;</span></span><br><span class="line">    | <span class="string">&quot;warning&quot;</span></span><br><span class="line">    | <span class="string">&quot;danger&quot;</span></span><br><span class="line">    | <span class="string">&quot;info&quot;</span></span><br><span class="line">    | <span class="string">&quot;light&quot;</span></span><br><span class="line">    | <span class="string">&quot;dark&quot;</span>;</span><br><span class="line">  onClick?: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">  color = <span class="string">&quot;primary&quot;</span>,</span></span><br><span class="line"><span class="params">  onClick = () =&gt; &#123;</span></span><br><span class="line"><span class="params">    <span class="variable language_">console</span>.log(<span class="string">&quot;Clicked&quot;</span>);</span></span><br><span class="line"><span class="params">  &#125;,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">ButtonProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&quot;<span class="attr">btn</span> <span class="attr">btn-</span>&quot; + <span class="attr">color</span>&#125; <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>App.tsx</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&quot;./components/Button&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">children</span>=<span class="string">&quot;a&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">children</span>=<span class="string">&quot;b&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">children</span>=<span class="string">&quot;c&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="Styling-更进一步的CSS"><a href="#Styling-更进一步的CSS" class="headerlink" title="Styling: 更进一步的CSS"></a>Styling: 更进一步的CSS</h4><p>plain css: not recommended</p>
<p>css module:用于解决多个css同名类的冲突覆盖问题。 .css文件变成 .module.css文件，里面定义的css类变成整个module对象的属性，可以通过 import {style} from “.&#x2F;sth.module.css” 之后 style[“some-css-class”]使用</p>
<p>如果需要一个模块的多个css类，使用 [style[‘classA’], style[‘classB’]].join(‘ ‘)语法</p>
<p>CSS in JS： styled-component</p>
<p>Seperation of Concerns 原则：把复杂度隐藏在接口之下，一个模块的复杂度不应该暴露在外面</p>
<p>inline CSS: not recommended also</p>
<p><strong>有用的热门CSS库(个人只会调库，笑)</strong></p>
<ul>
<li>bootstrap</li>
<li>Material UI</li>
<li>tailwind</li>
<li>chakra UI</li>
<li>……</li>
</ul>
<p>添加icon: react-icon库, font awesome icon</p>
<hr>
<h4 id="Managing-Component-State"><a href="#Managing-Component-State" class="headerlink" title="Managing Component State"></a>Managing Component State</h4><p>NOTE：</p>
<ol>
<li>React 更新State是异步的 async</li>
<li>state 实际存储在组件之外</li>
<li>only use hook at the top level of function: Hook不能被放在 条件，循环等等之中</li>
</ol>
<p>BEST PRACTICE：</p>
<ol>
<li>避免冗余state</li>
<li><strong>使用对象将相关的state套起来</strong>是好的，但不要深度嵌套</li>
</ol>
<blockquote>
<p> ps: 后补:第二点可能比较抽象，详细说就是，如果我的组件取决于一个state game, 然后game可能有多个需要维护的state例如price，id, … 与其把price， id,…分别使用setState，不如只设一个State，就是game, 也就是说useState可以接受一个复制的对象作为state而不局限于基本类型。</p>
<p>而“不要深度嵌套”是因为，这样包含了多个属性的state每次更新都要 用<code>...</code>复制一次（React检测作为对象的State变化并不会深入下去比较对象内部的每一个值，所以传入新的State的时候需要传入一个新的对象），例如<code>useState([...game, newPrice: 20])</code>, 而game如果是对象套对象，那就要再多一层<code>...</code> ……深起来既浪费，又不好维护</p>
</blockquote>
<p>KEEPING COMPONENT PURE:</p>
<p>ReactDOM的strictMode 会检测不纯的组件，并执行两次</p>
<p>在state是一个对象的时候，React并不会实时检测这个对象的变化，视为immutable</p>
<p>所以如果要将一个drink对象的price属性改变</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Incorrect</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    drink.<span class="property">price</span> = <span class="number">6</span>;</span><br><span class="line">    <span class="title function_">setDrink</span>(drink); <span class="comment">// false: React不会比对drink对象的属性有改变，当传递的还是原来的drink对象的时候，ReactDOM就不会重新渲染</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Correct</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> newDrink = &#123;</span><br><span class="line">		...drink, <span class="comment">// 复制原先drink对象的属性</span></span><br><span class="line">        <span class="attr">price</span>: <span class="number">6</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">setDrink</span>(newDrink); <span class="comment">//这样drink对象本身改变了，ReactDOM重新渲染</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>ATTENTION：</strong></p>
<p><strong>如果对象里面嵌套对象，由于…复制对象属性的时候对对象元素默认是浅复制，需要在嵌套的对象里面也使用…来避免修改原来对象的值</strong></p>
<p>对于state是数组的情况同理</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [arr, setArr] = <span class="title function_">useState</span>([<span class="number">0</span>,<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">// 不使用arr.push()方法</span></span><br><span class="line">    <span class="keyword">let</span> newEle = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// Add</span></span><br><span class="line">    <span class="title function_">setArr</span>([...arr, newEle]);</span><br><span class="line">    <span class="comment">// Remove</span></span><br><span class="line">    <span class="title function_">serArr</span>([arr.<span class="title function_">filter</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele !== <span class="number">0</span>)]);</span><br><span class="line">    <span class="comment">// Update</span></span><br><span class="line">    <span class="title function_">setArr</span>([arr.<span class="title function_">map</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele === <span class="number">0</span>? <span class="number">1</span>: ele)])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>sharing state between component: 把需要在组件中共享的state在组件层次架构里面向上提升一级</p>
<p>练习，可折叠文字</p>
<p>生成随机字符串 lorem + 一个数， 比如lorem200，生成长为200个字符的随机字符串</p>
<hr>
<h4 id="Forms表单"><a href="#Forms表单" class="headerlink" title="Forms表单"></a>Forms表单</h4><p>React Hook Forms &amp;&amp; Zod</p>
<h5 id="基础表单"><a href="#基础表单" class="headerlink" title="基础表单"></a>基础表单</h5><p>表单的基础和bootstrap里面的表单, div.md-3&gt;lable.form-label+input.form-control + [TAB]的简写格式</p>
<p>（<code>.</code>是类<code>className</code>，<code>+</code>是并列， <code>&gt;</code>是包含（子组件），<code>*</code>是多个）</p>
<blockquote>
<p>在React中，你可以通过将<code>&lt;button&gt;</code>元素放入<code>&lt;form&gt;</code>元素内部，并设置<code>type=&quot;submit&quot;</code>，来将按钮的点击事件与表单的提交事件绑定。当点击这个按钮时，表单的<code>onSubmit</code>事件将被触发。</p>
<p>你需要在<code>&lt;form&gt;</code>元素上添加一个<code>onSubmit</code>事件处理器来处理表单提交</p>
</blockquote>
<p>React useRef</p>
<p>useRef产生一个React元素（DOM Node）的引用</p>
<p>直接看具体代码</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> nameRef = useRef&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onSubmit</span>=<span class="string">&#123;(event)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          event.preventDefault();</span></span><br><span class="line"><span class="language-xml">          console.log(nameRef.current?.value);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;name&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Name</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;nameRef&#125;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;age&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-lable&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              Age</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Submit</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Form</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>但上述代码有一个问题</p>
<blockquote>
<p>在React中，<code>useRef</code>创建的引用（reference）的变化不会触发组件的重新渲染。这是因为<code>useRef</code>返回的对象在组件的所有渲染中保持不变，所以React不会知道引用的值已经改变。</p>
</blockquote>
<p>所以要是需要重新渲染，还得是useState,引出了下面的技术</p>
<p>controlled components</p>
<p>主要解决使用useState和onChange方法来控制state时候，不同组件同时修改一个state的异步问题</p>
<p>解决方法，在组件加一个 value&#x3D;{obj.value},每次调用前先同步，把组件状态的管理转交给React</p>
<blockquote>
<p>const [state, setState]&#x3D;useState(…);    </p>
<p>…</p>
<p>&lt;Component value&#x3D;{state}</p>
<p>onChange&#x3D;{handleStateChange} &#x2F;&gt;</p>
</blockquote>
<p>更简单：使用react-hook-form库</p>
<div class="highlight-container" data-rel="Ts"><figure class="iseeu highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldValues</span>, useForm &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; register, handleSubmit &#125; = <span class="title function_">useForm</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"><span class="attr">data</span>: <span class="title class_">FieldValues</span></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit(onSubmit)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;name&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Name</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...register</span>(&quot;<span class="attr">name</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;age&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-lable&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              Age</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &#123;<span class="attr">...register</span>(&quot;<span class="attr">age</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">id</span>=<span class="string">&quot;age&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Submit</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Form</span>;</span><br></pre></td></tr></table></figure></div>



<h5 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h5><p>react-hook-form的register可以有第二个参数，一个对象</p>
<div class="highlight-container" data-rel="Typescript"><figure class="iseeu highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldValues</span>, useForm &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    register,</span><br><span class="line">    handleSubmit,</span><br><span class="line">    <span class="attr">formState</span>: &#123; errors &#125;,</span><br><span class="line">  &#125; = <span class="title function_">useForm</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(errors);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"><span class="attr">data</span>: <span class="title class_">FieldValues</span></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit(onSubmit)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;name&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Name</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...register</span>(&quot;<span class="attr">name</span>&quot;, &#123; <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">minLength:</span> <span class="attr">3</span> &#125;)&#125;  // <span class="attr">这里</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;errors.name?.type === &quot;required&quot; &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>You must give a name.<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;errors.name?.type === &quot;minLength&quot; &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>The length of name must be longer than 3 characters.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          )&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;age&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-lable&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              Age</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &#123;<span class="attr">...register</span>(&quot;<span class="attr">age</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">id</span>=<span class="string">&quot;age&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Submit</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Form</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>基于模式的验证：Zod + @hookhome&#x2F;resolvers  看代码</p>
<p>需要注意的是，这并不是实时的，需要submit才会有error，如果同时启用了下面的invalid不submit和这个, 这个相当于没设置</p>
<div class="highlight-container" data-rel="Ts"><figure class="iseeu highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldValues</span>, useForm &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&quot;zod&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; zodResolver &#125; <span class="keyword">from</span> <span class="string">&quot;@hookform/resolvers/zod&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> schema = z.<span class="title function_">object</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: z.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">3</span>, &#123; <span class="attr">message</span>: <span class="string">&quot;Name must be at least 3 characters&quot;</span> &#125;),</span><br><span class="line">  <span class="attr">age</span>: z.<span class="title function_">number</span>(&#123; <span class="attr">invalid_type_error</span>: <span class="string">&quot;Age field is required&quot;</span> &#125;).<span class="title function_">min</span>(<span class="number">18</span>),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FormData</span> = z.<span class="property">infer</span>&lt;<span class="keyword">typeof</span> schema&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    register,</span><br><span class="line">    handleSubmit,</span><br><span class="line">    <span class="attr">formState</span>: &#123; errors, isValid &#125;,</span><br><span class="line">  &#125; = useForm&lt;<span class="title class_">FormData</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">resolver</span>: <span class="title function_">zodResolver</span>(schema),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(errors);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"><span class="attr">data</span>: <span class="title class_">FieldValues</span></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit(onSubmit)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;name&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Name</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...register</span>(&quot;<span class="attr">name</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;errors.name &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;errors.name.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;age&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              Age</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &#123;<span class="attr">...register</span>(&quot;<span class="attr">age</span>&quot;), &#123; <span class="attr">valueAsNumber:</span> <span class="attr">true</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">id</span>=<span class="string">&quot;age&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;errors.age &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;errors.age.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Submit</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Form</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>用淘宝源，SJTUG没有； 装@hookhome&#x2F;resolvers的时候记得打””（<code> npm --registry <a class="link"   target="_blank" rel="noopener" href="https://registry.npm.taobao.org/" >https://registry.npm.taobao.org <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> install "@hookform/resolvers"</code>）,避免和手动指定源的 “&#x2F;” 混一起</p>
<p>禁用submit,   </p>
<div class="highlight-container" data-rel="Ts"><figure class="iseeu highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    register,</span><br><span class="line">    handleSubmit,</span><br><span class="line">    <span class="attr">formState</span>: &#123; errors, isValid &#125;,</span><br><span class="line">  &#125; = <span class="title function_">useForm</span>();</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span>=<span class="string">&#123;!isValid&#125;</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div>





<p>给useState加类型</p>
<p><code>useState&lt;Type&gt;</code></p>
<p>导出类型 export type</p>
<h5 id="练习：记账本"><a href="#练习：记账本" class="headerlink" title="练习：记账本"></a>练习：记账本</h5><p>非常好的练习，和TodoList一个实现道理，最好自己试着做一做</p>
<p>个人实现（后面回来看感觉很多地方没写好）：</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FormDataType.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&quot;zod&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Category</span> = <span class="string">&quot;All Categories&quot;</span> | <span class="string">&quot;Groceries&quot;</span> | <span class="string">&quot;Utilities&quot;</span> | <span class="string">&quot;Entertainment&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> schema = z.<span class="title function_">object</span>(&#123;</span><br><span class="line">  <span class="attr">description</span>: z.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">3</span>),</span><br><span class="line">  <span class="attr">amount</span>: z</span><br><span class="line">    .<span class="title function_">number</span>(&#123; <span class="attr">invalid_type_error</span>: <span class="string">&quot;Amount field is required&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">positive</span>(),</span><br><span class="line">  <span class="attr">category</span>: z.<span class="title function_">enum</span>([</span><br><span class="line">    <span class="string">&quot;All Categories&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Groceries&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Utilities&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Entertainment&quot;</span>,</span><br><span class="line">  ]),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ExpenseFormData</span> = z.<span class="property">infer</span>&lt;<span class="keyword">typeof</span> schema&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; schema &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> &#123; <span class="title class_">ExpenseFormData</span>, <span class="title class_">Category</span> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ExpenseForm</span> <span class="keyword">from</span> <span class="string">&quot;./ExpenseForm&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExpenseFormData</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./FormDataType&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FilterTable</span> <span class="keyword">from</span> <span class="string">&quot;./FilterTable&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ExpenseTracker</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [dataArr, setDataArr] = useState&lt;<span class="title class_">ExpenseFormData</span>[]&gt;([]);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">pushCallback</span> = (<span class="params"><span class="attr">newData</span>: <span class="title class_">ExpenseFormData</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setDataArr</span>([...dataArr, newData]);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">deleteCallback</span> = (<span class="params"><span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setDataArr</span>(dataArr.<span class="title function_">filter</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> i !== index));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ExpenseForm</span> <span class="attr">dataArr</span>=<span class="string">&#123;dataArr&#125;</span> <span class="attr">pushCallback</span>=<span class="string">&#123;pushCallback&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">FilterTable</span> <span class="attr">dataArr</span>=<span class="string">&#123;dataArr&#125;</span> <span class="attr">callback</span>=<span class="string">&#123;deleteCallback&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ExpenseTracker</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FilterTable.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExpenseFormData</span>, <span class="title class_">Category</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./FormDataType&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FilterTableProps</span> &#123;</span><br><span class="line">  <span class="attr">dataArr</span>: <span class="title class_">ExpenseFormData</span>[];</span><br><span class="line">  <span class="attr">callback</span>: <span class="function">(<span class="params"><span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">FilterTable</span> = (<span class="params">&#123; dataArr, callback &#125;: <span class="title class_">FilterTableProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [filterSelection, setFilter] = useState&lt;<span class="title class_">Category</span>&gt;(<span class="string">&quot;All Categories&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleFilterChange</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">React</span>.<span class="title class_">ChangeEvent</span>&lt;<span class="title class_">HTMLSelectElement</span>&gt;</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setFilter</span>(event.<span class="property">target</span>.<span class="property">value</span> <span class="keyword">as</span> <span class="title class_">Category</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;filterSelection&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;handleFilterChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;form-select&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">aria-label</span>=<span class="string">&quot;Category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>&gt;</span>All Categories<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Groceries&quot;</span>&gt;</span>Groceries<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Utilities&quot;</span>&gt;</span>Utilities<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Entertainment&quot;</span>&gt;</span>Entertainment<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">className</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>Description<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>Amount<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>Categories<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;dataArr.map((data: ExpenseFormData, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            return (</span></span><br><span class="line"><span class="language-xml">              (filterSelection === &quot;All Categories&quot; ||</span></span><br><span class="line"><span class="language-xml">                data.category === filterSelection) &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&#123;</span>&quot;<span class="attr">row</span>&quot;&#125;&gt;</span>&#123;index + 1&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;data.description&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;data.amount&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;data.category&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> callback(index)&#125;</span></span><br><span class="line"><span class="language-xml">                      className=&quot;btn btn-warning&quot;</span></span><br><span class="line"><span class="language-xml">                    &gt;</span></span><br><span class="line"><span class="language-xml">                      Delete</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              )</span></span><br><span class="line"><span class="language-xml">            );</span></span><br><span class="line"><span class="language-xml">          &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&#123;</span>&quot;<span class="attr">row</span>&quot;&#125;&gt;</span>Total<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;dataArr.reduce((total, cur) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                if (</span></span><br><span class="line"><span class="language-xml">                  filterSelection === &quot;All Categories&quot; ||</span></span><br><span class="line"><span class="language-xml">                  cur.category === filterSelection</span></span><br><span class="line"><span class="language-xml">                ) &#123;</span></span><br><span class="line"><span class="language-xml">                  return total + cur.amount;</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">                return total;</span></span><br><span class="line"><span class="language-xml">              &#125;, 0)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">FilterTable</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ExpenseForm.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldValues</span>, useForm &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; zodResolver &#125; <span class="keyword">from</span> <span class="string">&quot;@hookform/resolvers/zod&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; schema &#125; <span class="keyword">from</span> <span class="string">&quot;./FormDataType&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExpenseFormData</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./FormDataType&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExpenseFormProps</span> &#123;</span><br><span class="line">  <span class="attr">dataArr</span>: <span class="title class_">ExpenseFormData</span>[];</span><br><span class="line">  <span class="attr">pushCallback</span>: <span class="function">(<span class="params"><span class="attr">newData</span>: <span class="title class_">ExpenseFormData</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ExpenseForm</span> = (<span class="params">&#123; dataArr, pushCallback &#125;: <span class="title class_">ExpenseFormProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    register,</span><br><span class="line">    handleSubmit,</span><br><span class="line">    <span class="attr">formState</span>: &#123; errors, isValid &#125;,</span><br><span class="line">  &#125; = useForm&lt;<span class="title class_">ExpenseFormData</span>&gt;(&#123; <span class="attr">resolver</span>: <span class="title function_">zodResolver</span>(schema) &#125;);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"><span class="attr">data</span>: <span class="title class_">FieldValues</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">      <span class="title function_">pushCallback</span>(data <span class="keyword">as</span> <span class="title class_">ExpenseFormData</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(dataArr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit(onSubmit)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;Description&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Description</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...register</span>(&quot;<span class="attr">description</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;Description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;errors.description &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;errors.description.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;Amount&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Amount</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...register</span>(&quot;<span class="attr">amount</span>&quot;, &#123; <span class="attr">valueAsNumber:</span> <span class="attr">true</span> &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;Amount&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;errors.amount &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;errors.amount.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;<span class="attr">...register</span>(&quot;<span class="attr">category</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&quot;form-select&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">aria-label</span>=<span class="string">&quot;Category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>&gt;</span>All Categories<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Groceries&quot;</span>&gt;</span>Groceries<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Utilities&quot;</span>&gt;</span>Utilities<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Entertainment&quot;</span>&gt;</span>Entertainment<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;errors.category &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;errors.category.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Submit</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ExpenseForm</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>看视频，上面的一些缺点：</p>
<ul>
<li>type还是有一些耦合，category应该独立出来成为单独的模块</li>
<li>可以继续调css, 美观度不足（e.g 使用mb-3 mb-5 class 加边框，改validation text颜色等等）</li>
</ul>
<hr>
<h3 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h3><ul>
<li>Express</li>
<li>Django</li>
<li>Ruby on Rail</li>
<li>Spring</li>
<li>ASP.NET</li>
<li>……</li>
</ul>
<h4 id="链接React和后端"><a href="#链接React和后端" class="headerlink" title="链接React和后端"></a>链接React和后端</h4><h5 id="useEffect-和-Effect-Hook"><a href="#useEffect-和-Effect-Hook" class="headerlink" title="useEffect 和 Effect Hook"></a>useEffect 和 Effect Hook</h5><p>为什么需要useEffect：</p>
<blockquote>
<p>React引入<code>useEffect</code>是为了在函数组件中处理副作用。在React中，副作用包括数据获取、订阅或手动修改DOM等操作。这些操作都会在组件渲染之后执行，可能会影响组件之外的事物。</p>
</blockquote>
<p>例如一个窗口组件，需要检测它是否获取到焦点，如果我手动处理，就必须在窗口函数之中记录和维护焦点信息，而这和React的设计逻辑——一个只关注渲染的组件相违背</p>
<p>而使用了useEffect之后，焦点相关的代码实质上被独立出ReactDOM, 而窗口组件重新成为纯函数，<strong>在DOM渲染完毕之后，React检测useEffect生效与否，最后执行副作用</strong>，保证了副作用的执行顺序，使得整个App最后依然是纯函数</p>
<p>例：（这个例子并不实际，因为浏览器默认有聚焦行为覆盖了这个代码，不需要这样手动加，并且这样也只是在第一次点击的时候有聚焦）</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">FocusInput</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ref.<span class="property">current</span>?.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;md-3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">className</span>=<span class="string">&quot;form-control&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">FocusInput</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>useEffect接受两个参数，第一个是回调函数，第二个是控制何时执行的对象——只有当该对象改变时，useEffect才会执行回调函数</p>
<p>如果只执行一次，传入一个空数组</p>
<p>如果第二个参数什么都不传递，那么每次组件重新渲染的时候，react都会调用回调函数，如果回调函数之中又有setState，就成功的无限循环了（</p>
<p>useEffect Clean up: useEffect的第一个参数（回调函数f）可以有非空返回值，返回另一个函数g时，当屏幕上unmount该组件时，该函数(g)会被调用，一般用于清理</p>
<h5 id="Fetching-Data"><a href="#Fetching-Data" class="headerlink" title="Fetching Data"></a>Fetching Data</h5><p>JSON Place Holder</p>
<p>Sending HTTP Request: </p>
<ul>
<li>原生Fetch方法</li>
<li><strong>Axios库 [recommended]</strong></li>
</ul>
<p><strong>Promise: A promise is an object that holds the eventual result or failure of an asynchronous operation</strong></p>
<p>promise有一个then() 方法，用于执行回调函数</p>
<p><strong>Handling Errors</strong></p>
<p>promise有一个catch()方法，捕获错误，执行回调</p>
<p>示例代码：</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [users, setUsers] = useState&lt;<span class="title class_">User</span>[]&gt;([]);</span><br><span class="line">  <span class="keyword">const</span> [err, setError] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios</span><br><span class="line">      .<span class="title function_">get</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">setUsers</span>(res.<span class="property">data</span>))</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">setError</span>(err.<span class="property">message</span>));</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;err &amp;&amp; <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span> &#123;err&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;users.map((user) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;user.id&#125;</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>还有一种方法是使用async 和 await，但略繁琐</p>
<blockquote>
<p> ps:实际上then和catch好像是后面才提出来的语法糖（</p>
</blockquote>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchUsers</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axios.<span class="title function_">get</span>(</span><br><span class="line">        <span class="string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span></span><br><span class="line">      );</span><br><span class="line">      <span class="title function_">setUsers</span>(res.<span class="property">data</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="title function_">setError</span>((err <span class="keyword">as</span> <span class="title class_">AxiosError</span>).<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">fetchUsers</span>();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure></div>





<p>当用户离开此页怎么办？不再需要Fetch data，使用先前提到的useEffect Clean up</p>
<p>使用Controller</p>
<p>AbortController class，浏览器内置，允许取消或中止异步操作</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  axios</span><br><span class="line">    .<span class="title function_">get</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span>， &#123;<span class="attr">signal</span>: controller.<span class="property">signal</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">setUsers</span>(res.<span class="property">data</span>))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">CanceledError</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="title function_">setError</span>(err.<span class="property">message</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure></div>



<p>Loading效果：测试，在network选项卡里面加throtting模拟慢速情况</p>
<p>在两个组件之间加点空白 </p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ComponentA</span> /&gt;&#123;<span class="string">&quot; &quot;</span>&#125;&lt;<span class="title class_">ComponentB</span> /&gt;</span><br></pre></td></tr></table></figure></div>



<p>更优的处理，使用ListGroup类和flex类来调整空间布局</p>
<h5 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h5><p>删除Delete：delete</p>
<p>乐观更新&#x2F;悲观更新：先更新UI响应（预计Server更新会成功）还是先更新Server数据（预计Server更新会失败）</p>
<p><strong>一般为了用户体验会选择乐观更新</strong></p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onDelete</span> = (<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> originalUsers = [...users];</span><br><span class="line">  <span class="title function_">setUsers</span>(users.<span class="title function_">filter</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> user.<span class="property">id</span> !== id));</span><br><span class="line">  <span class="comment">// 先setUsers再让server delete，乐观更新</span></span><br><span class="line">  axios</span><br><span class="line">    .<span class="title function_">delete</span>(<span class="string">`https://jsonplaceholder.typicode.com/xusers/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setError</span>(err.<span class="property">message</span>);</span><br><span class="line">      <span class="title function_">setUsers</span>(originalUsers); <span class="comment">// 错误时要回到原始状态</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>



<p>创建Create: post</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span>, newUser).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>setUsers[res.<span class="property">data</span>, ...users]).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setError</span>(err.<span class="property">message</span>);</span><br><span class="line">    <span class="title function_">setUsers</span>(originalUsers); </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>



<p>更新Update: put&#x2F;patch</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onUpdate</span> = (<span class="params"><span class="title class_">User</span>: <span class="title class_">User</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> originalUsers = [...users];</span><br><span class="line">  <span class="keyword">const</span> newUser = &#123; ...<span class="title class_">User</span>, <span class="attr">name</span>: <span class="title class_">User</span>.<span class="property">name</span> + <span class="string">&quot;!&quot;</span> &#125;;</span><br><span class="line">  <span class="title function_">setUsers</span>(users.<span class="title function_">map</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> (user.<span class="property">id</span> === <span class="title class_">User</span>.<span class="property">id</span> ? newUser : user)));</span><br><span class="line">  axios</span><br><span class="line">    .<span class="title function_">patch</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/users/&quot;</span> + <span class="title class_">User</span>.<span class="property">id</span>, newUser)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setError</span>(err.<span class="property">message</span>);</span><br><span class="line">      <span class="title function_">setUsers</span>(originalUsers);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>



<p>A reusable API client： 思考怎么重构解耦</p>
<p>将axios 和baseURL 放到service文件夹里面去</p>
<p>进一步，再把整个HTTPRequest的逻辑放到userService里面去</p>
<p>再进一步，使用泛型把userService的逻辑放到HTTPService里面去</p>
<p>再进一步，一堆Hook可以放到一个大的自定义Hook里面去</p>
<p>一个Hook没什么神奇的，就是一个导出{obj, setObj, …}的函数组件，只要它的内部还是useState之类，就不需要探知到React的底层DOM</p>
<hr>
<h3 id="Build-A-Project"><a href="#Build-A-Project" class="headerlink" title="Build A Project!"></a>Build A Project!</h3><h4 id="流程实录"><a href="#流程实录" class="headerlink" title="流程实录"></a>流程实录</h4><p><strong>如果想做的最好对着mosh的视频做，这里只是杂乱的一点做的笔记</strong></p>
<p>chakra UI:  官网找vite下载版本，然后ChakraProvider包裹App</p>
<blockquote>
<p>ps: 如果chakra UI 引入的组件报错 “Expression produces a union type that is too complex to represent.”， 别慌，能正常运行，这是ts版本不匹配导致的， 参见<a class="link"   target="_blank" rel="noopener" href="https://stackoverflow.com/questions/74847053/how-to-fix-expression-produces-a-union-type-that-is-too-complex-to-represent-t%EF%BC%8C" >https://stackoverflow.com/questions/74847053/how-to-fix-expression-produces-a-union-type-that-is-too-complex-to-represent-t， <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 将ts版本降为工作区版本即可</p>
</blockquote>
<p>前端部分：</p>
<p>Grid: <a class="link"   target="_blank" rel="noopener" href="https://chakra-ui.com/docs/components/grid/usage" >https://chakra-ui.com/docs/components/grid/usage <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>1fr： 一个分数单位</p>
<blockquote>
<p>在 CSS Grid 中，<code>fr</code> 是一个单位，代表 “fractional unit”（分数单位）。它用于分配可用空间。</p>
<p>如果你设置 <code>grid-template-columns: repeat(5, 1fr);</code>，这意味着你想要创建五列，每列的宽度都是可用空间的一个等份。例如，如果可用空间是 500px，那么每列的宽度就是 100px。</p>
</blockquote>
<p>针对移动端和大屏幕设计UI， F12模拟移动端</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reactLogo <span class="keyword">from</span> <span class="string">&quot;./assets/react.svg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Grid</span>, <span class="title class_">GridItem</span>, <span class="title class_">Show</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@chakra-ui/react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> templateAreas = &#123;</span><br><span class="line">    <span class="attr">base</span>: <span class="string">`&quot;nav&quot; &quot;main&quot;`</span>, <span class="comment">// 移动端小屏幕没有aside侧边栏</span></span><br><span class="line">    <span class="attr">lg</span>: <span class="string">`&quot;nav nav&quot; &quot;aside main&quot;`</span>, <span class="comment">// &gt; 1000px</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">templateAreas</span>=<span class="string">&#123;templateAreas&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;nav&quot;</span> <span class="attr">bg</span>=<span class="string">&quot;coral&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Nav</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Show</span> <span class="attr">above</span>=<span class="string">&quot;lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;aside&quot;</span> <span class="attr">bg</span>=<span class="string">&quot;gold&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Aside</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Show</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;main&quot;</span> <span class="attr">bg</span>=<span class="string">&quot;dodgerblue&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Main</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>theme：colormode</p>
<p>使用colorMode来实现暗色模式和亮色模式的切换（切完F12-&gt; App-&gt; storage，清除local storage的颜色mode验证）</p>
<p>使用useColorMode和Switch来做开关</p>
<p>使用Hstack 和 justify-content来调整位置</p>
<p>FetchGames:</p>
<p>查官方api文档，axios 建一个 api-client (create方法， baseURL + key), 然后再用get方法 fetch 数据</p>
<p>GameCard &amp;&amp; GameGrid: 使用SimpleGrid &amp;&amp; Card组件</p>
<p>移动端适配：不硬编码column，传入一个对象{sm: 1, md: 2, lg: 3, xl: 5}</p>
<p>添加图标：使用第三方图标库 <a class="link"   target="_blank" rel="noopener" href="https://chakra-ui.com/docs/components/icon/usage#using-a-third-party-icon-library" >https://chakra-ui.com/docs/components/icon/usage#using-a-third-party-icon-library <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>先从API拿到slug（全小写名字），再写一个map函数来对应图标</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">IconMap</span>: &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="title class_">IconType</span> &#125; = &#123;</span><br><span class="line">  <span class="attr">pc</span>: <span class="title class_">FaWindows</span>,</span><br><span class="line">  <span class="attr">playstation</span>: <span class="title class_">FaPlaystation</span>,</span><br><span class="line">  <span class="attr">xbox</span>: <span class="title class_">FaXbox</span>,</span><br><span class="line">  <span class="attr">nintendo</span>: <span class="title class_">SiNintendo</span>,</span><br><span class="line">  <span class="attr">mac</span>: <span class="title class_">FaApple</span>,</span><br><span class="line">  <span class="attr">ios</span>: <span class="title class_">MdPhoneIphone</span>,</span><br><span class="line">  <span class="attr">linux</span>: <span class="title class_">FaLinux</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>



<p>注意&#x3D;和…在传递props时候的区别</p>
<p>props&#x3D;{} ，传递的是一个对象； …传递的是对象里面所有的属性</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        &lt;<span class="title class_">PlatformIconList</span></span><br><span class="line">          &#123;...(game.<span class="property">platforms</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">platform</span>) <span class="keyword">as</span> <span class="title class_">Platform</span>[])&#125;</span><br><span class="line">        /&gt; <span class="comment">// 传递的是表达式对象里面的数组展开后的结果</span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">PlatformIconList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">platforms</span>=<span class="string">&#123;(game.platforms.map((item)</span> =&gt;</span> item.platform) as Platform[])&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span> <span class="comment">// 传递的是一个数组用&#123;&#125;包裹后的对象</span></span><br><span class="line"><span class="comment">// 用那种取决于子组件接受的是一个对象还是一个数组，一般是在子组件定义一个接口，然后接受一个对象，并用解构接收</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PlatformIconListProps</span> &#123;</span><br><span class="line">  <span class="attr">platforms</span>: <span class="title class_">Platform</span>[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PlatformIconList</span> = (<span class="params">&#123; platforms &#125;: <span class="title class_">PlatformIconListProps</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 类似这样，这样在传递的时候就是传一个数组用&#123;&#125;包裹后的对象，即=语法</span></span><br></pre></td></tr></table></figure></div>



<p>添加评分</p>
<p>Badge(徽章)类</p>
<p>添加加载时骨架</p>
<p>skeleton类</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://chakra-ui.com/docs/components/skeleton/usage" >https://chakra-ui.com/docs/components/skeleton/usage <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>refactor：将重复的样式提出成为一个GameCardContainer组件</p>
<p>fetch the genres： 类似useGames的custom hook，取来数据之后再放到Aside位置上即可</p>
<p>侧边栏加Icon: 调padding(内间距)和spacing(外间距) , 利用Grid类的templateColumn 200px 1fr来达到自适应</p>
<p>完善根据genre选择呈现列表</p>
<p>需要注意的是如何修改useEffect，如何上提控制状态和下放控制逻辑和axios之中方法所带的AxiosRequestConfig参数的使用(在请求体之中用来携带数据)</p>
<p>这里的逻辑是每次切换selectedGenre都重新向API（模拟的后端）请求一次数据，而不是用先前请求的数据做filter,filter的逻辑放给后端做了</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useGames</span> = (<span class="params"><span class="attr">selectedGenre</span>: <span class="title class_">Genre</span> | <span class="literal">null</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> useData&lt;<span class="title class_">Game</span>&gt;(<span class="string">&quot;/games&quot;</span>, &#123; <span class="attr">params</span>: &#123; <span class="attr">genres</span>: selectedGenre?.<span class="property">id</span> &#125; &#125;, [</span><br><span class="line">    selectedGenre,</span><br><span class="line">  ]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>



<p>useData的处理方法</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ApiClient</span> <span class="keyword">from</span> <span class="string">&quot;./Api-Client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">CanceledError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> dataResponse&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">results</span>: T[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> useData = &lt;T&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">endpoint</span>: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  config?: <span class="title class_">AxiosRequestConfig</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  dep?: <span class="built_in">any</span>[]</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState&lt;T[]&gt;([]);</span><br><span class="line">  <span class="keyword">const</span> [err, setError] = useState&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FetchGames</span> = <span class="title function_">useEffect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">true</span>); <span class="comment">// 每次重新取数据重置loading</span></span><br><span class="line">      <span class="title class_">ApiClient</span>.<span class="property">get</span>&lt;dataResponse&lt;T&gt;&gt;(endpoint, &#123;</span><br><span class="line">        <span class="attr">signal</span>: controller.<span class="property">signal</span>,</span><br><span class="line">        ...config,</span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">setData</span>(res.<span class="property">data</span>.<span class="property">results</span>);</span><br><span class="line">          <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">CanceledError</span>) <span class="keyword">return</span>;</span><br><span class="line">          <span class="title function_">setError</span>(err.<span class="property">message</span>);</span><br><span class="line">          <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    dep ? [...dep] : []</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> &#123; data, err, loading &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useData;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>highlight selectedGenre: fontweight属性即可</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fontWeight=&#123;genre.<span class="property">id</span> === selectedGenre?.<span class="property">id</span> ? <span class="string">&quot;bold&quot;</span> : <span class="string">&quot;normal&quot;</span>&#125;</span><br></pre></td></tr></table></figure></div>



<p>filterByPlatform</p>
<p>Menu类 下拉列表， 如果有错误，宁愿什么都不返回（取消这个组件）而不是将错误扔在用户脸上的设计原则</p>
<p>其他逻辑同genre</p>
<p>重构：使用Query Object Model，传入的各个select的props打包成Query</p>
<p>下一步： 加排序Sort，多种排序顺序还是一个Menu</p>
<p>如果一直向api发送请求（体现在UI上是一直闪烁）, <strong>可能是不恰当地传递了解构又重构的对象（即使是临时的对象），这样之后，看起来对象内部的值没有变化，但是对象不断地更新，然后React一直重复渲染</strong></p>
<p>处理没有图片的情况：Image的src不能使用相对路径，需要通过import导入</p>
<p>加上动态的Heading</p>
<p>处理Button的文本和图片重叠问题：改它的whiteSpace属性为”normal”,  再设置textAlign&#x3D;{“left”}左对齐</p>
<p>objectfit&#x3D;”cover”保持图片长宽比</p>
<p>shipping static data，当然，作为之前选择的回旋镖，也可以选择将Genre，Platform这种不怎么改变的数据存储在本地一个data文件夹之中，而不是每次都到API里面的查询</p>
<p>可以使用官方文档上的方法自定义颜色主题</p>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>先本地部署 </p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure></div>



<p>会生成dist文件夹，里面有编译完的js代码，所有需要的外部包和asset……</p>
<p>在Vercel（<a class="link"   target="_blank" rel="noopener" href="https://vercel.com/%EF%BC%89%E4%B8%8A%E9%83%A8%E7%BD%B2" >https://vercel.com/）上部署 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>使用github账号注册，登录，下载CLI</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vercel</span><br></pre></td></tr></table></figure></div>



<p>之后</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vercel</span><br></pre></td></tr></table></figure></div>

<p>接受默认值即可部署</p>
<blockquote>
<p><strong>ps: 这个好像在使用cnpm的时候会有问题，我没有部署成功，两者交互会有问题</strong></p>
</blockquote>
<h4 id="What’s-Next"><a href="#What’s-Next" class="headerlink" title="What’s Next"></a>What’s Next</h4><ul>
<li><p>Routing,</p>
</li>
<li><p>State Management,</p>
</li>
<li><p>Fetching Data With React Query</p>
</li>
<li><p>Authentication</p>
</li>
<li><p>Error Handling</p>
</li>
<li><p>Performance Optimazation</p>
</li>
<li><p>……</p>
</li>
</ul>
<h2 id="进阶部分"><a href="#进阶部分" class="headerlink" title="进阶部分"></a>进阶部分</h2><p>课程内容：</p>
<ul>
<li>React Query : 数据管理和缓存</li>
<li>Global State Management</li>
<li>React Router</li>
</ul>
<h3 id="React-Query"><a href="#React-Query" class="headerlink" title="React Query"></a>React Query</h3><h4 id="basic-query"><a href="#basic-query" class="headerlink" title="basic query"></a>basic query</h4><p>What is react query？</p>
<p>一个管理数据的库： A powerful lib for <strong>managing DATA FETCHING and CACHING</strong> in React apps</p>
<p>安装</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @tanstack/react-query</span><br></pre></td></tr></table></figure></div>



<p>QueryClient是核心组件：在项目之中启用React Query</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom/client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>();</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;queryClient&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>useQuery Hook:</p>
<p>接受一个对象，其中至少要有两个属性：</p>
<ul>
<li>queryKey: 用于标识数据在Query之中存储的唯一性的键，type为字符串数组（数组可以包含更多的信息，一般在数组的第一个元素放名字，后面放参数，如<code>queryKey:['todos', userId]</code>）</li>
<li>queryFn: 一个返回Promise的函数，这个Promise要么解析解析数据，要么抛出错误</li>
</ul>
<p>返回一个对象，该对象有以下重要属性：</p>
<ul>
<li>data: 存放Promise解析的值( if isSuccess属性为真)</li>
<li>isError: 如果isError, 则可以通过error属性得到错误</li>
<li>isPending：如果isPending, 查询正在进行之中，尚无结果</li>
</ul>
<blockquote>
<p>ps: 在有些版本之中，isPending 的名字是 isLoading</p>
</blockquote>
<p>使用useQuery Hook的好处：</p>
<ul>
<li>Auto retries: 可以配置React Query，让它自动重试几次</li>
<li>Auto reFetch：可以配置React Query， 让它每隔一段时间自动重新从服务器取数据</li>
<li>更简洁的Error handling &amp;&amp; Loading handling &amp;&amp; fecthing , 避免useState和useEffect的滥用</li>
<li><strong>提供数据缓存</strong></li>
</ul>
<p>useEffect的dep数组实际上是通过queryKey来实现同样的功能的：</p>
<blockquote>
<p>具体地说，将dep通过字符串数组拼接或者传递对象等拼到queryKey上之后，如果dep改变，那么就会产生一个新的queryKey, React Query看缓存里没有就执行回调函数了 </p>
</blockquote>
<p>示例代码，useQuery取代了useState， useEffect等代码</p>
<p>注意useQuery一定要放在React组件内部</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Todo</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">completed</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchTodos</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  axios</span><br><span class="line">    .<span class="property">get</span>&lt;<span class="title class_">Todo</span>[]&gt;(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">TodoList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// if (isLoading) return &lt;p&gt;Loading...&lt;/p&gt;;</span></span><br><span class="line">  <span class="keyword">const</span> &#123; isError, data, error &#125; = useQuery&lt;<span class="title class_">Todo</span>[], <span class="title class_">Error</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;todos&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: fetchTodos,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (isError) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;data?.map((todo) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;todo.title&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">TodoList</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>然后重构一下，把fetchdata相关逻辑封装到useTodo的hook里面去</p>
<p>React Query Devtools 工具</p>
<p>安装</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="meta">@tanstack</span>/react-query-devtools</span><br></pre></td></tr></table></figure></div>

<p><strong>非常有用！</strong></p>
<p>学到的一个教训：<br><strong>不要用cnpm，碰都不要碰，会变得不幸</strong><br>不知道网上那么多复制粘贴cnpm的自己有没有用过</p>
<p>请用nrm，然后在taobao、tencent和sjtu三个源上横跳，一般都能找得到包，但他们每一个都缺点东西，单独用还是不行<br>cnpm下是能下，下完了全是乱七八糟的错误，并且根本找不到修的方法</p>
<blockquote>
<p>cnpm 的出现了无法解决的问题……react query devtools Error: No QueryClient set, use QueryClientProvider to set one</p>
<p>这个问题用正常npm不会出现，且网上的解决方法对cnpm不生效</p>
<p>还有就是<code>npm config get proxy</code>看一下，笔者的proxy是null, 如果设置了一个无效的proxy，外面再怎么换源代理都是没用的</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nrm</span><br><span class="line">nrm <span class="built_in">ls</span></span><br><span class="line">nrm add https://mirrors.sjtug.sjtu.edu.cn/npm-registry</span><br><span class="line">nrm use tencent</span><br></pre></td></tr></table></figure></div>





<p>自定义React Query配置: 修改QueryClient对象, 例：</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>(&#123;</span><br><span class="line">  <span class="attr">defaultOptions</span>: &#123;</span><br><span class="line">    <span class="attr">queries</span>: &#123;</span><br><span class="line">      <span class="attr">cacheTime</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">5</span>, <span class="comment">// 5 minutes</span></span><br><span class="line">      <span class="attr">retry</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">staleTime</span>: <span class="number">1000</span> * <span class="number">10</span>, <span class="comment">// 10 seconds, After how long the data will be treated as old data.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>



<p>三种默认情况下，react query会自动更新数据：</p>
<ul>
<li>网络重连</li>
<li>组件被挂载</li>
<li>窗口重新聚焦（切到了另一个tab再切回来）</li>
</ul>
<p>也可以自定义，将它们关掉，如<code>refetchOnWindowFocus:false</code></p>
<p>react query先给用户旧的数据（cache），同时向后端请求新数据，更新之后再重新渲染</p>
<p>当然，这是全局的设置，也可以针对每一个query自定义，在传入useQuery的对象里面加上cacheTime，retry等属性即可</p>
<p>实现筛选：</p>
<p>和先前的一样，不多赘述；首先使用useState和select组件维护选择状态，之后根据API的路由情况，传入筛选对应id之类组成新的url，改一下queryKey即可</p>
<p>实现分页：</p>
<p>上代码， 思路是将页面作为维护的变量，</p>
<p>而后端请求实现发送从 <code>_start</code>开始数目为 <code>_limit</code>的数据</p>
<p>即分页完全是前端的工作，后端只负责发数据</p>
<p>上一页按钮需要在页面为1是disable</p>
<p>然后为了用户体验，在useQuery里面加上  <code>keepPreviousData: true</code>, 使得在loading的时候给用户缓存的先前结果而不是一个loading</p>
<p>usePost.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">body</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PostQuery</span> &#123;</span><br><span class="line">  <span class="attr">pagesize</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">page</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fetchPosts = &lt;<span class="title class_">Post</span>&gt;<span class="function">(<span class="params"><span class="attr">params</span>: <span class="title class_">PostQuery</span></span>) =&gt;</span></span><br><span class="line">  axios</span><br><span class="line">    .<span class="property">get</span>&lt;<span class="title class_">Post</span>&gt;(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="attr">_start</span>: (params.<span class="property">page</span> - <span class="number">1</span>) * params.<span class="property">pagesize</span>,</span><br><span class="line">        <span class="attr">_limit</span>: params.<span class="property">pagesize</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">usePosts</span> = (<span class="params"><span class="attr">query</span>: <span class="title class_">PostQuery</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> useQuery&lt;<span class="title class_">Post</span>[], <span class="title class_">Error</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;posts&quot;</span>, query],</span><br><span class="line">    <span class="attr">queryFn</span>: <span class="function">() =&gt;</span> <span class="title function_">fetchPosts</span>(query),</span><br><span class="line">    <span class="attr">keepPreviousData</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cacheTime</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">5</span>, <span class="comment">// 5 minutes</span></span><br><span class="line">    <span class="attr">retry</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">staleTime</span>: <span class="number">1000</span> * <span class="number">10</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePosts;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>PostList.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> usePosts, &#123; <span class="title class_">PostQuery</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./components/usePosts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PostList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState&lt;<span class="title class_">PostQuery</span>&gt;(&#123; <span class="attr">page</span>: <span class="number">1</span>, <span class="attr">pagesize</span>: <span class="number">10</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> &#123; error, <span class="attr">data</span>: posts, isError, isLoading &#125; = <span class="title function_">usePosts</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;posts?.map((post) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;post.id&#125;</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;post.title&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;btn btn-primary mb-3 ms-1 my-3 &quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">disabled</span>=<span class="string">&#123;query.page</span> === <span class="string">1&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setQuery(&#123; ...query, page: query.page - 1 &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Prev</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;btn btn-primary mb-3 ms-1 my-3&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setQuery(&#123; ...query, page: query.page + 1 &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PostList</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>实现无限页面（Load More）</p>
<p>使用React Query自带的useInfiniteQuery替代useQuery</p>
<p>具体的方法如下</p>
<p>PostList.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> usePosts, &#123; <span class="title class_">PostQuery</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./components/usePosts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PostList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState&lt;<span class="title class_">PostQuery</span>&gt;(&#123; <span class="attr">pagesize</span>: <span class="number">10</span>, <span class="attr">pageparam</span>: <span class="number">1</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    error,</span><br><span class="line">    <span class="attr">data</span>: posts,</span><br><span class="line">    isError,</span><br><span class="line">    isLoading,</span><br><span class="line">    fetchNextPage,</span><br><span class="line">    isFetching,</span><br><span class="line">  &#125; = <span class="title function_">usePosts</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;posts?.pages.map((post, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;post.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;item.title&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;btn btn-primary mb-3&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> fetchNextPage()&#125;</span></span><br><span class="line"><span class="language-xml">        disabled=&#123;isFetching&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;isFetching ? &quot;Loading&quot; : &quot;Load more&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PostList</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>usePosts.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useData <span class="keyword">from</span> <span class="string">&quot;./hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useInfiniteQuery, useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">body</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PostQuery</span> &#123;</span><br><span class="line">  <span class="attr">pagesize</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">pageparam</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fetchPosts = &lt;<span class="title class_">Post</span>&gt;<span class="function">(<span class="params"><span class="attr">params</span>: <span class="title class_">PostQuery</span></span>) =&gt;</span></span><br><span class="line">  axios</span><br><span class="line">    .<span class="property">get</span>&lt;<span class="title class_">Post</span>&gt;(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="attr">_start</span>: (params.<span class="property">pageparam</span> - <span class="number">1</span>) * params.<span class="property">pagesize</span>,</span><br><span class="line">        <span class="attr">_limit</span>: params.<span class="property">pagesize</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">usePosts</span> = (<span class="params"><span class="attr">query</span>: <span class="title class_">PostQuery</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> useInfiniteQuery&lt;<span class="title class_">Post</span>[], <span class="title class_">Error</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;posts&quot;</span>, query],</span><br><span class="line">    <span class="attr">queryFn</span>: <span class="function">() =&gt;</span> <span class="title function_">fetchPosts</span>(&#123; ...query, <span class="attr">pageparam</span>: <span class="number">1</span> &#125;),</span><br><span class="line">    <span class="attr">keepPreviousData</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cacheTime</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">5</span>, <span class="comment">// 5 minutes</span></span><br><span class="line">    <span class="attr">retry</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">staleTime</span>: <span class="number">1000</span> * <span class="number">10</span>,</span><br><span class="line">    <span class="attr">getNextPageParam</span>: <span class="function">(<span class="params">lastPage, allPages</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> lastPage.<span class="property">length</span> &gt; <span class="number">0</span> ? allPages.<span class="property">length</span> + <span class="number">1</span> : <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// 此处用到了json的特性：当试图访问一个allPages数组之中不存在的元素（超过数组长度），会返回空数组</span></span><br><span class="line">      <span class="comment">// 此时lastPage的length为0</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePosts;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="mutation"><a href="#mutation" class="headerlink" title="mutation"></a>mutation</h4><div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"><span class="keyword">const</span> mutation = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">  <span class="attr">mutationFn</span>: <span class="function">(<span class="params"><span class="attr">todo</span>: <span class="title class_">Todo</span></span>) =&gt;</span></span><br><span class="line">    axios</span><br><span class="line">      .<span class="property">post</span>&lt;<span class="title class_">Todo</span>&gt;(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>),</span><br><span class="line">  <span class="attr">onSuccess</span>: <span class="function">(<span class="params">savedData, newData</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Approach 1: invalidate the cache and refetch the data, unable to deal with fake backend</span></span><br><span class="line">    <span class="comment">// queryClient.invalidateQueries(&#123; queryKey: [&quot;todos&quot;] &#125;);</span></span><br><span class="line">    <span class="comment">// Approach 2: reset query data in cache</span></span><br><span class="line">    queryClient.<span class="property">setQueryData</span>&lt;<span class="title class_">Todo</span>[]&gt;([<span class="string">&quot;todos&quot;</span>], <span class="function">(<span class="params">oldTodos</span>) =&gt;</span> [</span><br><span class="line">      newData,</span><br><span class="line">      ...(oldTodos || []),</span><br><span class="line">    ]);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>useMutation hook有几个重要属性：</p>
<ul>
<li>mutationFn: 在调用mutation.mutate方法的时候调用的函数，用于执行向服务器的操作，接受一个object作为参数</li>
<li>onSuccess: mutationFn成功的情况下的回调函数，接受三个参数，第一个参数data是mutate函数的返回值，<strong>第二个参数</strong>variable是传递给mutate函数的值，在<strong>这里就是新的Todo元素</strong>，第三个参数是onMutate方法的返回值</li>
</ul>
<hr>
<h4 id="Refactor-ApiClient"><a href="#Refactor-ApiClient" class="headerlink" title="Refactor: ApiClient"></a>Refactor: ApiClient</h4><p>之前的代码有耦合的问题，网络相关的逻辑不应该出现在自定义Hook之中，并且这一段代码还多次重复</p>
<p>在初级部分之中，我们用于解耦合的ApiClient模块只是简短的</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ApiClient</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;https://api.rawg.io/api&quot;</span>,</span><br><span class="line">  <span class="attr">params</span>: &#123; <span class="attr">key</span>: <span class="string">&quot;c93352ea62ed4c7d9095e81593af922f&quot;</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ApiClient</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>而在中级部分之中，我们还可以给它完善一下，变成一个类, 例如：</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">Axios</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiClientInstance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;https://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApiClient</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">endpoint</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">endpoint</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">endpoint</span> = endpoint;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getAll</span>(<span class="params">params?: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">endpoint</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">params</span>: params,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> data = apiClientInstance</span><br><span class="line">      .<span class="property">get</span>&lt;T[]&gt;(<span class="variable language_">this</span>.<span class="property">endpoint</span>, config)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">post</span>(<span class="params"><span class="attr">data</span>: T</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">endpoint</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      <span class="attr">data</span>: data,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> dataResponse = apiClientInstance</span><br><span class="line">      .<span class="property">post</span>&lt;T&gt;(<span class="variable language_">this</span>.<span class="property">endpoint</span>, data, config)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="property">data</span>);</span><br><span class="line">    <span class="keyword">return</span> dataResponse;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ApiClient</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>之后我们的useTodos和usePosts两个自定义Hook的代码逻辑就可以大幅度简化了</p>
<p>例如useTodos</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ApiClient</span> <span class="keyword">from</span> <span class="string">&quot;../service/ApiClient&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Todo</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">completed</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TodoQuery</span> &#123;</span><br><span class="line">  <span class="attr">pagesize</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">page</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchTodos</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ApiClientInstance</span> = <span class="keyword">new</span> <span class="title class_">ApiClient</span>&lt;<span class="title class_">Todo</span>&gt;(<span class="string">&quot;/todos&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title class_">ApiClientInstance</span>.<span class="title function_">getAll</span>();</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useTodos</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> useQuery&lt;<span class="title class_">Todo</span>[], <span class="title class_">Error</span>&gt;(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;todos&quot;</span>], <span class="attr">queryFn</span>: fetchTodos &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTodos;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>一行代码<code>debugger;</code> 会在这里停止</p>
<p><strong>注意：这里因为我传递的是fetchTodos而不是ApiClientInstance.getAll, 所以getAll方法被隐式地绑定到对象上了；如果传递ApiClientInstance.getAll, 会出现this丢失的情况。要一劳永逸的解决这个问题，两个方法</strong></p>
<ul>
<li>将<code>useQuery</code>的<code>queryFn</code>改成<code>ApiClientInstance.getAll.bind(ApiCilentInstance)</code>,使用bind显式指定这个方法属于ApiClientInstance</li>
<li>将getAll等方法从一般的函数改为箭头函数，如 <code>getAll&lt;T&gt;&#123;...&#125;</code>改写成<code>getAll&lt;T&gt;=()=>&#123;...&#125;</code></li>
</ul>
<p>原理：</p>
<p>箭头函数没有自己的this上下文，它的this<strong>是继承于定义时的上下文（上级对象）的</strong></p>
<p>例如</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">print</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">print</span>(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></div>

<p>此处，<strong>this不会被绑定到调用时的上下文obj，而是会被绑定到定义时的上下文（全局作用域），所谓上下文可以用栈帧frame来理解</strong></p>
<p><strong>而对于一个class的方法, 箭头函数绑定到定义时的上下文（这个类），而非箭头函数会根据调用时的上下文来决定this</strong></p>
<p><strong>如果只是简单的调用，那么两者的结果是相同的。但是如果将类的非箭头函数方法作为回调函数传递，例如传给一个参数或者是其他量 const sth &#x3D; instance.method这样，会造成this错误绑定</strong></p>
<p>继续重构</p>
<p>目前endpoint如果写错了还是很麻烦，并且type是定义在hooks之中的，这不好。把type和endpoint抽出来放在service之中</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ApiClient</span> <span class="keyword">from</span> <span class="string">&quot;./ApiClient&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">body</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postService = <span class="keyword">new</span> <span class="title class_">ApiClient</span>&lt;<span class="title class_">Post</span>&gt;(<span class="string">&quot;/posts&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> postService;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p><strong>这样重构实际上是在给整个应用分层</strong></p>
<ul>
<li>最底层是ApiClient， 负责处理向后端发送请求</li>
<li>上面是HTTPService，本质上是ApiClient的实例，同时，不同的Service为上端不同的功能定义最基本的类型</li>
<li>再上面是Custom Hook, 将对应的HTTPService的数据进一步打包成基本的工具方法</li>
<li>最上面才是我们的React  Components，真正的前端</li>
</ul>
<p>分层的核心逻辑在于：<strong>一层只干一件事情</strong>，处理好自己那一层的输入输出即可，让我们的代码解耦、易懂</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><h4 id="Genres"><a href="#Genres" class="headerlink" title="Genres"></a>Genres</h4><p>没啥好说的，按照前面说的重构就行，在React Query里面设置initialData倒是一个值得记住的效果实现</p>
<p>useGenre.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> genres <span class="keyword">from</span> <span class="string">&quot;../data/genres&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useData, &#123; queryConfig &#125; <span class="keyword">from</span> <span class="string">&quot;./useData&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Genre</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">image_background</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const useGenres = () =&gt; (&#123; data: genres, isLoading: false, error: null &#125;)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useGenres</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> queryConfig = &#123;</span><br><span class="line">    <span class="attr">cacheTime</span>: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">staleTime</span>: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">initialData</span>: genres,</span><br><span class="line">  &#125; <span class="keyword">as</span> queryConfig;</span><br><span class="line">  <span class="keyword">return</span> useData&lt;<span class="title class_">Genre</span>&gt;(&#123; <span class="attr">endpoint</span>: <span class="string">&quot;/genres&quot;</span>, <span class="attr">queryConfig</span>: queryConfig &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useGenres;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>useData.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ApiClient</span> <span class="keyword">from</span> <span class="string">&quot;../services/api-client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">CanceledError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> queryConfig = &#123;</span><br><span class="line">  [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">type</span> useDataProps = &#123;</span><br><span class="line">  <span class="attr">endpoint</span>: <span class="built_in">string</span>;</span><br><span class="line">  config?: <span class="title class_">AxiosRequestConfig</span>;</span><br><span class="line">  dep?: <span class="built_in">any</span>[];</span><br><span class="line">  queryConfig?: queryConfig;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> useData = &lt;T&gt;<span class="function">(<span class="params">&#123; endpoint, config, dep, queryConfig &#125;: useDataProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> apiClient = <span class="keyword">new</span> <span class="title class_">ApiClient</span>&lt;T&gt;(endpoint, config);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [endpoint].<span class="title function_">concat</span>(dep || []),</span><br><span class="line">    <span class="attr">queryFn</span>: apiClient.<span class="property">get</span>,</span><br><span class="line">    ...queryConfig,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useData;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>实现无限滚动</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-infinite-scroll-component@6.1</span><br></pre></td></tr></table></figure></div>

<p>后面逻辑比较重复</p>
<p>简化时间表达： ms库，非常简单</p>
<hr>
<h3 id="Global-state-management"><a href="#Global-state-management" class="headerlink" title="Global state management"></a>Global state management</h3><h4 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h4><blockquote>
<p>Reducer: A function that allows us to centralize state in a component</p>
</blockquote>
<p>Reducer将React组件的状态管理抽离出组件本身，使得整个状态管理只需要关注Reducer，并且支持管理逻辑的重用</p>
<p>reducer函数接受两个参数，state和action(一般作为一个对象传递，其type参数对应了执行的动作，有点像状态机)</p>
<p>直接看代码</p>
<p>reducer&#x2F;counterReducer.ts</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Action</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;INCREMENT&quot;</span> | <span class="string">&quot;DECREMENT&quot;</span> | <span class="string">&quot;RESET&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">counterReducer</span> = (<span class="params"><span class="attr">state</span>: <span class="built_in">number</span>, <span class="attr">action</span>: <span class="title class_">Action</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;INCREMENT&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREMENT&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;RESET&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterReducer;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>counter.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./reducers/counterReducer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Counter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// const [value, setValue] = useState(0);</span></span><br><span class="line">  <span class="keyword">const</span> [value, dispatch] = <span class="title function_">useReducer</span>(counterReducer, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Counter (&#123;value&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;INCREMENT&quot; &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">        className=&quot;btn btn-primary mx-1&quot;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Increment</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;RESET&quot; &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">        className=&quot;btn btn-primary mx-1&quot;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Reset</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<p>当执行的任务变复杂时，需要多个接口：</p>
<p>例如</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AddTask</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;ADD&quot;</span>;</span><br><span class="line">  <span class="attr">newTask</span>: <span class="title class_">Task</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DeleteTask</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;DELETE&quot;</span>;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Action</span> = <span class="title class_">AddTask</span> | <span class="title class_">DeleteTask</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> taskReducer = (<span class="attr">state</span>: <span class="title class_">Task</span>[], <span class="attr">action</span>: <span class="title class_">Action</span>): <span class="title class_">Task</span>[] =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;ADD&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> [...state, action.<span class="property">newTask</span>];</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DELETE&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state.<span class="title function_">filter</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> task.<span class="property">id</span> !== action.<span class="property">id</span>);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> taskReducer;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h4 id="React-Context"><a href="#React-Context" class="headerlink" title="React Context"></a>React Context</h4><p>在初级部分之中，React组件之间共享状态是通过props<strong>自上而下传递的</strong>，也就是说如果我们要在组件树上的两个部分之间共享某个状态，就必须将这个状态上移到公共父组件，这导致了几个问题</p>
<ol>
<li><p>如果公共父组件很远，即组件层数很深，那么Props要传递很多层，非常恶心</p>
</li>
<li><p>如果组件很多，那么类似App这样的顶层父组件就会全都是状态，影响理解</p>
</li>
</ol>
<p>这种问题称之为Props drilling，指Props把组件钻了一堆孔</p>
<p>但是我们先前也有提到，React的State实质上是全局存储的，所以能够提供一种更好的机制来实现不同组件之间的状态共享，这就是React Context</p>
<p>React Context解决了第一个问题，对第二个问题帮助较小</p>
<p>context&#x2F;taskContext.ts</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Action</span>, <span class="title class_">Task</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../reducers/taskReducers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TaskContextType</span> &#123;</span><br><span class="line">  <span class="attr">tasks</span>: <span class="title class_">Task</span>[];</span><br><span class="line">  <span class="attr">dispatch</span>: <span class="title class_">React</span>.<span class="property">Dispatch</span>&lt;<span class="title class_">Action</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TaskContext</span> = <span class="title class_">React</span>.<span class="property">createContext</span>&lt;<span class="title class_">TaskContextType</span>&gt;(</span><br><span class="line">  &#123;&#125; <span class="keyword">as</span> <span class="title class_">TaskContextType</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>有了这个TaskContext之后，</p>
<p>只需要在想传递的位置用它的Provider包裹就行</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(taskReducer, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TaskContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">tasks</span>, <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavBar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TaskContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>之后在NavBar里面就可以直接</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; tasks, dispatch &#125; = <span class="title function_">useContext</span>(<span class="title class_">TaskContext</span>);</span><br></pre></td></tr></table></figure></div>



<p>provider一多，代码略丑</p>
<p>可以把provider变成一个Components<strong>（Custom Provider）</strong></p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> taskReducer <span class="keyword">from</span> <span class="string">&quot;./reducers/taskReducers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TaskContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./contexts/taskContext&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TaskProviderProps</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">TaskProvider</span> = (<span class="params">&#123; children &#125;: <span class="title class_">TaskProviderProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(taskReducer, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TaskContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">tasks</span>, <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TaskContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">TaskProvider</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>然后App就变成了简洁的样子</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NavBar</span> <span class="keyword">from</span> <span class="string">&quot;./state-management/NavBar&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomePage</span> <span class="keyword">from</span> <span class="string">&quot;./state-management/HomePage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AuthProvider</span> <span class="keyword">from</span> <span class="string">&quot;./state-management/AuthProvider&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TaskProvider</span> <span class="keyword">from</span> <span class="string">&quot;./state-management/TaskProvider&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">AuthProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TaskProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavBar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TaskProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">AuthProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>也可以将整个useConText放到自定义Hook里面去，进一步减轻心智压力，只需要调自己的Hook就行了，不需要考虑上下文</p>
<h4 id="让整个代码更加模块化"><a href="#让整个代码更加模块化" class="headerlink" title="让整个代码更加模块化"></a><strong>让整个代码更加模块化</strong></h4><p>我们现在有TaskList, taskContext, TaskProvider,taskReducer，useTask 5个和task相关的文件</p>
<p>但是它们散落在整个项目的各个地方，对于task这么一个小功能都写了5个文件，一旦功能多起来，<strong>文件量的增加会加巨耦合</strong>，也对我们找和理解带来心智负担</p>
<p>把它们放到一起去，新建一个task文件夹，全丢进去</p>
<p>task文件夹内部是task模块的实现，而整个模块的实现不是所有的都需要暴露在外面的</p>
<p>要暴露的只有</p>
<ul>
<li>TaskList</li>
<li>[optional] TaskProvider</li>
</ul>
<p>剩下的之中，useTask hook 和 taskReducer 在大部分情况下应该只在Task模块内部使用，taskContext被包装进了TaskProvider</p>
<p>于是我们可以再加一个index.ts ，其中导入TaskList和TaskProvider再导出，而外部模块使用Task模块的内容的时候，应该从Task文件夹导入（转到index），<strong>不应该触及内部结构和内部实现</strong></p>
<p>task&#x2F;index.ts</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">TaskList</span> <span class="keyword">from</span> <span class="string">&quot;./TaskList&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TaskProvider</span> <span class="keyword">from</span> <span class="string">&quot;./TaskProvider&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">TaskList</span>, <span class="title class_">TaskProvider</span> &#125;;</span><br></pre></td></tr></table></figure></div>



<h4 id="Best-practice-When-to-use-……"><a href="#Best-practice-When-to-use-……" class="headerlink" title="Best practice: When to use ……"></a>Best practice: When to use ……</h4><p><strong>When to use context?</strong></p>
<p>在一个项目之中可能有很多的状态，但这些状态可以分解成</p>
<ul>
<li>(从)Server端获取的状态：例如数据</li>
<li>Client UI 状态: 例如组件的一些Local State</li>
</ul>
<p>两个部分</p>
<p><strong>对于Server端状态，不应该用Context，用React Query，React Query就是为了避免组件树变成一大坨屎被设计出来的，一堆Context和State实际上都用useQuery里面的queryKey标识了之后委托给React Query管理了</strong>。如果用Context，元素一多Provider就会一直叠，最终不可维护</p>
<p><strong>而对于Client端状态，如有共享的需要，例如Navbar可能需要组件树底部的组件的信息，应该用Context来提供组件之间传递状态的灵活性</strong></p>
<p><strong>When to use reducer?</strong></p>
<p>看逻辑复杂与否，如果逻辑很复杂，放在组件里很丑陋，难以理解，操作很多还容易出错的时候，就应该用reducer把逻辑独立出来</p>
<p>如果逻辑很简单，就一行代码的事情，那直接useState也挺好</p>
<p><strong>When to use Redux?</strong></p>
<p>Redux和React Context不同的地方是，Redux是一个将所有组件的状态全部交给Redux管理，这样以后，就可以和React解耦、更好的管理状态……；而React Context只是把状态在组件之间更好的传递。一个是仓库，一个是卡车。</p>
<p>mosh给出的观点是，Redux很强大，但为了支持那些强大（却未必用得上）的功能（例如撤销），反而在大多数不需要的项目之中带来了太多的复杂性</p>
<p>在Server端，React Query已经足够好用，并且大大简化了Redux的功能</p>
<p>在Client端，首先一般的应用程序客户端状态比较少，其次有简单的useState和useContext, 逻辑复杂时有 reducer，再复杂mosh也推荐用Zustand这个轻量化的管理器</p>
<h4 id="Zustand"><a href="#Zustand" class="headerlink" title="Zustand"></a>Zustand</h4><p>安装： </p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i zustand@4.3.7</span><br></pre></td></tr></table></figure></div>



<p>Zustand使用create方法创建一个全局状态，返回一个React Hook，这个hook可以在任何模块之中使用</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; create &#125; <span class="keyword">from</span> <span class="string">&quot;zustand&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CounterStore</span> &#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="built_in">number</span>; <span class="comment">// states</span></span><br><span class="line">  <span class="attr">increment</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>; <span class="comment">// actions or methods</span></span><br><span class="line">  <span class="attr">reset</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCounter = create&lt;<span class="title class_">CounterStore</span>&gt;(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">increment</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> (&#123; <span class="attr">counter</span>: state.<span class="property">counter</span> + <span class="number">1</span> &#125;)),</span><br><span class="line">  <span class="attr">reset</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(&#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;),</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCounter;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>create接受一个类型参数，这个类型是一个对象，其中可以有属性和方法，如果把它看成状态机的话就是state和改变state的method，传入的参数是一个set函数</p>
<p>set函数根据接受的参数不同有两种“重载”</p>
<ul>
<li>如果接受一个对象，它将create出来的状态用这个新对象更新，类似setState</li>
<li>如果接受一个函数，这个函数接受原先的 state 作为传入参数（<strong>传入参数为监听对象</strong>）， 而函数的返回值将作为新的state更新</li>
</ul>
<p>这样之后Counter的逻辑就非常简洁了, 没有了表意尚有一些模糊的<code>dispatch(&#123;type:"somestring"&#125;)</code></p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./counterReducer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useCounter <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Counter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// const [value, setValue] = useState(0);</span></span><br><span class="line">  <span class="comment">// const [value, dispatch] = useReducer(counterReducer, 0);</span></span><br><span class="line">  <span class="keyword">const</span> &#123; counter, increment, reset &#125; = <span class="title function_">useCounter</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Counter (&#123;counter&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> increment()&#125; className=&quot;btn btn-primary mx-1&quot;&gt;</span></span><br><span class="line"><span class="language-xml">        Increment</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> reset()&#125; className=&quot;btn btn-primary mx-1&quot;&gt;</span></span><br><span class="line"><span class="language-xml">        Reset</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p><strong>还能用它来避免不必要的rerender</strong></p>
<p>方法：假设CounterStore还有另一个属性max, 在调用useCounter的时候，如果我只想要Counter组件在counter的值改变时才重新渲染，只需要<code>useCounter(s=>s.counter)</code></p>
<p>理解： 相当于改变了create的监听对象（类比useState），返回的值也会做对应改变，但是整个状态的返回值会正常更新</p>
<p>如果监听s.counter，返回的就是counter属性</p>
<p>如果监听s.reset， 返回的就是reset方法</p>
<p>检查Zustand状态</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i simple-zustand-devtools</span><br><span class="line">npm i -D @types/node</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ps: 这个工具我下载了但是没找到视频演示的模块，就放这了（doge</p>
</blockquote>
<p>实战：使用Zustand重构gamehub</p>
<p>所有gameQuery这个local state传来传去的地方全部删光，<strong>太爽了！！！</strong></p>
<p><strong>有了这个几乎不需要任何的Props</strong></p>
<p>最后的app.tsx超级干净，不传入任何函数和变量</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Box</span>, <span class="title class_">Grid</span>, <span class="title class_">GridItem</span>, <span class="title class_">HStack</span>, <span class="title class_">Show</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@chakra-ui/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NavBar</span> <span class="keyword">from</span> <span class="string">&quot;./components/NavBar&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GameGrids</span> <span class="keyword">from</span> <span class="string">&quot;./components/GameGrids&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Aside</span> <span class="keyword">from</span> <span class="string">&quot;./components/Aside&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PlatformSelector</span> <span class="keyword">from</span> <span class="string">&quot;./components/PlatformSelector&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SortSelector</span> <span class="keyword">from</span> <span class="string">&quot;./components/SortSelector&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GameHeading</span> <span class="keyword">from</span> <span class="string">&quot;./components/GameHeading&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> templateAreas = &#123;</span><br><span class="line">    <span class="attr">base</span>: <span class="string">`&quot;nav&quot; &quot;main&quot;`</span>, <span class="comment">// 移动端小屏幕没有aside侧边栏</span></span><br><span class="line">    <span class="attr">lg</span>: <span class="string">`&quot;nav nav&quot; &quot;aside main&quot;`</span>, <span class="comment">// &gt; 1000px</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> templateColumns = &#123;</span><br><span class="line">    <span class="attr">base</span>: <span class="string">&quot;1fr&quot;</span>,</span><br><span class="line">    <span class="attr">lg</span>: <span class="string">&quot;200px 1fr&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">templateAreas</span>=<span class="string">&#123;templateAreas&#125;</span> <span class="attr">templateColumns</span>=<span class="string">&#123;templateColumns&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">NavBar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Show</span> <span class="attr">above</span>=<span class="string">&quot;lg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;aside&quot;</span> <span class="attr">paddingX</span>=<span class="string">&#123;</span>&quot;<span class="attr">10px</span>&quot;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Aside</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Show</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">GridItem</span> <span class="attr">area</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Box</span> <span class="attr">paddingLeft</span>=<span class="string">&#123;2&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">GameHeading</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">HStack</span> <span class="attr">spacing</span>=<span class="string">&#123;5&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">PlatformSelector</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">SortSelector</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">HStack</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">GameGrids</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Box</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">GridItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>这种方法的弊端：</p>
<p><strong>降低了组件可重用性</strong>，现在所有的组件都依赖于Store了</p>
<p>如果是简单的Props，还是直接父子组件Props或者Context之类传传</p>
<h3 id="React-Router"><a href="#React-Router" class="headerlink" title="React Router"></a>React Router</h3><ul>
<li>Setting up routes</li>
<li>Handling Errors</li>
<li>Navigating between pages</li>
<li>Dynamic routes</li>
<li>Nested routes</li>
<li>Private routes</li>
</ul>
<p>安装</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-router-dom</span><br></pre></td></tr></table></figure></div>

<p>它的版本兼容比较嗯嗯，所以最好提前选好版本（</p>
<h4 id="最基本的router"><a href="#最基本的router" class="headerlink" title="最基本的router"></a>最基本的router</h4><div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomePage</span> <span class="keyword">from</span> <span class="string">&quot;./HomePage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserListPage</span> <span class="keyword">from</span> <span class="string">&quot;./UserListPage&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserListPage</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure></div>

<p>然后，在main.tsx之中把App组件换成RouterProvider</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom/client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactQueryDevtools</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query-devtools&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./routing/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>();</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;queryClient&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span>   // 这里</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ReactQueryDevtools</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>React-Router里面有<code>&lt;Link /&gt;</code>组件，比起使用a href跳转，优点是跳转的时候不会向Server重新发送请求，省资源</p>
<p>使用的时候平替即可</p>
<p>例如</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;/users&quot;</span>&gt;<span class="title class_">Users</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure></div>

<p>换成</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/users&quot;</span>&gt;<span class="title class_">Users</span>&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure></div>



<p>还有就是<strong>useNavigate Hook</strong>, 它会返回一个navigateFunction, 然后传递给这个function一个to, 即可实现跳转</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ContactPage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onSubmit</span>=<span class="string">&#123;(event)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        event.preventDefault();</span></span><br><span class="line"><span class="language-xml">        // Redirect the user to the home page</span></span><br><span class="line"><span class="language-xml">        navigate(&quot;/&quot;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ContactPage</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>就是实战一里面的 在路由里面传递参数 <code>/post/:id</code>这样子</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/user/:id&quot;</span>,</span><br><span class="line">  <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserDetailPage</span> /&gt;</span></span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>



<p>对应的, Link用模板字符串就好了</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=&#123;<span class="string">`/user/<span class="subst">$&#123;user.id&#125;</span>`</span>&#125;&gt;&#123;user.<span class="property">name</span>&#125;&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure></div>



<p>几个常用的Hook</p>
<ul>
<li><code>useParams</code>:返回一个记录了所有动态路由的传递的参数的对象</li>
<li><code>useSearchParams</code>: 返回一个记录了路由传递的查询参数的对象和设置它的函数的数组(就是<code>[searchParams, setSearchParams]</code>), 然后对<code>searchParams</code>调用<code>get</code>方法, 传入一个<code>name</code>能够得到路由传递的查询参数里面<code>name</code>的值;调用<code>toString</code>方法能够返回原始的查询字符串</li>
<li><code>useLocation</code>返回当前路由的location对象</li>
</ul>
<blockquote>
<p>The <code>useParams</code> hook returns an object of key&#x2F;value pairs of the dynamic params from the current URL that were matched by the <code>&lt;Route path&gt;</code>. Child routes inherit all params from their parent routes.</p>
</blockquote>
<h4 id="Build-A-NavBar-嵌套路由"><a href="#Build-A-NavBar-嵌套路由" class="headerlink" title="Build A NavBar:嵌套路由"></a>Build A NavBar:嵌套路由</h4><p>直接看代码</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomePage</span> <span class="keyword">from</span> <span class="string">&quot;./HomePage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserListPage</span> <span class="keyword">from</span> <span class="string">&quot;./UserListPage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ContactPage</span> <span class="keyword">from</span> <span class="string">&quot;./ContactPage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserDetailPage</span> <span class="keyword">from</span> <span class="string">&quot;./UserDetailPage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// &#123; path: &quot;&quot;, element: &lt;HomePage /&gt; &#125;,</span></span><br><span class="line">      <span class="comment">// 上面下面的写法均可</span></span><br><span class="line">      &#123; <span class="attr">index</span>: <span class="literal">true</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&quot;users&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserListPage</span> /&gt;</span></span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&quot;user/:id&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserDetailPage</span> /&gt;</span></span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&quot;contact&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ContactPage</span> /&gt;</span></span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Router</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>可以这样定义路由的子组件</p>
<p>然后,在Layout.tsx里面</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NavBar</span> <span class="keyword">from</span> <span class="string">&quot;./NavBar&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Layout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavBar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span>  // 这个Outlet就是子组件的占位符,根据路由在children之中选择匹配的值</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>然后不管切换到哪个子路由, <code>&lt;NavBar /&gt;</code>组件总是可视的</p>
<p>可以继续嵌套,达成一些有趣的效果,比如左半边屏幕是user, 右半边是detail</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomePage</span> <span class="keyword">from</span> <span class="string">&quot;./HomePage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ContactPage</span> <span class="keyword">from</span> <span class="string">&quot;./ContactPage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserDetail</span> <span class="keyword">from</span> <span class="string">&quot;./UserDetail&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserPage</span> <span class="keyword">from</span> <span class="string">&quot;./UserPage&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// &#123; path: &quot;&quot;, element: &lt;HomePage /&gt; &#125;,</span></span><br><span class="line">      <span class="comment">// 上面下面的写法均可</span></span><br><span class="line">      &#123; <span class="attr">index</span>: <span class="literal">true</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span> &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;users/&quot;</span>,</span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserPage</span> /&gt;</span></span>,</span><br><span class="line">        <span class="attr">children</span>: [&#123; <span class="attr">path</span>: <span class="string">&quot;:id&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserDetail</span> /&gt;</span></span> &#125;], <span class="comment">// 再嵌套一次</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&quot;contact&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ContactPage</span> /&gt;</span></span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Router</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>UserPage.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UserList</span> <span class="keyword">from</span> <span class="string">&quot;./UserList&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">UserPage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">UserPage</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p>在router里面加上errorElement</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">errorElement</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorPage</span> /&gt;</span></span>,</span><br></pre></td></tr></table></figure></div>

<p>这个errorElement会捕获两种类型的错误:</p>
<ul>
<li>代码内部抛出的错误</li>
<li>不存在对应路由</li>
</ul>
<p>React Router还提供了一个hook, <code>useRouteError</code></p>
<p>ErrorPage.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isRouteErrorResponse, useRouteError &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ErrorPage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> error = <span class="title function_">useRouteError</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error); <span class="comment">// 这里可以引入外部库,将error记录到日志之中</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Oops...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;isRouteErrorResponse(error) ? &quot;Invalid Page&quot; : &quot;Unexpected Error&quot;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      // 如果是错误的路由的Error,就返回&quot;Invalid Page&quot;, 否则(代码内部抛出错误),返回 &quot;Unexpected Error&quot;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErrorPage</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h4 id="隐私路由-Private-Route-："><a href="#隐私路由-Private-Route-：" class="headerlink" title="隐私路由(Private Route)："></a>隐私路由(Private Route)：</h4><p>说实话没太听懂，大体思路就是将需要隐私保护的路由放到新的路由组里面去</p>
<p>然后这个新路由组的element内部可以加登录验证，如果没有登录，就return 一个 <code>&lt;Navigate&gt;</code>元素进行跳转</p>
<p>因为需要隐私保护的路由此时都是这个新路由组的子路由，所以都会被这个”根”的element路由保护</p>
<h4 id="实战：给gameHub加上详细页面"><a href="#实战：给gameHub加上详细页面" class="headerlink" title="实战：给gameHub加上详细页面"></a>实战：给gameHub加上详细页面</h4><p>我们想要一直保持NavBar组件可视，那么先整个Layout</p>
<p>Layout.tsx</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NavBar</span> <span class="keyword">from</span> <span class="string">&quot;../components/NavBar&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Layout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavBar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>这个Layout就是路由<code>&quot;/&quot;</code>啦，剩下的元素应该作为它的嵌套路由，放在<code>&lt;Outlet /&gt;</code>之中</p>
<p>然后将原来的App.tsx的组件放到新的<code>pages</code>文件夹的<code>HomePage.tsx</code></p>
<p>再将<code>GameCard</code>组件里面的<code>&lt;Text&gt;</code>对象改成<code>Link to=&#123;`/game/$&#123;game.id&#125;`&#125;</code></p>
<p>也就是结合我们前面动态路由的知识，就有了这样的路由</p>
<div class="highlight-container" data-rel="Tsx"><figure class="iseeu highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GameDetail</span> <span class="keyword">from</span> <span class="string">&quot;../pages/GameDetail&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomePage</span> <span class="keyword">from</span> <span class="string">&quot;../pages/HomePage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../pages/Layout&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">GameRouter</span> = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123; <span class="attr">index</span>: <span class="literal">true</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&quot;game/:id&quot;</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">GameDetail</span> /&gt;</span></span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">GameRouter</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>别的detail页面的细节实现就是前面初级部分的内容了（趴</p>
<p>值得注意的就是detail页面上的NavBar组件的搜索要想返回一个可视化的结果</p>
<p>需要稍稍修改，在onSubmit函数里面再调用useNavigate然后navigate回原来的主页，路由的部分就这么些了</p>
<p>完结撒花！</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> 实战2 mosh gamehub</li>
        <li><strong>Author:</strong> Ayanami</li>
        <li><strong>Created at
                :</strong> 2024-07-11 00:00:00</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-07-11 23:54:49
            </li>
        
        <li>
            <strong>Link:</strong> https://ayanami1314.github.io/2024/07/11/实战2-mosh-gamehub/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        
  <div class="recommended-article px-2 sm:px-6 md:px-8">
   <div class="recommended-desktop">
    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2024/07/11/ts基础/" title="ts基础" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="ts基础" class="!max-w-none">
  <span class="title">ts基础</span>
</a><a class="recommended-article-item" href="/2024/07/11/Django-mosh/" title="Django-mosh" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="Django-mosh" class="!max-w-none">
  <span class="title">Django-mosh</span>
</a><a class="recommended-article-item" href="/2024/07/11/jyy-recursion/" title="jyy recursion" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="jyy recursion" class="!max-w-none">
  <span class="title">jyy recursion</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2024/07/11/ts基础/" title="ts基础" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="ts基础" class="!max-w-none">
  <span class="title">ts基础</span>
</a><a class="recommended-article-item" href="/2024/07/11/Django-mosh/" title="Django-mosh" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="Django-mosh" class="!max-w-none">
  <span class="title">Django-mosh</span>
</a></div>
   </div>
  </div>

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/07/11/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E7%AE%80%E8%BF%B0/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">后端技术简述</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/07/11/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">数据结构期末复习</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">实战2 mosh gamehub</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E7%BA%A7%E9%83%A8%E5%88%86"><span class="nav-text">初级部分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86"><span class="nav-text">前端部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86"><span class="nav-text">后端部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build-A-Project"><span class="nav-text">Build A Project!</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E9%83%A8%E5%88%86"><span class="nav-text">进阶部分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Query"><span class="nav-text">React Query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-text">实战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Global-state-management"><span class="nav-text">Global state management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Router"><span class="nav-text">React Router</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Ayanami</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        27 posts in total
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.4</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>



    
<script src="/js/tools/localSearch.js" type="module"></script>




    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
